# Ports

- [WorkflowNodePortsData](https://github.com/bytedance/flowgram.ai/blob/main/packages/canvas-engine/free-layout-core/src/entity-datas/workflow-node-ports-data.ts) manages all port information for nodes
- [WorkflowPortEntity](https://github.com/bytedance/flowgram.ai/blob/main/packages/canvas-engine/free-layout-core/src/entities/workflow-port-entity.ts) port instance
- [WorkflowPortRender](https://github.com/bytedance/flowgram.ai/blob/main/packages/plugins/free-lines-plugin/src/components/workflow-port-render/index.tsx) port rendering component


## Define Ports

- Static Ports

Add `defaultPorts` to node declaration, such as `{ type: 'input', location: 'left' }`, which will add an input port on the left side of the node


```ts pure
// Port interface
export interface WorkflowPort {
  /**
   * If not specified, represents default connection point, default input type is left center, output type is right center
   */
  portID?: string | number;
  /**
   * Input or output point
   */
  type: WorkflowPortType;
  /**
   * Port location
   */
  location?: LinePointLocation;
  /**
   * Port hot zone size
   */
  size?: { width: number; height: number };
  /**
   * Offset relative to location
   */
  offset?: IPoint;
  /**
   * Disable port
   */
  disabled?: boolean;
}
```

```ts pure title="node-registries.ts"
{
  type: 'start',
  meta: {
    defaultPorts: [{ type: 'output', location: 'right' }, { type: 'input', location: 'left' }]
  },
}
```

- Dynamic Ports

Add `useDynamicPort` to node declaration, when set to true it will look for DOM elements with `data-port-id` and `data-port-type` attributes on the node DOM as ports


```ts pure title="node-registries.ts"
{
  type: 'condition',
  meta: {
    defaultPorts: [{ type: 'input'}]
    useDynamicPort: true
  },
}

```

```tsx pure

/**
*  Dynamic ports find port positions through querySelectorAll('[data-port-id]')
 */
function BaseNode() {
  return (
    <div>
      <div data-port-id="condition-if-0" data-port-type="output" data-port-location="right"></div>
      <div data-port-id="condition-if-1" data-port-type="output" data-port-location="righ" ></div>
      {/* others */}
    </div>
  )
}
```

## Update Ports Data

- Static Ports Update
```ts pure
// You can call this method to update static ports data based on form data
node.ports.updateAllPorts([
    { type: 'output', location: 'right', offset: { x: 100, y: 100 }},
    { type: 'input', location: 'left', offset: { x: -100, y: -100 }}
])
```
- Dynamic Ports Update

```ts pure
// Refresh and sync ports data from node dom content
node.ports.updateDynamicPorts()
```

## Port Rendering

Ports are ultimately rendered through the `WorkflowPortRender` component, supporting custom styles, or you can reimplement this component based on the source code. Refer to [Free Layout Best Practices - Node Rendering](https://github.com/bytedance/flowgram.ai/blob/main/apps/demo-free-layout/src/components/base-node/node-wrapper.tsx)

## Custom Port Colors

You can customize port colors by passing color props to `WorkflowPortRender`:

- `primaryColor` - Active state color (linked/hovered)
- `secondaryColor` - Default state color
- `errorColor` - Error state color
- `backgroundColor` - Background color

```tsx pure

import { WorkflowPortRender, useNodeRender } from '@flowgram.ai/free-layout-editor';

function BaseNode() {
  const { ports } = useNodeRender();
  return (
    <div>
      <div data-port-id="condition-if-0" data-port-type="output"></div>
      <div data-port-id="condition-if-1" data-port-type="output"></div>
      {ports.map((p) => (
        <WorkflowPortRender
          key={p.id}
          entity={p}
          className="xxx"
          style={{ /* custom style */}}
          // Custom port colors
          primaryColor="#4d53e8"        // Active state color (linked/hovered)
          secondaryColor="#9197f1"      // Default state color
          errorColor="#ff4444"          // Error state color
          backgroundColor="#ffffff"     // Background color
        />
      ))}
    </div>
  )
}
```

## Get Ports Data

```ts pure
const { ports } = node

console.log(ports.inputPorts) // Get all input ports of current node
console.log(ports.outputPorts) // Get all output ports of current node

console.log(ports.inputPorts.map(port => port.availableLines)) // Find connected lines through ports

ports.updateDynamicPorts() // When dynamic ports modify DOM structure or position, you can manually refresh port positions through this method (DOM rendering has delay, best executed in useEffect or setTimeout)
```

## Two-way Port Connection

<img loading="lazy" className="invert-img" src="/free-layout/two-way-connection.gif"/>

```ts pure title="node-registries.ts"
  {
    type: 'twoway',
    meta: {
      defaultPorts: [
        // input and output ports can overlap
        { type: 'input', portID: 'input-left', location: 'left' },
        { type: 'output', portID: 'output-left', location: 'left' },
        { type: 'input', portID: 'input-right', location: 'right' },
        { type: 'output', portID: 'output-right', location: 'right' },
      ],
    },
  },

```
