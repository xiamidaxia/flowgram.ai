---
url: /guide/introduction.md
---

# ä»‹ç»

FlowGram æ˜¯ä¸€å¥—åŸºäºèŠ‚ç‚¹ç¼–è¾‘çš„æµç¨‹æ­å»ºå¼•æ“ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿåˆ›å»ºå›ºå®šå¸ƒå±€æˆ–è‡ªç”±è¿çº¿å¸ƒå±€æ¨¡å¼çš„æµç¨‹ï¼Œå¹¶æä¾›ä¸€å¥—äº¤äº’çš„æœ€ä½³å®è·µ, å¾ˆé€‚åˆæœ‰æ˜ç¡®è¾“å…¥å’Œè¾“å‡ºçš„å¯è§†åŒ–å·¥ä½œæµã€‚

åœ¨ AI å¦‚ç«å¦‚è¼çš„å½“ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæ›´ä¸“æ³¨äºå¦‚ä½•è®©æµç¨‹èµ‹èƒ½ AIï¼Œä¸ºæ­¤ç‰¹æ„åŠ ä¸Š AI åç¼€ã€‚

FlowGram = Flow + Programï¼Œå¯“æ„æµç¨‹å¦‚ç¨‹åºä¸€æ ·ï¼Œæ‹¥æœ‰ Conditionã€Loop ç”šè‡³ TryCatch èŠ‚ç‚¹ã€‚

## å®˜æ–¹ Demo

å›ºå®šå¸ƒå±€

å›ºå®šçš„æ’ç‰ˆï¼ŒèŠ‚ç‚¹/åˆ†æ”¯æ”¯æŒæŒ‡å®šä½ç½®æ‹–æ‹½ç§»åŠ¨ï¼Œå¹¶æä¾›åˆ†æ”¯ã€å¾ªç¯ç­‰å¤åˆèŠ‚ç‚¹

è‡ªç”±è¿çº¿å¸ƒå±€

è‡ªç”±çš„æ’ç‰ˆï¼ŒèŠ‚ç‚¹æ”¯æŒä»»æ„ä½ç½®ç§»åŠ¨ï¼Œé€šè¿‡è‡ªç”±è¿çº¿è¿æ¥èŠ‚ç‚¹

## äº¤äº’ä½“éªŒ

æä¾›ä¸€å¥—äº¤äº’çš„æœ€ä½³å®è·µï¼Œè®©æ“ä½œæµç¨‹æ›´åŠ ä¸æ»‘

Motion è¿‡æ¸¡åŠ¨ç”»

Motion åŠ¨ç”»åœ¨ Web ç«¯åº”ç”¨å¯è¿½æº¯åˆ° Material Designï¼Œé‡Œè¾¹æåˆ°å…ƒç´ çš„å˜åŒ–å¦‚å®½é«˜æˆ–ä½ç½®éœ€è¦ä¸€ä¸ªè¿‡æ¸¡è¿‡ç¨‹ï¼Œç”»å¸ƒå¼•æ“ä¼šæŠŠçº¿æ¡å’ŒèŠ‚ç‚¹æ‹†åˆ†å•ç‹¬ç»˜åˆ¶ï¼Œä½¿å®ç° Motion è¿‡æ¸¡åŠ¨ç”»æˆæœ¬å¤§å¤§é™ä½

è§¦æ‘¸æ¿æ‰‹åŠ¿ç¼©æ”¾ + ç©ºæ ¼è‡ªç”±æ‹–åŠ¨ç”»å¸ƒ

æ‰‹åŠ¿æŒ‡åœ¨ Mac è§¦æ‘¸æ¿ä¸¤æŒ‡å±•å¼€/åˆå¹¶å¯ä»¥å®ç°ç”»å¸ƒæ”¾å¤§/ç¼©å°ï¼Œæˆ–è€…æŒ‰ä½ç©ºæ ¼æ‹–åŠ¨ç”»å¸ƒï¼Œäº¤äº’å€Ÿé‰´ Sketchã€Figma

ç¼©ç•¥å›¾

æ’¤é”€/é‡åš

å¤åˆ¶/ç²˜è´´(æ”¯æŒå¿«æ·é”®)

æ¡†é€‰ + æ‹–æ‹½
<div>(å›ºå®š)</div>

æ°´å¹³/å‚ç›´å¸ƒå±€åˆ‡æ¢
<div>(å›ºå®š)</div>

åˆ†æ”¯æŠ˜å 
<div>(å›ºå®š)</div>

åˆ†ç»„
<div>(å›ºå®š)</div>

è‡ªåŠ¨æ•´ç†
(è‡ªç”±)

å¸é™„å¯¹é½ + å‚è€ƒçº¿
(è‡ªç”±)

Coze Loop å­ç”»å¸ƒ
(è‡ªç”±)

## çº¿ä¸Šåº”ç”¨

æ‰£å­å·¥ä½œæµ

é£ä¹¦ä½ä»£ç å¹³å°å·¥ä½œæµ

é£ä¹¦å¤šç»´è¡¨æ ¼å·¥ä½œæµ



---
url: /examples/index.md
---




---
url: /examples/fixed-layout/fixed-layout-simple.md
---

# åŸºç¡€ç”¨æ³•



## å®‰è£…

```bash
npx @flowgram.ai/create-app@latest fixed-layout-simple
```

## æºç 

https://github.com/bytedance/flowgram.ai/tree/main/apps/demo-fixed-layout-simple



---
url: /examples/fixed-layout/fixed-composite-nodes.md
---

# å¤åˆèŠ‚ç‚¹



## å®‰è£…

```bash
npx @flowgram.ai/create-app@latest fixed-layout-simple
```

## æºç 

* jsonData: https://github.com/bytedance/flowgram.ai/tree/main/apps/demo-fixed-layout-simple/src/data
* nodeRegistries: https://github.com/bytedance/flowgram.ai/tree/main/packages/canvas-engine/fixed-layout-core/src/activities



---
url: /examples/fixed-layout/fixed-feature-overview.md
---

# æœ€ä½³å®è·µ



## å®‰è£…

```bash
npx @flowgram.ai/create-app@latest fixed-layout
```

## æºç 

https://github.com/bytedance/flowgram.ai/tree/main/apps/demo-fixed-layout

## åŠŸèƒ½ä»‹ç»

ç¼©ç•¥å›¾

æ’¤é”€/é‡åš

å¤åˆ¶/ç²˜è´´(æ”¯æŒå¿«æ·é”®)

æ¡†é€‰ + æ‹–æ‹½

æ°´å¹³/å‚ç›´å¸ƒå±€åˆ‡æ¢

åˆ†æ”¯æŠ˜å 

åˆ†ç»„



---
url: /examples/free-layout/free-layout-simple.md
---

# åŸºç¡€ç”¨æ³•



## åŠŸèƒ½ä»‹ç»

Free Layout æ˜¯ Flowgram.ai æä¾›çš„è‡ªç”±å¸ƒå±€ç¼–è¾‘å™¨ç»„ä»¶ï¼Œå…è®¸ç”¨æˆ·åˆ›å»ºå’Œç¼–è¾‘æµç¨‹å›¾ã€å·¥ä½œæµå’Œå„ç§èŠ‚ç‚¹è¿æ¥å›¾è¡¨ã€‚æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š

* èŠ‚ç‚¹è‡ªç”±æ‹–æ‹½ä¸å®šä½
* èŠ‚ç‚¹è¿æ¥ä¸è¾¹ç¼˜ç®¡ç†
* å¯é…ç½®çš„èŠ‚ç‚¹æ³¨å†Œä¸è‡ªå®šä¹‰æ¸²æŸ“
* å†…ç½®æ’¤é”€/é‡åšå†å²è®°å½•
* æ”¯æŒæ’ä»¶æ‰©å±•ï¼ˆå¦‚ç¼©ç•¥å›¾ã€è‡ªåŠ¨å¯¹é½ç­‰ï¼‰

## ä»é›¶æ„å»ºè‡ªç”±å¸ƒå±€ç¼–è¾‘å™¨

æœ¬èŠ‚å°†å¸¦ä½ ä»é›¶å¼€å§‹æ„å»ºä¸€ä¸ªè‡ªç”±å¸ƒå±€ç¼–è¾‘å™¨åº”ç”¨ï¼Œå®Œæ•´æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ @flowgram.ai/free-layout-editor åŒ…æ„å»ºä¸€ä¸ªå¯äº¤äº’çš„æµç¨‹ç¼–è¾‘å™¨ã€‚

### 1. ç¯å¢ƒå‡†å¤‡

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼š

```bash
# ä½¿ç”¨è„šæ‰‹æ¶å¿«é€Ÿåˆ›å»ºé¡¹ç›®
npx @flowgram.ai/create-app@latest free-layout-simple

# è¿›å…¥é¡¹ç›®ç›®å½•
cd free-layout-simple

# å®‰è£…ä¾èµ–
npm install
```

### 2. é¡¹ç›®ç»“æ„

åˆ›å»ºå®Œæˆåï¼Œé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š

```
free-layout-simple/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/            # ç»„ä»¶ç›®å½•
â”‚   â”‚   â”œâ”€â”€ node-add-panel.tsx # èŠ‚ç‚¹æ·»åŠ é¢æ¿
â”‚   â”‚   â”œâ”€â”€ tools.tsx          # å·¥å…·æ ç»„ä»¶
â”‚   â”‚   â””â”€â”€ minimap.tsx        # ç¼©ç•¥å›¾ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ use-editor-props.tsx # ç¼–è¾‘å™¨é…ç½®
â”‚   â”œâ”€â”€ initial-data.ts        # åˆå§‹æ•°æ®å®šä¹‰
â”‚   â”œâ”€â”€ node-registries.ts     # èŠ‚ç‚¹ç±»å‹æ³¨å†Œ
â”‚   â”œâ”€â”€ editor.tsx             # ç¼–è¾‘å™¨ä¸»ç»„ä»¶
â”‚   â”œâ”€â”€ app.tsx                # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ index.tsx              # æ¸²æŸ“å…¥å£
â”‚   â””â”€â”€ index.css              # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ package.json
â””â”€â”€ ...å…¶ä»–é…ç½®æ–‡ä»¶
```

### 3. å¼€å‘æµç¨‹

#### æ­¥éª¤ä¸€ï¼šå®šä¹‰åˆå§‹æ•°æ®

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ç”»å¸ƒçš„åˆå§‹æ•°æ®ç»“æ„ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹å’Œè¿çº¿ï¼š

```tsx
// src/initial-data.ts
import { WorkflowJSON } from '@flowgram.ai/free-layout-editor';

export const initialData: WorkflowJSON = {
  nodes: [
    {
      id: 'start_0',
      type: 'start',
      meta: {
        position: { x: 0, y: 0 },
      },
      data: {
        title: 'å¼€å§‹èŠ‚ç‚¹',
        content: 'è¿™æ˜¯å¼€å§‹èŠ‚ç‚¹'
      },
    },
    {
      id: 'node_0',
      type: 'custom',
      meta: {
        position: { x: 400, y: 0 },
      },
      data: {
        title: 'è‡ªå®šä¹‰èŠ‚ç‚¹',
        content: 'è¿™æ˜¯è‡ªå®šä¹‰èŠ‚ç‚¹'
      },
    },
    {
      id: 'end_0',
      type: 'end',
      meta: {
        position: { x: 800, y: 0 },
      },
      data: {
        title: 'ç»“æŸèŠ‚ç‚¹',
        content: 'è¿™æ˜¯ç»“æŸèŠ‚ç‚¹'
      },
    },
  ],
  edges: [
    {
      sourceNodeID: 'start_0',
      targetNodeID: 'node_0',
    },
    {
      sourceNodeID: 'node_0',
      targetNodeID: 'end_0',
    },
  ],
};
```

#### æ­¥éª¤äºŒï¼šæ³¨å†ŒèŠ‚ç‚¹ç±»å‹

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸åŒç±»å‹èŠ‚ç‚¹çš„è¡Œä¸ºå’Œå¤–è§‚ï¼š

```tsx
// src/node-registries.ts
import { WorkflowNodeRegistry } from '@flowgram.ai/free-layout-editor';

/**
 * ä½ å¯ä»¥è‡ªå®šä¹‰èŠ‚ç‚¹çš„æ³¨å†Œå™¨
 */
export const nodeRegistries: WorkflowNodeRegistry[] = [
  {
    type: 'start',
    meta: {
      isStart: true, // å¼€å§‹èŠ‚ç‚¹æ ‡è®°
      deleteDisable: true, // å¼€å§‹èŠ‚ç‚¹ä¸èƒ½è¢«åˆ é™¤
      copyDisable: true, // å¼€å§‹èŠ‚ç‚¹ä¸èƒ½è¢« copy
      defaultPorts: [{ type: 'output' }], // å®šä¹‰ input å’Œ output ç«¯å£ï¼Œå¼€å§‹èŠ‚ç‚¹åªæœ‰ output ç«¯å£
    },
  },
  {
    type: 'end',
    meta: {
      deleteDisable: true,
      copyDisable: true,
      defaultPorts: [{ type: 'input' }], // ç»“æŸèŠ‚ç‚¹åªæœ‰ input ç«¯å£
    },
  },
  {
    type: 'custom',
    meta: {},
    defaultPorts: [{ type: 'output' }, { type: 'input' }], // æ™®é€šèŠ‚ç‚¹æœ‰ä¸¤ä¸ªç«¯å£
  },
];
```

#### æ­¥éª¤ä¸‰ï¼šåˆ›å»ºç¼–è¾‘å™¨é…ç½®

ä½¿ç”¨ React hook å°è£…ç¼–è¾‘å™¨é…ç½®ï¼š

```tsx
// src/hooks/use-editor-props.tsx
import { useMemo } from 'react';
import {
  FreeLayoutProps,
  WorkflowNodeProps,
  WorkflowNodeRenderer,
  Field,
  useNodeRender,
} from '@flowgram.ai/free-layout-editor';
import { createMinimapPlugin } from '@flowgram.ai/minimap-plugin';
import { createFreeSnapPlugin } from '@flowgram.ai/free-snap-plugin';

import { nodeRegistries } from '../node-registries';
import { initialData } from '../initial-data';

export const useEditorProps = () =>
  useMemo<FreeLayoutProps>(
    () => ({
      // å¯ç”¨èƒŒæ™¯ç½‘æ ¼
      background: true,
      // éåªè¯»æ¨¡å¼
      readonly: false,
      // åˆå§‹æ•°æ®
      initialData,
      // èŠ‚ç‚¹ç±»å‹æ³¨å†Œ
      nodeRegistries,
      // é»˜è®¤èŠ‚ç‚¹æ³¨å†Œ
      getNodeDefaultRegistry(type) {
        return {
          type,
          meta: {
            defaultExpanded: true,
          },
          formMeta: {
            // èŠ‚ç‚¹è¡¨å•æ¸²æŸ“
            render: () => (
              <>
                <Field<string> name="title">
                  {({ field }) => <div className="demo-free-node-title">{field.value}</div>}
                </Field>
                <div className="demo-free-node-content">
                  <Field<string> name="content">
                    <input />
                  </Field>
                </div>
              </>
            ),
          },
        };
      },
      // èŠ‚ç‚¹æ¸²æŸ“
      materials: {
        renderDefaultNode: (props: WorkflowNodeProps) => {
          const { form } = useNodeRender();
          return (
            <WorkflowNodeRenderer className="demo-free-node" node={props.node}>
              {form?.render()}
            </WorkflowNodeRenderer>
          );
        },
      },
      // å†…å®¹å˜æ›´å›è°ƒ
      onContentChange(ctx, event) {
        console.log('æ•°æ®å˜æ›´: ', event, ctx.document.toJSON());
      },
      // å¯ç”¨èŠ‚ç‚¹è¡¨å•å¼•æ“
      nodeEngine: {
        enable: true,
      },
      // å¯ç”¨å†å²è®°å½•
      history: {
        enable: true,
        enableChangeNode: true, // ç›‘å¬èŠ‚ç‚¹å¼•æ“æ•°æ®å˜åŒ–
      },
      // åˆå§‹åŒ–å›è°ƒ
      onInit: (ctx) => {},
      // æ¸²æŸ“å®Œæˆå›è°ƒ
      onAllLayersRendered(ctx) {
        ctx.document.fitView(false); // é€‚åº”è§†å›¾
      },
      // é”€æ¯å›è°ƒ
      onDispose() {
        console.log('ç¼–è¾‘å™¨å·²é”€æ¯');
      },
      // æ’ä»¶é…ç½®
      plugins: () => [
        // ç¼©ç•¥å›¾æ’ä»¶
        createMinimapPlugin({
          disableLayer: true,
          canvasStyle: {
            canvasWidth: 182,
            canvasHeight: 102,
            canvasPadding: 50,
            canvasBackground: 'rgba(245, 245, 245, 1)',
            canvasBorderRadius: 10,
            viewportBackground: 'rgba(235, 235, 235, 1)',
            viewportBorderRadius: 4,
            viewportBorderColor: 'rgba(201, 201, 201, 1)',
            viewportBorderWidth: 1,
            viewportBorderDashLength: 2,
            nodeColor: 'rgba(255, 255, 255, 1)',
            nodeBorderRadius: 2,
            nodeBorderWidth: 0.145,
            nodeBorderColor: 'rgba(6, 7, 9, 0.10)',
            overlayColor: 'rgba(255, 255, 255, 0)',
          },
          inactiveDebounceTime: 1,
        }),
        // è‡ªåŠ¨å¯¹é½æ’ä»¶
        createFreeSnapPlugin({
          edgeColor: '#00B2B2',
          alignColor: '#00B2B2',
          edgeLineWidth: 1,
          alignLineWidth: 1,
          alignCrossWidth: 8,
        }),
      ],
    }),
    []
  );
```

#### æ­¥éª¤å››ï¼šåˆ›å»ºèŠ‚ç‚¹æ·»åŠ é¢æ¿

```tsx
// src/components/node-add-panel.tsx
import React from 'react';
import { WorkflowDragService, useService } from '@flowgram.ai/free-layout-editor';

const nodeTypes = ['è‡ªå®šä¹‰èŠ‚ç‚¹1', 'è‡ªå®šä¹‰èŠ‚ç‚¹2'];

export const NodeAddPanel: React.FC = () => {
  const dragService = useService<WorkflowDragService>(WorkflowDragService);

  return (
    <div className="demo-free-sidebar">
      {nodeTypes.map(nodeType => (
        <div
          key={nodeType}
          className="demo-free-card"
          onMouseDown={e => dragService.startDragCard(nodeType, e, {
            data: {
              title: nodeType,
              content: 'æ‹–æ‹½åˆ›å»ºçš„èŠ‚ç‚¹'
            }
          })}
        >
          {nodeType}
        </div>
      ))}
    </div>
  );
};
```

#### æ­¥éª¤äº”ï¼šåˆ›å»ºå·¥å…·æ å’Œç¼©ç•¥å›¾

```tsx
// src/components/tools.tsx
import React from 'react';
import { useEffect, useState } from 'react';
import { usePlaygroundTools, useClientContext } from '@flowgram.ai/free-layout-editor';

export const Tools: React.FC = () => {
  const { history } = useClientContext();
  const tools = usePlaygroundTools();
  const [canUndo, setCanUndo] = useState(false);
  const [canRedo, setCanRedo] = useState(false);

  useEffect(() => {
    const disposable = history.undoRedoService.onChange(() => {
      setCanUndo(history.canUndo());
      setCanRedo(history.canRedo());
    });
    return () => disposable.dispose();
  }, [history]);

  return (
    <div
      style={{ position: 'absolute', zIndex: 10, bottom: 16, left: 226, display: 'flex', gap: 8 }}
    >
      <button onClick={() => tools.zoomin()}>ZoomIn</button>
      <button onClick={() => tools.zoomout()}>ZoomOut</button>
      <button onClick={() => tools.fitView()}>Fitview</button>
      <button onClick={() => tools.autoLayout()}>AutoLayout</button>
      <button onClick={() => history.undo()} disabled={!canUndo}>
        Undo
      </button>
      <button onClick={() => history.redo()} disabled={!canRedo}>
        Redo
      </button>
      <span>{Math.floor(tools.zoom * 100)}%</span>
    </div>
  );
};

// src/components/minimap.tsx
import { FlowMinimapService, MinimapRender } from '@flowgram.ai/minimap-plugin';
import { useService } from '@flowgram.ai/free-layout-editor';

export const Minimap = () => {
  const minimapService = useService(FlowMinimapService);
  return (
    <div
      style={{
        position: 'absolute',
        left: 226,
        bottom: 51,
        zIndex: 100,
        width: 198,
      }}
    >
      <MinimapRender
        service={minimapService}
        containerStyles={{
          pointerEvents: 'auto',
          position: 'relative',
          top: 'unset',
          right: 'unset',
          bottom: 'unset',
          left: 'unset',
        }}
        inactiveStyle={{
          opacity: 1,
          scale: 1,
          translateX: 0,
          translateY: 0,
        }}
      />
    </div>
  );
};
```

#### æ­¥éª¤å…­ï¼šç»„è£…ç¼–è¾‘å™¨ä¸»ç»„ä»¶

```tsx
// src/editor.tsx
import { EditorRenderer, FreeLayoutEditorProvider } from '@flowgram.ai/free-layout-editor';

import { useEditorProps } from './hooks/use-editor-props';
import { Tools } from './components/tools';
import { NodeAddPanel } from './components/node-add-panel';
import { Minimap } from './components/minimap';
import '@flowgram.ai/free-layout-editor/index.css';
import './index.css';

export const Editor = () => {
  const editorProps = useEditorProps();
  return (
    <FreeLayoutEditorProvider {...editorProps}>
      <div className="demo-free-container">
        <div className="demo-free-layout">
          <NodeAddPanel />
          <EditorRenderer className="demo-free-editor" />
        </div>
        <Tools />
        <Minimap />
      </div>
    </FreeLayoutEditorProvider>
  );
};
```

#### æ­¥éª¤ä¸ƒï¼šåˆ›å»ºåº”ç”¨å…¥å£

```tsx
// src/app.tsx
import React from 'react';
import ReactDOM from 'react-dom';

import { Editor } from './editor';

ReactDOM.render(<Editor />, document.getElementById('root'))
```

#### æ­¥éª¤å…«ï¼šæ·»åŠ æ ·å¼

```css
/* src/index.css */
.demo-free-node {
    display: flex;
    min-width: 300px;
    min-height: 100px;
    flex-direction: column;
    align-items: flex-start;
    box-sizing: border-box;
    border-radius: 8px;
    border: 1px solid var(--light-usage-border-color-border, rgba(28, 31, 35, 0.08));
    background: #fff;
    box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.1);
}

.demo-free-node-title {
    background-color: #93bfe2;
    width: 100%;
    border-radius: 8px 8px 0 0;
    padding: 4px 12px;
}
.demo-free-node-content {
    padding: 4px 12px;
    flex-grow: 1;
    width: 100%;
}
.demo-free-node::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    z-index: -1;
    background-color: white;
    border-radius: 7px;
}

.demo-free-node:hover:before {
    -webkit-filter: drop-shadow(0 0 1px rgba(0, 0, 0, 0.3)) drop-shadow(0 4px 14px rgba(0, 0, 0, 0.1));
    filter: drop-shadow(0 0 1px rgba(0, 0, 0, 0.3)) drop-shadow(0 4px 14px rgba(0, 0, 0, 0.1));
}

.demo-free-node.activated:before,
.demo-free-node.selected:before {
    outline: 2px solid var(--light-usage-primary-color-primary, #4d53e8);
    -webkit-filter: drop-shadow(0 0 1px rgba(0, 0, 0, 0.3)) drop-shadow(0 4px 14px rgba(0, 0, 0, 0.1));
    filter: drop-shadow(0 0 1px rgba(0, 0, 0, 0.3)) drop-shadow(0 4px 14px rgba(0, 0, 0, 0.1));
}

.demo-free-sidebar {
    height: 100%;
    overflow-y: auto;
    padding: 12px 16px 0;
    box-sizing: border-box;
    background: #f7f7fa;
    border-right: 1px solid rgba(29, 28, 35, 0.08);
}

.demo-free-right-top-panel {
    position: fixed;
    right: 10px;
    top: 70px;
    width: 300px;
    z-index: 999;
}

.demo-free-card {
    width: 140px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 6px 8px 0 rgba(28, 31, 35, 0.03);
    cursor: -webkit-grab;
    cursor: grab;
    line-height: 16px;
    margin-bottom: 12px;
    overflow: hidden;
    padding: 16px;
    position: relative;
    color: black;
}

.demo-free-layout {
    display: flex;
    flex-direction: row;
    flex-grow: 1;
}

.demo-free-editor {
    flex-grow: 1;
    position: relative;
    height: 100%;
}

.demo-free-container {
    position: absolute;
    left: 0;
    top: 0;
    display: flex;
    width: 100%;
    height: 100%;
    flex-direction: column;
}

```

### 4. è¿è¡Œé¡¹ç›®

å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œä½ å¯ä»¥è¿è¡Œé¡¹ç›®æŸ¥çœ‹æ•ˆæœï¼š

```bash
npm run dev
```

é¡¹ç›®å°†åœ¨æœ¬åœ°å¯åŠ¨ï¼Œé€šå¸¸è®¿é—® http://localhost:3000 å³å¯çœ‹åˆ°æ•ˆæœã€‚

## æ ¸å¿ƒæ¦‚å¿µ

### 1. æ•°æ®ç»“æ„

Free Layout ä½¿ç”¨æ ‡å‡†åŒ–çš„æ•°æ®ç»“æ„æ¥æè¿°èŠ‚ç‚¹å’Œè¿æ¥ï¼š

```tsx
// å·¥ä½œæµæ•°æ®ç»“æ„
const initialData: WorkflowJSON = {
  // èŠ‚ç‚¹å®šä¹‰
  nodes: [
    {
      id: 'start_0',        // èŠ‚ç‚¹å”¯ä¸€ID
      type: 'start',        // èŠ‚ç‚¹ç±»å‹ï¼ˆå¯¹åº” nodeRegistries ä¸­çš„æ³¨å†Œï¼‰
      meta: {
        position: { x: 0, y: 0 }, // èŠ‚ç‚¹ä½ç½®
      },
      data: {
        title: 'Start',     // èŠ‚ç‚¹æ•°æ®ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
        content: 'Start content'
      },
    },
    // æ›´å¤šèŠ‚ç‚¹...
  ],
  // è¿çº¿å®šä¹‰
  edges: [
    {
      sourceNodeID: 'start_0', // æºèŠ‚ç‚¹ID
      targetNodeID: 'node_0',  // ç›®æ ‡èŠ‚ç‚¹ID
    },
    // æ›´å¤šè¿çº¿...
  ],
};
```

### 2. èŠ‚ç‚¹æ³¨å†Œ

ä½¿ç”¨ `nodeRegistries` å®šä¹‰ä¸åŒç±»å‹èŠ‚ç‚¹çš„è¡Œä¸ºå’Œå¤–è§‚ï¼š

```tsx
// èŠ‚ç‚¹æ³¨å†Œ
import { WorkflowNodeRegistry } from '@flowgram.ai/free-layout-editor';

export const nodeRegistries: WorkflowNodeRegistry[] = [
  // å¼€å§‹èŠ‚ç‚¹å®šä¹‰
  {
    type: 'start',
    meta: {
      isStart: true, // Mark as start
      deleteDisable: true, // The start node cannot be deleted
      copyDisable: true, // The start node cannot be copied
      defaultPorts: [{ type: 'output' }], // Used to define the input and output ports, the start node only has the output port
    },
  },
  // æ›´å¤šèŠ‚ç‚¹ç±»å‹...
];
```

### 3. ç¼–è¾‘å™¨ç»„ä»¶

```tsx
// æ ¸å¿ƒç¼–è¾‘å™¨å®¹å™¨ä¸æ¸²æŸ“å™¨
import {
  FreeLayoutEditorProvider,
  EditorRenderer
} from '@flowgram.ai/free-layout-editor';

// ç¼–è¾‘å™¨é…ç½®ç¤ºä¾‹
const editorProps = {
  background: true,       // å¯ç”¨èƒŒæ™¯ç½‘æ ¼
  readonly: false,        // éåªè¯»æ¨¡å¼ï¼Œå…è®¸ç¼–è¾‘
  initialData: {...},     // åˆå§‹åŒ–æ•°æ®ï¼šèŠ‚ç‚¹å’Œè¾¹çš„å®šä¹‰
  nodeRegistries: [...],  // èŠ‚ç‚¹ç±»å‹æ³¨å†Œ
  nodeEngine: {
    enable: true,         // å¯ç”¨èŠ‚ç‚¹è¡¨å•å¼•æ“
  },
  history: {
    enable: true,         // å¯ç”¨å†å²è®°å½•
    enableChangeNode: true, // ç›‘å¬èŠ‚ç‚¹æ•°æ®å˜åŒ–
  }
};

// å®Œæ•´ç¼–è¾‘å™¨æ¸²æŸ“
<FreeLayoutEditorProvider {...editorProps}>
  <div className="container">
    <NodeAddPanel />              {/* èŠ‚ç‚¹æ·»åŠ é¢æ¿ */}
    <EditorRenderer />            {/* æ ¸å¿ƒç¼–è¾‘å™¨æ¸²æŸ“åŒºåŸŸ */}
    <Tools />                     {/* å·¥å…·æ  */}
    <Minimap />                   {/* ç¼©ç•¥å›¾ */}
  </div>
</FreeLayoutEditorProvider>
```

### 4. æ ¸å¿ƒé’©å­å‡½æ•°

åœ¨ç»„ä»¶ä¸­å¯ä»¥ä½¿ç”¨å¤šç§é’©å­å‡½æ•°è·å–å’Œæ“ä½œç¼–è¾‘å™¨ï¼š

```tsx
// è·å–æ‹–æ‹½æœåŠ¡
const dragService = useService<WorkflowDragService>(WorkflowDragService);
// å¼€å§‹æ‹–æ‹½èŠ‚ç‚¹
dragService.startDragCard('nodeType', event, { data: {...} });

// è·å–ç¼–è¾‘å™¨ä¸Šä¸‹æ–‡
const { document, playground } = useClientContext();
// æ“ä½œç”»å¸ƒ
document.fitView();                 // é€‚åº”è§†å›¾
playground.config.zoomin();               // ç¼©æ”¾ç”»å¸ƒ
document.fromJSON(newData);         // æ›´æ–°æ•°æ®
```

### 5. æ’ä»¶æ‰©å±•

Free Layout æ”¯æŒé€šè¿‡æ’ä»¶æœºåˆ¶æ‰©å±•åŠŸèƒ½ï¼š

```tsx
plugins: () => [
  // ç¼©ç•¥å›¾æ’ä»¶
  createMinimapPlugin({
    canvasStyle: {
      canvasWidth: 180,
      canvasHeight: 100,
      canvasBackground: 'rgba(245, 245, 245, 1)',
    }
  }),
  // è‡ªåŠ¨å¯¹é½æ’ä»¶
  createFreeSnapPlugin({
    edgeColor: '#00B2B2',     // å¯¹é½çº¿é¢œè‰²
    alignColor: '#00B2B2',    // è¾…åŠ©çº¿é¢œè‰²
    edgeLineWidth: 1,         // çº¿å®½
  }),
],
```

## å®‰è£…

```bash
npx @flowgram.ai/create-app@latest free-layout-simple
```

## æºç 

https://github.com/bytedance/flowgram.ai/tree/main/apps/demo-free-layout-simple



---
url: /examples/free-layout/free-feature-overview.md
---

# æœ€ä½³å®è·µ



## å®‰è£…

```bash
npx @flowgram.ai/create-app@latest free-layout
```

## æºç 

https://github.com/bytedance/flowgram.ai/tree/main/apps/demo-free-layout

## åŠŸèƒ½ä»‹ç»

è‡ªåŠ¨æ•´ç†

å¸é™„å¯¹é½ + å‚è€ƒçº¿



---
url: /examples/node-form/basic.md
---

# åŸºç¡€ç”¨æ³•



è¯¥ä¾‹å­å±•ç¤ºäº†è¡¨å•çš„å‡ ä¸ªåŸºç¡€ç”¨æ³•

* è¡¨å•ç»„ä»¶æ¸²æŸ“
* å¿…å¡«æ ¡éªŒ
* é»˜è®¤å€¼è®¾ç½®



---
url: /examples/node-form/effect.md
---

# å‰¯ä½œç”¨



ä»¥ä¸‹ä¾‹å­å±•ç¤ºäº†è¡¨å•å‰¯ä½œç”¨çš„é…ç½®æ–¹å¼ã€‚ä¸¾äº†ä¸¤ä¸ªä¸ªä¾‹å­ï¼Œè¡Œä¸ºæè¿°å¦‚ä¸‹

1. Basic effect(åŸºç¡€ä¾‹å­)ï¼šå½“è¡¨å•é¡¹å€¼å˜æ›´æ—¶ï¼Œæ§åˆ¶å°ä¼šæ‰“å°è¡¨å•å½“å‰å€¼ã€‚
2. Control other fields (æ§åˆ¶å…¶ä»–è¡¨å•é¡¹çš„å€¼)ï¼šå½“å‰è¡¨å•é¡¹æ•°æ®å˜æ›´æ—¶è¦åŒæ—¶æ”¹å˜å¦ä¸€ä¸ªè¡¨å•é¡¹çš„å€¼ã€‚



---
url: /examples/node-form/array.md
---

# æ•°ç»„



ä»¥ä¸‹ä¾‹å­å±•ç¤ºäº†æ•°ç»„çš„åŸºæœ¬ç”¨æ³•ï¼ŒåŒ…å«ï¼š

* åŸºæœ¬å†™æ³•ï¼ˆæ¸²æŸ“ã€å¢åˆ ï¼‰ã€‚
* å¦‚ä½•å¯¹æ•°ç»„æ¯é¡¹é…ç½®æ ¡éªŒé€»è¾‘ã€‚ æ­¤å¤„çš„æ ¡éªŒè§„åˆ™ä¸ºæ¯é¡¹æœ€å¤§é•¿åº¦ä¸è¶…è¿‡8ä¸ªè‹±æ–‡å­—ç¬¦ã€‚
* å¦‚ä½•å¯¹æ•°ç»„æ¯é¡¹é…ç½®å‰¯ä½œç”¨ã€‚ æ­¤å¤„çš„å‰¯ä½œç”¨ä¸ºæ¯é¡¹åœ¨åˆå§‹åŒ–æ—¶æ§åˆ¶å°è¾“å‡º `${name} value init to ${value}`, å€¼å˜æ›´æ—¶è¾“å‡º `${name} value changed to ${value}`
* æ•°ç»„é¡¹å¦‚ä½•åšäº¤æ¢ã€‚



---
url: /examples/node-form/dynamic.md
---

# è”åŠ¨



å½“å‰ä¾‹å­å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ `deps` å­—æ®µæ¥å£°æ˜è¡¨å•é¡¹ä¹‹é—´çš„è”åŠ¨æ›´æ–°å…³ç³»ã€‚

ä¾‹å­è¯´æ˜ï¼šå½“ `Country` æœ‰å€¼æ—¶æ‰ä¼šæ˜¾ç¤º `City` å­—æ®µã€‚

ä½ ä¹Ÿå¯ä»¥å°†`form.getValueIn('country')` ä½œä¸º city `Field` ä¸‹ç»„ä»¶çš„å…¥å‚ï¼Œæ¥æ§åˆ¶ç»„ä»¶å†…çš„è¡Œä¸º, å¦‚ç­›é€‰å½“å‰countryä¸‹çš„citiesã€‚



---
url: /api/common-apis.md
---

# å¸¸ç”¨ API

## FlowDocument ï¼ˆè‡ªåŠ¨åŒ–å¸ƒå±€æ–‡æ¡£æ•°æ®ï¼‰

```ts
// é€šè¿‡ hook è·å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ctx
const doc = useService<FlowDocument>(FlowDocument)

doc.fromJSON(data) // åŠ è½½æ•°æ®
doc.getAllNodes() // è·å–æ‰€æœ‰èŠ‚ç‚¹
doc.traverseDFS(node => {}) // æ·±åº¦éå†èŠ‚ç‚¹
doc.toJSON() // TODO è¿™é‡Œè€ç‰ˆæœ¬çš„æ•°æ®ï¼Œè¿˜æ²¡ä¼˜åŒ–ï¼Œä¸šåŠ¡æœ€å¥½è‡ªå·±ä½¿ç”¨ traverseDFS å®ç° json è½¬æ¢

doc.addFromNode(targetNode, json) // æ’å…¥åˆ°æŒ‡å®šèŠ‚ç‚¹çš„åè¾¹

doc.onNodeCreate(({ node, json }) => {}) // ç›‘å¬èŠ‚ç‚¹åˆ›å»ºï¼Œdata ä¸ºåˆ›å»ºæ—¶å€™çš„jsonæ•°æ®
doc.onNodeDispose(({ node }) => {}) // ç›‘å¬èŠ‚ç‚¹åˆ é™¤
```

## WorkflowDocument (è‡ªç”±è¿çº¿å¸ƒå±€æ–‡æ¡£æ•°æ®) ç»§æ‰¿è‡ª FlowDocument

```ts
const doc = useService<WorkflowDocument>(WorkflowDocument)

doc.fromJSON(data) // åŠ è½½æ•°æ®
doc.toJSON() // å¯¼å‡ºæ•°æ®
doc.getAllNodes() // è·å–æ‰€æœ‰èŠ‚ç‚¹
doc.linesManager.getAllLines() // è·å–æ‰€æœ‰çº¿æ¡

// åˆ›å»ºèŠ‚ç‚¹
doc.createWorkflowNode({ id: nanoid(), type: 'xxx', data: {}, meta: { position: { x: 0, y: 0 } } })
// åˆ›å»ºçº¿æ¡ï¼Œfromå’Œto ä¸ºå¯¹åº”è¦è¿çº¿çš„èŠ‚ç‚¹idï¼Œ fromPort, toPort å¦‚æœä¸ºå•ä¸ªç«¯å£å¯ä»¥ä¸æŒ‡å®š
doc.linesManager.createLine({ from, to, fromPort, toPort })

// ç›‘å¬å˜åŒ–ï¼Œè¿™é‡Œä¼šç›‘å¬çº¿æ¡å’ŒèŠ‚ç‚¹ç­‰äº‹ä»¶
doc.onContentChange((e) => {

})
```

## FlowNodeEntityï¼ˆèŠ‚ç‚¹ï¼‰

```ts
node.flowNodeType // å½“å‰èŠ‚ç‚¹çš„typeç±»å‹
node.transform.bounds // è·å–èŠ‚ç‚¹çš„å¤–å›´çŸ©å½¢æ¡†, åŒ…å« x,y,width,height
node.updateExtInfo({ title: 'xxx' }) // è®¾ç½®æ‰©å±•æ•°æ®, å“åº”å¼ä¼šåˆ·æ–°èŠ‚ç‚¹
node.getExtInfo<T>() // è·å–æ‰©å±•æ•°æ®
node.getNodeRegister() // æ‹¿åˆ°å½“å‰èŠ‚ç‚¹çš„å®šä¹‰

node.dispose() // åˆ é™¤èŠ‚ç‚¹

// renderData æ˜¯ èŠ‚ç‚¹ uiç›¸å…³æ•°æ®
const renderData = node.renderData
renderData.node // å½“å‰èŠ‚ç‚¹çš„domNode
renderData.expanded // å½“å‰èŠ‚ç‚¹æ˜¯å¦å±•å¼€ï¼Œå¯ä»¥è®¾ç½®

// æ‹¿åˆ°æ‰€æœ‰ä¸Šæ¸¸è¾“å…¥å’Œè¾“å‡ºèŠ‚ç‚¹ï¼ˆè‡ªç”±è¿çº¿å¸ƒå±€ï¼‰
node.getData<WorkflowNodeLinesData>(WorkflowNodeLinesData).allInputNodes
node.getData<WorkflowNodeLinesData>(WorkflowNodeLinesData).allOutputNodes
```

## Playground ï¼ˆç”»å¸ƒï¼‰

```ts
// é€šè¿‡ hook è·å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ctx
const playground = useService(Playground)

// æ»šåŠ¨åˆ°æŒ‡å®šçš„èŠ‚ç‚¹å¹¶å±…ä¸­
ctx.playground.config.scrollToView({
   entities: [node]
   scrollToCenterï¼š true
   easing: true // ç¼“åŠ¨åŠ¨ç”»
})

// æ»šåŠ¨ç”»å¸ƒ
ctx.playground.config.scroll({
  scrollX: 0
  scrollY: 0
})

// é€‚é…å±å¹•
ctx.playground.config.fitView(
  doc.root.getData<FlowNodeTransformData>().bounds, // éœ€è¦å±…ä¸­çš„çŸ©å½¢æ¡†ï¼Œè¿™é‡Œæ‹¿èŠ‚ç‚¹æ ¹èŠ‚ç‚¹çš„å¤§å°ä»£è¡¨æœ€å¤§çš„æ¡†
  trueï¼Œ // æ˜¯å¦ç¼“åŠ¨
  20, // paddingï¼Œç•™å‡ºç©ºç™½é—´è·
)

// ç¼©æ”¾
ctx.playground.config.zoomin()
ctx.playground.config.zoomout()
ctx.playground.config.finalScale // å½“å‰ç¼©æ”¾æ¯”ä¾‹
```

## SelectionService (é€‰æ‹©å™¨)

```ts
const selectionService = useService<SelectionService>()

selection.selection // è¿”å›å½“å‰é€‰ä¸­çš„èŠ‚ç‚¹æ•°ç»„ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ï¼Œå¦‚é€‰ä¸­èŠ‚ç‚¹ seleciton.selection = [node]

selection.onSelectionChanged(() => {}) // ç›‘å¬å˜åŒ–
```



---
url: /api/index.md
---




---
url: /api/plugins.md
---

è¿™é‡Œæ˜¯å®˜ç½‘ api é…ç½®ï¼Œdemo ç”¨ã€‚



---
url: /api/plugins/config-basic.md
---

# Basic Config

## root

* Type: `string`
* Default: `docs`

Specifies the document root directory. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  root: 'docs',
});
```

This config supports both relative and absolute paths, with relative paths being relative to the current working directory(cwd).

Of course, in addition to specifying the document root directory through the config file, you can also specify it through command line parameters, such as:

```bash
rspress dev docs
rspress build docs
```

## base

* Type: `string`
* Default: `/`

Deployment base path. For example, if you plan to deploy your site to `https://foo.github.io/bar/`, then you should set `base` to `"/bar/"`:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  base: '/bar/',
});
```

## title

* Type: `string`
* Default: `"Rspress"`

Site title. This parameter will be used as the title of the HTML page. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  title: 'My Site',
});
```

## description

* Type: `string`
* Default: `""`

Site description. This will be used as the description of the HTML page. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  description: 'My Site Description',
});
```

## icon

* Type: `string`
* Default: `""`

Site icon. This path will be used as the icon path for the HTML page. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  icon: '/favicon.ico',
});
```

The framework will find your icon in the `public` directory, of course you can also set it to a CDN address.

## logo \{#logo-1}

* Type: `string | { dark: string; light: string }`
* Default: `""`

Site logo. This path will be used as the logo path in the upper left corner of the navbar. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  logo: '/logo.png',
});
```

The framework will find your icon in the `public` directory, you can also set it to a CDN address.

Of course you can set different logos for dark/light mode:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  logo: {
    dark: '/logo-dark.png',
    light: '/logo-light.png',
  },
});
```

## logoText

* Type: `string`
* Default: `""`

Site logo Text. This text will be used as the logo text in the upper left corner of the navbar. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  logoText: 'rspress',
});
```

## outDir

* Type: `string`
* Default: `doc_build`

Custom output directory for built sites. for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  outDir: 'doc_build',
});
```

## locales

* Type: `Locale[]`

```ts
export interface Locale {
  lang: string;
  label: string;
  title?: string;
  description?: string;
}
```

I18n config of the site. for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  locales: [
    {
      lang: 'en-US',
      label: 'English',
      title: 'Doc Tools',
      description: 'Doc Tools',
    },
    {
      lang: 'zh-CN',
      label: 'ç®€ä½“ä¸­æ–‡',
      title: 'æ–‡æ¡£æ¡†æ¶',
      description: 'æ–‡æ¡£æ¡†æ¶',
    },
  ],
});
```

## head

* Type: `string` | `[string, Record<string, string>]` | `(route) => string | [string, Record<string, string>] | undefined`
* Can be appended per page via [frontmatter](/zh/api/plugins/config-frontmatter.md#head)

Additional elements to render in the `<head>` tag in the page HTML.

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  // ... other user config
  head: [
    '<meta name="author" content="John Doe">',
    // or
    ['meta', { name: 'author', content: 'John Doe' }],
    // [htmlTag, { attrName: attrValue, attrName2: attrValue2 }]
    // or
    (route) => {
      if (route.routePath.startsWith('/jane/')) return "<meta name='author' content='Jane Doe'>";
      if (route.routePath.startsWith('/john/')) return ['meta', { name: 'author', content: 'John Doe' }];
      \\ or even skip returning anything
      return undefined;
    }
  ]
});
```

## mediumZoom

* Type: `boolean` | `{ selector?: string }`
* Default: `true`

Whether to enable the image zoom function. It is enabled by default, you can disable it by setting `mediumZoom` to `false`.

> The bottom layer is implemented using the [medium-zoom](https://github.com/francoischalifour/medium-zoom) library.

Example usage:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  // Turn off image zoom
  mediumZoom: false,
  // Configure the CSS selector to customize the picture to be zoomed, the default is '.rspress-doc img'
  mediumZoom: {
    selector: '.rspress-doc img',
  },
});
```

## search

* Type: `{ searchHooks: string; versioned: boolean; }`

### searchHooks

You can add search runtime hooks logic through the `searchHooks` parameter, for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';
import path from 'path';

export default defineConfig({
  search: {
    searchHooks: path.join(__dirname, 'searchHooks.ts'),
  },
});
```

For specific hook logic, you can read [Customize Search Functions](/guide/advanced/custom-search.md).

### versioned

If you are using `multiVersion`, the `versioned` parameter allows you to create a separate search index for each version of your documentation.
When enabled, the search will only query the index corresponding to the currently selected version.

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  search: {
    versioned: true,
  },
});
```

## globalUIComponents

* Type: `(string | [string, object])[]`
* Default: `[]`

You can register global UI components through the `globalUIComponents` parameter, for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';
import path from 'path';

export default defineConfig({
  globalUIComponents: [path.join(__dirname, 'components', 'MyComponent.tsx')],
});
```

The item of `globalUIComponents` can be a string, which is the path of the component file, or an array, the first item is the path of the component file, and the second item is the component props, for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  globalUIComponents: [
    [
      path.join(__dirname, 'components', 'MyComponent.tsx'),
      {
        foo: 'bar',
      },
    ],
  ],
});
```

## multiVersion

* Type: `{ default: string; versions: string[] }`

You can enable multi-version support through the `multiVersion` parameter, for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  multiVersion: {
    default: 'v1',
    versions: ['v1', 'v2'],
  },
});
```

The `default` parameter is the default version, and the `versions` parameter is the version list.

## route

* Type: `Object`

Custom route config.

### route.include

* Type: `string[]`
* Default: `[]`

Add some extra files in the route. By default, only the files in the document root directory will be included in the route. If you want to add some extra files to the route, you can use this option. For example:

```js
import { defineConfig } from 'rspress/config';

export default defineConfig({
  route: {
    include: ['other-dir/**/*.{md,mdx}'],
  },
});
```

> Note: The strings in the array support glob patterns, the glob expression should be based on the `root` directory of the document, with the corresponding extensions suffix.

:::note

We recommend using [addPages hook](/plugin/system/plugin-api.md#addpages) in a custom Rspress plugin to add some additional files to the route, so that the page route and file path/content can be specified more flexibly and reasonably.

:::

### route.exclude

* Type: `string[]`
* Default: `[]`

Exclude some files from the route. For example:

```js
import { defineConfig } from 'rspress/config';

export default defineConfig({
  route: {
    exclude: ['custom.tsx', 'component/**/*'],
  },
});
```

> Note: The strings in the array support glob patterns, the glob expression should be based on the `root` directory of the document.

### route.extensions

* Type: `string[]`
* Default: `[]`

The extensions of the files that will be included in the route. By default, Rspress will include all `'js'`, `'jsx'`, `'ts'`, `'tsx'`, `'md'`, `'mdx'` files in the route. If you want to customize the extensions, you can use this option. For example:

```js
import { defineConfig } from 'rspress/config';

export default defineConfig({
  route: {
    extensions: ['.jsx', '.md', '.mdx'],
  },
});
```

### route.cleanUrls

* Type: `Boolean`
* Default: `false`

Generate url without suffix when `cleanUrls` is `true` for shorter url link.

```js
import { defineConfig } from 'rspress/config';

export default defineConfig({
  route: {
    cleanUrls: true,
  },
});
```

## ssg

* Type: `boolean | { strict?: boolean }`
* Default: `true`

Determines whether to enable Static Site Generation. It is enabled by default, but you can disable it by setting `ssg` to `false`.

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  ssg: false,
});
```

If SSG fails, it will fallback to CSR by default. You can set `ssg` to `{ strict: true }` to strictly require SSG to succeed, otherwise an error will be thrown.

```ts title="rspress.config.ts"
export default {
  ssg: {
    strict: true,
  },
};
```

## replaceRules

* Type: `{ search: string | RegExp; replace: string; }[]`
* Default: `[]`

You can set text replacement rules for the entire site through `replaceRules`. The rules will apply to everything including `_meta.json` files, frontmatter configurations, and document content and titles.

```ts title="rspress.config.ts"
export default {
  replaceRules: [
    {
      search: /foo/g,
      replace: 'bar',
    },
  ],
};
```



---
url: /api/plugins/config-build.md
---

# Build Config

## builderConfig

* Type: `RsbuildConfig`

Used to customize the configurations of Rsbuild. For detailed configurations, please refer to [Rsbuild - Config](https://rsbuild.dev/config/).

* Example: Use [resolve.alias](https://rsbuild.dev/config/resolve/alias) to configure path aliases:

```ts title="rspress.config.ts"
export default defineConfig({
  builderConfig: {
    resolve: {
      alias: {
        '@common': './src/common',
      },
    },
  },
});
```

* Example: Use [tools.rspack](https://rsbuild.dev/config/tools/rspack) to modify the Rspack configuration, such as registering a webpack or Rspack plugin:

```ts title="rspress.config.ts"
export default defineConfig({
  builderConfig: {
    tools: {
      rspack: async config => {
        const { default: ESLintPlugin } = await import('eslint-webpack-plugin');
        config.plugins?.push(new ESLintPlugin());
        return config;
      },
    },
  },
});
```

::: warning

If you want to modify the output directory, please use [outDir](/api/config/config-basic.md#outdir).

:::

## builderPlugins

* Type: `RsbuildPlugin[]`

Used to register [Rsbuild plugins](https://rsbuild.dev/plugins/list/).

You can use the rich plugins of Rsbuild in the Rspress project to quickly extend the building capabilities.

* Example: Support Vue SFC through [@rsbuild/plugin-vue](https://rsbuild.dev/plugins/list/plugin-vue)

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';
import { pluginVue } from '@rsbuild/plugin-vue';

export default defineConfig({
  builderPlugins: [pluginVue()],
});
```

* Example: Add Google analytics through [rsbuild-plugin-google-analytics](https://github.com/rspack-contrib/rsbuild-plugin-google-analytics)

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';
import { pluginGoogleAnalytics } from 'rsbuild-plugin-google-analytics';

export default defineConfig({
  builderPlugins: [
    pluginGoogleAnalytics({
      // replace this with your Google tag ID
      id: 'G-xxxxxxxxxx',
    }),
  ],
});
```

* Example: Add Open Graph meta tags through [rsbuild-plugin-open-graph](https://github.com/rspack-contrib/rsbuild-plugin-open-graph)

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';
import { pluginOpenGraph } from 'rsbuild-plugin-open-graph';

export default defineConfig({
  builderPlugins: [
    pluginOpenGraph({
      title: 'My Website',
      type: 'website',
      // ...options
    }),
  ],
});
```

You can also override the built-in plugins [@rsbuild/plugin-react](https://rsbuild.dev/plugins/list/plugin-react), [@rsbuild/plugin-sass](https://rsbuild.dev/plugins/list/plugin-sass) and [@rsbuild/plugin-less](https://rsbuild.dev/plugins/list/plugin-less), and customize relevant plugin options.

* Example: Modify related options of built-in [@rsbuild/plugin-less](https://rsbuild.dev/plugins/list/plugin-less) plugin

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';
import { pluginLess } from '@rsbuild/plugin-less';

export default defineConfig({
  builderPlugins: [
    pluginLess({
      lessLoaderOptions: {
        lessOptions: {
          math: 'always',
        },
      },
    }),
  ],
});
```

### Default Config

If you need to view the default Rspack or Rsbuild configs, you can add the `DEBUG=rsbuild` parameter when running the `rspress dev` or `rspress build` command:

```bash
DEBUG=rsbuild rspress dev
```

After execution, the `rsbuild.config.js` file is created in the `doc_build` directory, which contains the complete `builderConfig`.

> Please refer to [Rsbuild - Debug Mode](https://rsbuild.dev/guide/debug/debug-mode) for more information on how to debug the Rsbuild.

## markdown

* Type: `Object`

Configure MDX-related compilation abilities.

### markdown.remarkPlugins

* Type: `Array`
* Default: `[]`

Configure the remark plugins. for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  markdown: {
    remarkPlugins: [
      [
        require('remark-autolink-headings'),
        {
          behavior: 'wrap',
        },
      ],
    ],
  },
});
```

### markdown.rehypePlugins

* Type: `Array`

Configure the rehype plugin. for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  markdown: {
    rehypePlugins: [
      [
        require('rehype-autolink-headings'),
        {
          behavior: 'wrap',
        },
      ],
    ],
  },
});
```

### markdown.checkDeadLinks

* Type: `boolean`
* Default: `false`

Whether to check for dead links. for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  markdown: {
    checkDeadLinks: true,
  },
});
```

After enabling this config, the framework will check the links in the document based on the conventional routing table. If there is an unreachable link, the build will throw an error and exit.

### markdown.mdxRs

* Type: `boolean | { include: (filepath: string) => boolean }`
* Default: `true`

### markdown.showLineNumbers

* Type: `boolean`

Whether to display the line number of the code block. Defaults to `false`.

### markdown.defaultWrapCode

* Type: `boolean`

Whether to enable long code line wrapping display by default. Defaults to `false`.

### markdown.globalComponents

* Type: `string[]`

Register component to the global scope, which will make it automatically available in every MDX file, without any import statements.For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';
import path from 'path';

export default defineConfig({
  markdown: {
    globalComponents: [path.join(__dirname, 'src/src/components/Alert.tsx')],
  },
});
```

Then you can use the `Alert` component in any MDX file:

```mdx title="test.mdx"
<Alert type="info">This is a info alert</Alert>
```

:::danger Danger
Please set `markdown.mdxRs` to `false` when configuring `globalComponents`, otherwise the global components will not take effect.
:::

### markdown.highlightLanguages

* Type: `[string, string][]`
* Default:

```js
const DEFAULT_HIGHLIGHT_LANGUAGES = [
  ['js', 'javascript'],
  ['ts', 'typescript'],
  ['jsx', 'tsx'],
  ['xml', 'xml-doc'],
  ['md', 'markdown'],
  ['mdx', 'tsx'],
];
```

Rspress supports automatic import of highlighted languages and makes some language aliases by default.

* By default, it is implemented based on [Prism.js](https://prismjs.com/). You can also switch to Shiki through [@rspress/plugin-shiki](/plugin/official-plugins/shiki.md).
* The default configuration alias languages include `js`, `jsx`, `ts`, `tsx`, `xml`, `md`, `mdx`.

You can also extend these default aliases, such as:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';
import path from 'path';

export default defineConfig({
  markdown: {
    highlightLanguages: [
      // Alias as md, full name as markdown
      ['md', 'markdown'],
    ],
  },
});
```

The alias of each language is configured in the format of `[string, string]`. The former is the alias of the language, and the latter is the full name of the language. You can go to [File List](https://github.com/react-syntax-highlighter/react-syntax-highlighter/tree/master/src/languages/prism) to view the full names of all supported languages.



---
url: /api/plugins/config-frontmatter.md
---

# Front Matter Config

## title

* Type: `string`

The title of the page. By default, the page's h1 heading will be used as the title of the HTML document. But if you want to use a different title, you can use Front Matter to specify the title of the page. For example:

```yaml
---
title: My Home Page
---
```

## description

* Type: `string`

A custom description for the page. For example:

```yaml
---
description: This is my custom description for this page.
---
```

## pageType

* Type: `'home' | 'doc' | 'custom' | 'blank' | '404'`
* Default: `'doc'`

The type of the page. By default, the page type is `doc`. But if you want to use a different page type, you can use the Front Matter field `pageType` to specify the page type. E.g:

```yaml
---
pageType: home
---
```

The meaning of each `pageType` config is as follows:

## titleSuffix

* Type: `string`

Set the suffix of the page title. When `titleSuffix` is not set, the site's [title](/api/config/config-basic.md#title) is used as the suffix by default.

```yaml
---
titleSuffix: 'Rspack-based Static Site Generator'
---
```

The default separator between the title and the suffix is `-`, you can also use `|` for separation:

```yaml
---
titleSuffix: '| Rspack-based Static Site Generator'
---
```

## head

* Type: `[string, Record<string, string>][]`

Specify extra head tags to be injected for the current page. Will be appended after head tags injected by site-level config.

For example, you can use these headers to specify custom meta tags for [Open Graph](https://ogp.me/).

```yaml
---
head:
  - - meta
    - property: og:title
      content: The Rock
  - - meta
    - property: og:url
      content: https://www.imdb.com/title/tt0117500/
  - - meta
    - property: og:image
      content: https://ia.media-imdb.com/images/rock.jpg
# - - [htmlTag]
#   - [attributeName]: [attributeValue]
#     [attributeName]: [attributeValue]
---
```

::: tip Note

Make sure to correctly define the header tag names and their attribute names.

For tags and attribute names that contain a hyphen (`-`), use the camelCase format.
For example, `http-equiv="refresh"` should be defined as `httpEquiv: refresh`.

This is because under the hood, headers are handled by React and react-helmet-async.

:::

## hero

* Type: `Object`

The hero config for the home page. It has the following types:

```ts
interface Hero {
  name: string;
  text: string;
  tagline: string;
  image?: {
    src: string | { dark: string; light: string };
    alt: string;
    /**
     * `srcset` and `sizes` are attributes of `<img>` tag. Please refer to https://mdn.io/srcset for the usage.
     * When the value is an array, rspress will join array members with commas.
     **/
    srcset?: string | string[];
    sizes?: string | string[];
  };
  actions: {
    text: string;
    link: string;
    theme: 'brand' | 'alt';
  }[];
}
```

For example, you can use the following Front Matter to specify a page's hero config:

```yaml
---
pageType: home

hero:
  name: Rspress
  text: A Documentation Solution
  tagline: A modern documentation development technology stack
  actions:
    - theme: brand
      text: Introduction
      link: /en/guide/introduction
    - theme: alt
      text: Quick Start
      link: /en/guide/getting-started
---
```

When setting `hero.text`, you can use the `|` symbol in YAML to manually control line breaks:

```yaml
---
pageType: home

hero:
  name: Rspress
  text: |
    A Documentation
    Solution
```

Or you can use `HTML` to specify the hero config for the page:

```yaml
---
pageType: home

hero:
  name: <span class="hero-name">Rspress</span>
  text: <span class="hero-text">A Documentation Solution</span>
  tagline: <span class="hero-tagline">A modern documentation development technology stack</span>
  actions:
    - theme: brand
      text: <span class="hero-actions-text">Introduction</span>
      link: /zh/guide/introduction
    - theme: alt
      text: <span class="hero-actions-text">Quick Start</span>
      link: /zh/guide/getting-started
---
```

## features

* Type: `Array`
* Default: `[]`

features config of the `home` page. It has the following types:

```ts
interface Feature {
  title: string;
  details: string;
  icon: string;
  // The length of the card grid, currently only support[3, 4, 6]
  span?: number;
  // The link of the feature, not required.
  link?: string;
}

export type Features = Feature[];
```

For example, you could use the following to specify the features configuration for the `home` page:

```yaml
---
pageType: home

features:
  - title: 'MDX Support'
    details: MDX is a powerful way to write content. You can use React components in Markdown.
    icon: ğŸ“¦
  - title: 'Feature Rich'
    details: Out of box support for i18n, full-text search etc.
    icon: ğŸ¨
  - title: 'Customizable'
    details: You can customize the theme ui and the build process.
    icon: ğŸš€
---
```

## sidebar

Whether to show the sidebar on the left. By default, the `doc` page will display the sidebar on the left. If you want to hide the sidebar on the left, you can use the following Front Matter config:

```yaml
---
sidebar: false
---
```

## outline

Whether to display the outline column on the right. By default, the `doc` page displays the outline column on the right. You can hide the outline column with the following config:

```yaml
---
outline: false
---
```

## footer

Whether to display the components at the bottom of the document (such as previous/next page). By default, the `doc` page will display the footer at the bottom. You can hide the footer with the following config:

```yaml
---
footer: false
---
```

## navbar

Whether to hide the top navigation bar. You can hide the top nav bar with the following config:

```yaml
---
navbar: true
---
```

## overviewHeaders

* Type: `number[]`
* Default: `[2]`

The headers shown in the overview page. By default, the displayed header is h2. But if you want to display different headers, you can specify it using the `overviewHeaders` Front Matter field. For example:

```yaml
---
overviewHeaders: []
---
```

Or

```yaml
---
overviewHeaders: [2, 3]
---
```

## context

* Type: `string`

After configuration, the `data-context` attribute will be added to the DOM node when the sidebar is generated, and the value is the configured value.

```yaml title="foo.mdx"
---
context: 'context-foo'
---
```

```yaml title="bar.mdx"
---
context: 'context-bar'
---
```

The DOM structure of the final generated sidebar is abbreviated as follows:

```html
<div class="rspress-sidebar-group">
  <div className="rspress-sidebar-item" data-context="context-foo"></div>
  <div className="rspress-sidebar-item" data-context="context-bar"></div>
</div>
```



---
url: /api/plugins/config-theme.md
---

# Theme Config

Theme config is located under `themeConfig` in the `doc` param. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    // ...
  },
});
```

## nav

* Type: `Array`
* Default: `[]`

The `nav` configuration is an array of `NavItem` with the following types:

```ts
interface NavItem {
  // Navbar text
  text: string;
  // Navbar link
  link: '/';
  // Activation rules for navbar links
  activeMatch: '^/$|^/';
  // svg tag string or image URL(optional)
  tag?: string;
}
```

`activeMatch` is used to match the current route, when the route matches the `activeMatch` rule, the nav item will be highlighted. By default, `activeMatch` is the `link` of the nav item.

For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    nav: [
      {
        text: 'Home',
        link: '/',
      },
      {
        text: 'Guide',
        link: '/guide/',
      },
    ],
  },
});
```

Of course, multi-level menus can also be configured in the `nav` array with the following types:

```ts
interface NavGroup {
  text: string;
  // submenu
  items: NavItem[];
  // svg tag string or image URL(optional)
  tag?: string;
}
```

For example the following configuration:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    nav: [
      {
        text: 'Home',
        link: '/',
      },
      {
        text: 'Guide',
        items: [
          {
            text: 'Getting Started',
            link: '/guide/getting-started',
          },
          {
            text: 'Advanced',
            link: '/guide/advanced',
          },
          // Also support sub group menu
          {
            text: 'Group',
            items: [
              {
                text: 'Personal',
                link: 'http://example.com/',
              },
              {
                text: 'Company',
                link: 'http://example.com/',
              },
            ],
          },
        ],
      },
    ],
  },
});
```

## sidebar

* Type: `Object`

The sidebar of the website. The config is an object with the following types:

```ts
// The key is the path of SidebarGroup
// value is an array of SidebarGroup
type Sidebar = Record<string, SidebarGroup[]>;

interface SidebarGroup {
  text: string;
  link?: string;
  items: SidebarItem[];
  // whether to be collapsible
  collapsible?: boolean;
  // Whether to be collapsed by default
  collapsed?: boolean;
  // svg tag string or image URL(optional)
  tag?: string;
}

// An object can be filled in, or a string can be filled in
// When filling in a string, it will be converted into an object internally, the string will be used as a link, and the text value will automatically take the title of the corresponding document
type SidebarItem =
  | {
      // sidebar text
      text: string;
      // sidebar link
      link: string;
      // svg tag string or image URL(optional)
      tag?: string;
    }
  | string;
```

For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    sidebar: {
      '/guide/': [
        {
          text: 'Getting Started',
          items: [
            // Fill in an object
            {
              text: 'Introduction',
              link: '/guide/getting-started/introduction',
            },
            {
              text: 'Installation',
              link: '/guide/getting-started/installation',
            },
          ],
        },
        {
          text: 'Advanced',
          items: [
            // Fill in the link string directly
            '/guide/advanced/customization',
            '/guide/advanced/markdown',
          ],
        },
      ],
    },
  },
});
```

## footer

* Type: `Object`
* Default: `{}`

The footer of the home page.

The `footer` config is an object of `Footer`, which has the following types:

```ts
export interface Footer {
  message?: string;
  copyright?: string;
}
```

`message` is a string that can contain HTML content. This string will be inserted into the footer using `dangerouslySetInnerHTML`, allowing you to pass in HTML template tags to design your footer.

For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    footer: {
      message:
        '<p>This is a footer with a <a href="https://example.com">link</a> and <strong>bold text</strong></p>',
    },
  },
});
```

## outlineTitle

* Type: `string`
* Default: 'ON THIS PAGE'

Configure the title of the outline in the outline panel.

For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    outlineTitle: 'Outline',
  },
});
```

## lastUpdated

* Type: `boolean`
* Default: `false`

Whether to display the last update time, it is not displayed by default.

For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    lastUpdated: true,
  },
});
```

## lastUpdatedText

* Type: `string`
* Default: `Last Updated`

The text of the last update time.

For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    lastUpdatedText: 'Last Updated',
  },
});
```

## prevPageText

* Type: `string`
* Default: `Previous Page`

The text of the previous page. for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    prevPageText: 'Previous Page',
  },
});
```

## searchPlaceholderText

* Type: `string`
* Default: `Search Docs`

The placeholder text of the search box. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    searchPlaceholderText: 'Search Docs',
  },
});
```

## searchNoResultsText

* Type: `string`
* Default: `No results for`

The text of no search result. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    searchNoResultsText: 'No results for',
  },
});
```

## searchSuggestedQueryText

* Type: `string`
* Default: `Please try again with a different keyword`

The text of suggested query text when no search result. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    searchSuggestedQueryText: 'Please search again',
  },
});
```

## overview

* Type: `Object`

The config of overview page/component. The config is an object with the following types:

```ts
interface FilterConfig {
  filterNameText?: string;
  filterPlaceholderText?: string;
  filterNoResultText?: string;
}
```

For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    overview: {
      filterNameText: 'Filter',
      filterPlaceholderText: 'Enter keyword',
      filterNoResultText: 'No matching API found',
    },
  },
});
```

## socialLinks

* Type: `Array`
* Default: `[]`

You can add related links through the following config, such as `github` links, `x` links, etc.
Related links support four modes: `link mode` `text mode` `image mode` `dom mode`, for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    socialLinks: [
      {
        icon: 'github',
        mode: 'link',
        content: 'https://github.com/sanyuan0704/island.js',
      },
      {
        icon: 'wechat',
        mode: 'text',
        content: 'wechat: foo',
      },
      {
        icon: 'qq',
        mode: 'img',
        content: '/qrcode.png',
      },
      {
        icon: 'github',
        mode: 'dom',
        content:
          '<img loading="lazy" src="https://lf3-static.bytednsdoc.com/obj/eden-cn/rjhwzy/ljhwZthlaukjlkulzlp/rspress/rspress-navbar-logo-0904.png" alt="logo" id="logo" class="mr-4 rspress-logo dark:hidden">',
      },
    ],
  },
});
```

* When in `link` mode, click the icon to jump to the link.
* When in `text` mode, when the mouse moves over the icon, a pop-up box will be displayed, and the content of the pop-up box is the entered text
* When in the `img` mode, moving the mouse over the icon will display a bullet box, and the content of the bullet box is the specified picture. It should be noted that the picture needs to be placed in the `public` directory.
* When in dom mode, html to render can be passed directly into the content field. Use '' for wrapping

Related links support the following types of images, which can be selected through the icon attribute:

```ts
export type SocialLinkIcon =
  | 'lark'
  | 'discord'
  | 'facebook'
  | 'github'
  | 'instagram'
  | 'linkedin'
  | 'slack'
  | 'x'
  | 'twitter'
  | 'youtube'
  | 'wechat'
  | 'qq'
  | 'juejin'
  | 'zhihu'
  | 'bilibili'
  | 'weibo'
  | 'gitlab'
  | 'X'
  | { svg: string };
```

If you need to customize the icon, you can pass in an object with `svg attribute`, and the value of svg is the content of the custom icon, for example:

```js
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    socialLinks: [
      {
        icon: {
          svg: '<svg>foo</svg>',
        },
        mode: 'link',
        content: 'https://github.com/',
      },
    ],
  },
});
```

## nextPageText

* Type: `string`
* Default: `Next Page`

Text for the next page. for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    nextPageText: 'Next Page',
  },
});
```

## locales

* Type: `Array<LocaleConfig>`
* Default: `undefined`

I18n config. This config is an array, and every item of it is `LocaleConfig`, and the types are as follows:

```ts
export interface LocaleConfig {
  /**
   * General locale config for site, which will have a higher priority than `locales`
   */
  // language name
  lang?: string;
  // HTML title, takes precedence over `themeConfig.title
  title?: string;
  // HTML description, takes precedence over `themeConfig.description`
  description?: string;
  // Display text for the corresponding language
  label: string;
  /**
   * Locale config for theme.
   */
  // Right outline title
  outlineTitle?: string;
  // Whether to display the outline title
  outline?: boolean;
  // Whether to display the last update time
  lastUpdated?: boolean;
  // Last update time text
  lastUpdatedText?: string;
  // Previous text
  prevPageText?: string;
  // Next page text
  nextPageText?: string;
  // Search box placeholder text
  searchPlaceholderText?: string;
  // The text of no search result
  searchNoResultsText?: string;
  // The text of suggested query text when no search result
  searchSuggestedQueryText?: string;
}
```

`LocaleConfig` contains many of the same configuration options as the theme config, but the former will have a higher priority.

## darkMode

* Type: `boolean`
* Default: `true`

Whether a Dark/Light mode toggle button appears. for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    darkMode: true,
  },
});
```

You can also specify the default theme mode through inject global variable into html template, for example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  builderConfig: {
    html: {
      tags: [
        {
          tag: 'script',
          // Specify the default theme mode, which can be `dark` or `light`
          children: "window.RSPRESS_THEME = 'dark';",
        },
      ],
    },
  },
});
```

## hideNavbar

* Type: `"always" | "auto" | "never"`
* Default: `never`

Control the behavior of the hidden navigation bar. By default, the navigation bar will always display. You can set it to `auto` to **automatically hide when the page scrolls down**, or set it to `always` to hidden it all the time.

For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    hideNavbar: 'auto',
  },
});
```

## enableContentAnimation

* Type: `boolean`
* Default: `false`

Whether there is animation effect when switching between pages. It is implemented with [View Transition API](https://developer.mozilla.org/docs/Web/API/View_Transitions_API). For example:

> The animation is not configurable for now.

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    enableContentAnimation: true,
  },
});
```

## enableAppearanceAnimation

* Type: `boolean`
* Default: `false`

Whether there is animation effect when switching between light and dark theme. It is implemented with [View Transition API](https://developer.mozilla.org/docs/Web/API/View_Transitions_API). For example:

> The animation is not configurable for now.

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    enableAppearanceAnimation: true,
  },
});
```

## search

* Type: `boolean`
* Default: `true`

Whether to display the search box. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    search: false,
  },
});
```

## sourceCodeText

* Type: `string`
* Default: `Source`

The text of the source code button. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    sourceCodeText: 'Source',
  },
});
```

## enableScrollToTop

* Type: `boolean`
* Default: `false`

Enable scroll to top button on documentation. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    enableScrollToTop: true,
  },
});
```

## localeRedirect

* Type: `'auto' | 'never'`
* Default: `'auto'`

Whether to redirect to the locale closest to `window.navigator.language` when the user visits the site, the default is `auto`, which means that the user will be redirected on the first visit. If you set it to `never`, the user will not be redirected. For example:

```ts title="rspress.config.ts"
import { defineConfig } from 'rspress/config';

export default defineConfig({
  themeConfig: {
    localeRedirect: 'never',
  },
});
```



---
url: /api/core/flow-document.md
---

# FlowDocument

æµç¨‹æ•°æ®æ–‡æ¡£ (å›ºå®šå¸ƒå±€), å­˜å‚¨æµç¨‹çš„æ‰€æœ‰èŠ‚ç‚¹æ•°æ®

[> API Detail](https://flowgram.ai/auto-docs/document/classes/FlowDocument.html)

```ts pure
import { useClientContext } from '@flowgram.ai/fixed-layout-editor'

const ctx = useClientContext();
console.log(ctx.document)
```

:::danger
å¯¹èŠ‚ç‚¹çš„æ“ä½œæœ€å¥½é€šè¿‡ [ctx.operation](/api/services/flow-operation-service.md) è¿›è¡Œæ“ä½œ, è¿™æ ·æ‰èƒ½ç»‘å®šåˆ° redo/undo
:::

## root

è·å–ç”»å¸ƒçš„æ ¹èŠ‚ç‚¹ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æŒ‚åœ¨æ ¹èŠ‚ç‚¹ä¸‹è¾¹

```ts pure
console.log(ctx.document.root);
```

## originTree

ç”»å¸ƒçœŸå®çš„èŠ‚ç‚¹æ ‘

```ts pure
// ç›‘å¬èŠ‚ç‚¹æ ‘çš„å˜åŒ–ï¼Œå¦‚ èŠ‚ç‚¹æ·»åŠ /åˆ é™¤/ç§»åŠ¨
const refresh = useRefresh()
useEffect(() => {
  const toDispose = ctx.document.originTree.onTreeChange(() => {
    // Tree Change
    refresh()
  });
  return () => toDispose.dispose()
}, [])
```

## renderTree

ç”»å¸ƒæ¸²æŸ“æ—¶çš„èŠ‚ç‚¹æ ‘ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œæ¸²æŸ“çš„æ ‘ä¼šéšç€èŠ‚ç‚¹åˆ†æ”¯æŠ˜å è€Œå˜åŒ–ï¼Œå¹¶éçœŸå®çš„æ ‘

## getAllNodes

è·å–æ‰€æœ‰èŠ‚ç‚¹æ•°æ®

```ts pure
const nodes = ctx.document.getAllNodes();
```

## getNode

é€šè¿‡æŒ‡å®š id è·å–èŠ‚ç‚¹

```ts pure
ctx.document.getNode('start')
```

## getNodeRegistry

è·å–èŠ‚ç‚¹çš„å®šä¹‰, èŠ‚ç‚¹å®šä¹‰å¯ä»¥æ ¹æ®ä¸šåŠ¡è‡ªå·±æ‰©å±•é…ç½®é¡¹

```ts pure
const startNodeRegistry = ctx.document.getNodeRegistry<FlowNodeRegistry>('start')
```

## fromJSON/toJSON

å¯¼å…¥å’Œå¯¼å‡ºæ•°æ®

```ts pure
const json = ctx.document.toJSON();
ctx.document.fromJSON(json);
```

## registerFlowNodes

æ³¨å†ŒèŠ‚ç‚¹çš„é…ç½®é¡¹ç›®, æ”¯æŒç»§æ‰¿

```ts pure
const node1: FlowNodeRegistry = {
  type: 'node1',
  meta: {}
}

const node2: FlowNodeRegistry = {
  type: 'node2',
  extend: 'node1' // ç»§æ‰¿ node1 çš„é…ç½®
}
ctx.document.registerFlowNodes(node1, node2)
```

## addNode

æ·»åŠ èŠ‚ç‚¹

```ts pure
ctx.document.addNode({
  id: 'node1',
  type: 'start',
  meta: {},
  data: {},
  parent: ctx.document.root // å¯ä»¥æŒ‡å®šçˆ¶èŠ‚ç‚¹
});

```

## addFromNode

æ·»åŠ åˆ°æŒ‡å®šèŠ‚ç‚¹çš„åè¾¹

```ts pure
ctx.document.addFromNode(
 ctx.document.getNode('start'),
 { id: 'node1', type: 'custom', data: {} }
);

```

## addBlock

ä¸ºæŒ‡å®šèŠ‚ç‚¹æ·»åŠ åˆ†æ”¯èŠ‚ç‚¹

```ts pure

ctx.document.addBlock(ctx.document.getNode('condition'), { id: 'if_1', type: 'block', data: {} })
```

## removeNode

åˆ é™¤èŠ‚ç‚¹

```ts pure
ctx.document.removeNode('node1');
```

## onNodeCreate/onNodeUpdate/onNodeDispose

èŠ‚ç‚¹åˆ›å»º/æ›´æ–°/é”€æ¯äº‹ä»¶, è¿”å›äº‹ä»¶çš„æ³¨é”€å‡½æ•°

```tsx pure

useEffect(() => {
  const toDispose1 = ctx.document.onNodeCreate((node) => {
    console.log('onNodeCreate', node);
  });
  const toDispose2 = ctx.document.onNodeUpdate((node) => {
    console.log('onNodeUpdate', node);
  });
  const toDispose3 = ctx.document.onNodeDispose((node) => {
    console.log('onNodeDispose', node);
  });
  return () => {
    toDispose1.dispose()
    toDispose2.dispose()
    toDispose3.dispose()
  }
}, []);
```

## traverse

ä»æŒ‡å®šèŠ‚ç‚¹éå†æ‰€æœ‰å­èŠ‚ç‚¹, é»˜è®¤æ ¹èŠ‚ç‚¹

```ts pure
/**
 *
 * traverse all nodes, O(n)
 *   R
 *   |
 *   +---1
 *   |   |
 *   |   +---1.1
 *   |   |
 *   |   +---1.2
 *   |   |
 *   |   +---1.3
 *   |   |    |
 *   |   |    +---1.3.1
 *   |   |    |
 *   |   |    +---1.3.2
 *   |   |
 *   |   +---1.4
 *   |
 *   +---2
 *       |
 *       +---2.1
 *
 *  sort: [1, 1.1, 1.2, 1.3, 1.3.1, 1.3.2, 1.4, 2, 2.1]
 */
ctx.document.traverse((node, depth, index) => {
  console.log(node.id);
}, ctx.document.root);
```

## toString

è¿”å›èŠ‚ç‚¹ç»“æ„çš„å­—ç¬¦ä¸²å¿«ç…§

```ts pure
console.log(ctx.document.toString())
```



---
url: /api/core/flow-node-entity.md
---

# FlowNodeEntity/WorkflowNodeEntity

èŠ‚ç‚¹å®ä½“ï¼Œ`WorkflowNodeEntity` ä¸ºèŠ‚ç‚¹åˆ«åç”¨äºè‡ªç”±å¸ƒå±€èŠ‚ç‚¹, èŠ‚ç‚¹å®ä½“é‡‡ç”¨ [ECS](/guide/concepts/ecs.md) æ¶æ„, ä¸º `Entity`

[> API Detail](https://flowgram.ai/auto-docs/document/classes/FlowNodeEntity-1.html)

## Properties

* id: `string` èŠ‚ç‚¹ id
* flowNodeType: `string` | `number` èŠ‚ç‚¹ç±»å‹
* version `number` èŠ‚ç‚¹ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨äºåˆ¤æ–­èŠ‚ç‚¹çŠ¶æ€æ˜¯å¦æ›´æ–°

## Accessors

* document: `FlowDocument | WorkflowDocument` æ–‡æ¡£é“¾æ¥
* bounds: `Rectangle` è·å–èŠ‚ç‚¹çš„ xï¼Œyï¼Œwidthï¼Œheight, ç­‰ä»·äº `transform.bounds`
* blocks: `FlowNodeEntity[]` è·å–å­èŠ‚ç‚¹, åŒ…å«æŠ˜å çš„å­èŠ‚ç‚¹, ç­‰ä»·äº `collapsedChildren`
* collapsedChildren: `FlowNodeEntity[]` è·å–å­èŠ‚ç‚¹, åŒ…å«æŠ˜å çš„å­èŠ‚ç‚¹
* allCollapsedChildren: `FlowNodeEntity[]` è·å–æ‰€æœ‰å­èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬æ‰€æœ‰æŠ˜å çš„å­èŠ‚ç‚¹
* children: `FlowNodeEntity[]` è·å–å­èŠ‚ç‚¹, ä¸åŒ…å«æŠ˜å çš„å­èŠ‚ç‚¹
* pre: `FlowNodeEntity | undefined` è·å–ä¸Šä¸€ä¸ªèŠ‚ç‚¹
* next: `FlowNodeEntity | undefined` è·å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
* parent: `FlowNodeEntity | undefined` è·å–çˆ¶èŠ‚ç‚¹
* originParent: `FlowNodeEntity | undefined` è·å–åŸå§‹çˆ¶èŠ‚ç‚¹, è¿™ä¸ªç”¨äºå›ºå®šå¸ƒå±€åˆ†æ”¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹(orderIcon) æ‰¾åˆ°æ•´ä¸ªè™šæ‹Ÿåˆ†æ”¯
* allChildren: `FlowNodeEntity[]` è·å–æ‰€æœ‰å­èŠ‚ç‚¹, ä¸åŒ…å«æŠ˜å çš„å­èŠ‚ç‚¹
* transform: [FlowNodeTransformData](https://flowgram.ai/auto-docs/document/classes/FlowNodeTransformData.html) è·å–èŠ‚ç‚¹çš„ transform çŸ©é˜µæ•°æ®
* renderData: [FlowNodeRenderData](https://flowgram.ai/auto-docs/document/classes/FlowNodeRenderData.html) è·å–èŠ‚ç‚¹çš„æ¸²æŸ“æ•°æ®, åŒ…å«æ¸²æŸ“çŠ¶æ€ç­‰

## Methods

### getExtInfo

è·å–èŠ‚ç‚¹çš„æ‰©å±•ä¿¡æ¯, å¯ä»¥é€šè¿‡ `updateExtInfo` æ›´æ–°æ‰©å±•ä¿¡æ¯

```
node.getExtInfo<{ test: string }>()
```

### updateExtInfo

æ›´æ–°æ‰©å±•æ•°æ®, æ›´æ–°ä¸ä¼šè®°å½•åˆ° `redo/undo`, å¦‚æœéœ€è¦è®°å½•ï¼Œè¯·å®ç° [history](/guide/advanced/history.md) æœåŠ¡

```
node.updateExtInfo<{ test: string }>({
  test: 'test'
})
```

### getNodeRegistry

è·å–èŠ‚ç‚¹æ³¨å†Œå™¨, ç­‰ä»·äº `ctx.document.getNodeRegistry(node.flowNodeType)`

```ts pure
const nodeRegistry = node.getNodeRegistry<FlowNodeRegistry>()
```

### getData

ç­‰ä»·äº [ECS](/guide/concepts/ecs.md) æ¶æ„ é‡Œè·å– Entity çš„ Component

```ts pure
node.getData(FlowNodeTransformData) // transform çŸ©é˜µæ•°æ®, åŒ…å«èŠ‚ç‚¹çš„ xï¼Œyï¼Œwidthï¼Œheight ç­‰ä¿¡æ¯
node.getData(FlowNodeRenderData) // èŠ‚ç‚¹çš„æ¸²æŸ“æ•°æ®, åŒ…å«æ¸²æŸ“çŠ¶æ€ç­‰æ•°æ®
node.getData(WorkflowNodeLinesData) // è‡ªç”±å¸ƒå±€çš„çº¿æ¡æ•°æ®

```

### addData

ç­‰ä»·äº [ECS](/guide/concepts/ecs.md) æ¶æ„ é‡Œæ·»åŠ  Entity çš„ Component

```ts pure

// è‡ªå®šä¹‰ EntityData
class CustomEntityData extends EntityData<{ key0: string }> {
  static type = 'CustomEntityData';
  getDefaultData() {
    return {
      key0: 'test'
    }
  }
}

// æ·»åŠ  Enitty Component
node.addData(CustomEntityData)


// æ›´æ–° Entity Component æ•°æ®
node.getData(CustomEntityData).update({ key0: 'new value' })

```

### getService

èŠ‚ç‚¹è®¿é—® [IOC](/guide/concepts/ioc.md) æœåŠ¡

```ts pure
node.getService(SelectionService)
```

### dispose

èŠ‚ç‚¹ä»ç”»å¸ƒä¸­é”€æ¯

### onDispose

èŠ‚ç‚¹é”€æ¯äº‹ä»¶

```ts pure
useEffect(() => {
  const toDispose = node.onDispose(() => {
    console.log('Dispose node')
  })
  return () => toDispose.dispose()
}, [node])
```

### toJSON

å¯¼å‡ºèŠ‚ç‚¹æ•°æ®

:::note èŠ‚ç‚¹æ•°æ®åŸºæœ¬ç»“æ„:

* id: `string` èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†, å¿…é¡»ä¿è¯å”¯ä¸€
* meta: `object` èŠ‚ç‚¹çš„ ui é…ç½®ä¿¡æ¯ï¼Œå¦‚è‡ªç”±å¸ƒå±€çš„ `position` ä¿¡æ¯æ”¾è¿™é‡Œ
* type: `string | number` èŠ‚ç‚¹ç±»å‹ï¼Œä¼šå’Œ `nodeRegistries` ä¸­çš„ `type` å¯¹åº”
* data: `object` èŠ‚ç‚¹è¡¨å•æ•°æ®, ä¸šåŠ¡å¯è‡ªå®šä¹‰
* blocks: `array` èŠ‚ç‚¹çš„åˆ†æ”¯, é‡‡ç”¨ `block` æ›´è´´è¿‘ `Gramming`

:::



---
url: /api/core/workflow-document.md
---

# WorkflowDocument (free)

è‡ªç”±å¸ƒå±€æ–‡æ¡£æ•°æ®ï¼Œç»§æ‰¿è‡ª [FlowDocument](/api/core/flow-document.md)

[> API Detail](https://flowgram.ai/auto-docs/free-layout-core/classes/WorkflowDocument.html)

```ts pure
import { useClientContext } from '@flowgram.ai/free-layout-editor'

const ctx = useClientContext();
console.log(ctx.document)
```

:::tip
ç”±äºå†å²åŸå› ï¼Œ å¸¦ `Workflow` å‰ç¼€çš„éƒ½ä»£è¡¨è‡ªç”±å¸ƒå±€
:::

## linesManager

è‡ªç”±å¸ƒå±€çº¿æ¡ç®¡ç†ï¼Œè§ [WorkflowLinesManager](/api/core/workflow-lines-manager.md)

## createWorkflowNodeByType

æ ¹æ®èŠ‚ç‚¹ç±»å‹åˆ›å»ºè‡ªç”±å¸ƒå±€èŠ‚ç‚¹

```ts pure
const node = ctx.document.createWorkflowNodeByType(
 'custom',
  { x: 100, y: 100 },
  {
    id: 'xxxx',
    data: {}
  }
)
```

## onContentChange

ç›‘å¬è‡ªç”±å¸ƒå±€ç”»å¸ƒæ•°æ®å˜åŒ–

```ts pure

export enum WorkflowContentChangeType {
  /**
   * æ·»åŠ èŠ‚ç‚¹
   */
  ADD_NODE = 'ADD_NODE',
  /**
   * åˆ é™¤èŠ‚ç‚¹
   */
  DELETE_NODE = 'DELETE_NODE',
  /**
   * ç§»åŠ¨èŠ‚ç‚¹
   */
  MOVE_NODE = 'MOVE_NODE',
  /**
   * èŠ‚ç‚¹æ•°æ®æ›´æ–° ï¼ˆè¡¨å•å¼•æ“æ•°æ® æˆ–è€… extInfo æ•°æ®ï¼‰
   */
  NODE_DATA_CHANGE = 'NODE_DATA_CHANGE',
  /**
   * æ·»åŠ çº¿æ¡
   */
  ADD_LINE = 'ADD_LINE',
  /**
   * åˆ é™¤çº¿æ¡
   */
  DELETE_LINE = 'DELETE_LINE',
  /**
   * èŠ‚ç‚¹Metaä¿¡æ¯å˜æ›´
   */
  META_CHANGE = 'META_CHANGE',
}

export interface WorkflowContentChangeEvent {
  type: WorkflowContentChangeType;
  /**
   * å½“å‰è§¦å‘çš„å…ƒç´ çš„jsonæ•°æ®ï¼ŒtoJSON éœ€è¦ä¸»åŠ¨è§¦å‘
   */
  toJSON: () => any;
  /*
   * å½“å‰çš„äº‹ä»¶çš„ entity
   */
  entity: WorkflowNodeEntity | WorkflowLineEntity;
}

``
```



---
url: /api/core/workflow-lines-manager.md
---

# WorkflowLinesManager (free)

è‡ªç”±å¸ƒå±€çº¿æ¡ç®¡ç†, ç›®å‰æŒ‚åœ¨è‡ªç”±å¸ƒå±€ document ä¸‹è¾¹

[> API Detail](https://flowgram.ai/auto-docs/free-layout-core/classes/WorkflowLinesManager.html)

```
import { useClientContext } from '@flowgram.ai/free-layout-editor'

const ctx = useClientContext();
console.log(ctx.document.linesManager)
```

## getAllLines

è·å–æ‰€æœ‰çº¿æ¡çš„å®ä½“

```ts pure
const allLines = ctx.document.linesManager.getAllLines()

```

## createLine

åˆ›å»ºçº¿æ¡

```ts pure
// fromå’Œ to ä¸ºå¯¹åº”è¦è¿çº¿çš„èŠ‚ç‚¹idï¼Œ fromPort, toPort ä¸º ç«¯å£ id, å¦‚æœèŠ‚ç‚¹ä¸ºå•ä¸ªç«¯å£å¯ä»¥ä¸æŒ‡å®š
const line = ctx.document.linesManager.createLine({ from, to, fromPort, toPort })
```

## toJSON

å¯¼å‡ºçº¿æ¡æ•°æ®

```ts pure
const json = ctx.document.linesManager.toJSON()
```

## onAvailableLinesChange

ç›‘å¬æ‰€æœ‰çº¿æ¡çš„è¿çº¿å˜åŒ–

```ts pure
import { useEffect } from 'react'
import { useClientContext, useRefresh } from '@flowgram.ai/free-layout-editor'


function SomeReact() {
  const refresh = useRefresh()
  const linesManager = useClientContext().document.linesManager
  useEffect(() => {
      const dispose = linesManager.onAvailableLinesChange(() => refresh())
      return () => dispose.dispose()
  }, [])
  console.log(ctx.document.linesManager.getAllLines())
}
```



---
url: /api/core/workflow-line-entity.md
---

# WorkflowLineEntity (free)

è‡ªç”±å¸ƒå±€çº¿æ¡å®ä½“

[> API Detail](https://flowgram.ai/auto-docs/free-layout-core/classes/WorkflowLineEntity.html)



---
url: /api/core/playground.md
---

# Playground

ç”»å¸ƒå®ä¾‹

[> API Detail](https://flowgram.ai/auto-docs/core/classes/Playground.html)

```ts pure
const ctx = useClientContext()

console.log(ctx.playground)

```

## config

ç”»å¸ƒé…ç½®, æä¾› zoomã€scroll ç­‰çŠ¶æ€

[> API Detail](https://flowgram.ai/auto-docs/core/classes/PlaygroundConfigEntity.html)

### Properties

* zoom `number` å½“å‰ç¼©æ”¾æ¯”ä¾‹
* scrollData `{ scrollX: number, scrollY: number }` å½“å‰æ»šåŠ¨ä½ç½®
* readonlyOrDisabled ç”»å¸ƒæ˜¯å¦ä¸º readonly æˆ– disabled çŠ¶æ€
* readonly
* disabled

### fitView

èŠ‚ç‚¹é€‚åº”ç”»å¸ƒçª—å£, éœ€è¦ä¼ å…¥èŠ‚ç‚¹çš„ bounds

```ts pure
/**
 * é€‚åº”å¤§å°
 * @param bounds {Rectangle} ç›®æ ‡å¤§å°
 * @param easing {number} æ˜¯å¦å¼€å¯åŠ¨ç”»ï¼Œé»˜è®¤å¼€å¯
 * @param padding {number} è¾¹ç•Œç©ºç™½
 */
ctx.playground.config.fitView(ctx.document.root.bounds, true, 10)
```

### scrollToView

æŒ‡å®šèŠ‚ç‚¹ä½ç½®å¹¶æ»šåŠ¨åˆ°ç”»å¸ƒå¯è§åŒºåŸŸ, å¦‚æœä½ç½®å·²ç»åœ¨å¯è§åŒºåŸŸåˆ™ä¸ä¼šæ»šåŠ¨ï¼Œé™¤éåŠ ä¸Š `scrollToCenter` å¼ºåˆ¶æ»šåŠ¨

```ts pure

/**
 * è¯¦ç»†å‚æ•°è¯´æ˜
 * @param opts {PlaygroundConfigRevealOpts}
**/
interface PlaygroundConfigRevealOpts {
  entities?: Entity[]
  position?: PositionSchema // æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®ï¼Œå¹¶å±…ä¸­
  bounds?: Rectangle // æ»šåŠ¨çš„ bounds
  scrollDelta?: PositionSchema
  zoom?: number // éœ€è¦ç¼©æ”¾çš„æ¯”ä¾‹
  easing?: boolean // æ˜¯å¦å¼€å¯ç¼“åŠ¨ï¼Œé»˜è®¤å¼€å¯
  easingDuration?: number // é»˜è®¤ 500 ms
  scrollToCenter?: boolean // æ˜¯å¦å¼ºåˆ¶æ»šåŠ¨åˆ°ä¸­å¿ƒ
}

ctx.playground.config.scrollToView({
  bounds: ctx.document.getNode('start').bounds,
})
```

### zoomin

æ”¾å¤§ç”»å¸ƒ

### zoomout

ç¼©å°ç”»å¸ƒ

### getPoseFromMouseEvent

å°†æµè§ˆå™¨é¼ æ ‡ä½ç½®è½¬æˆç”»å¸ƒåæ ‡ç³»

```ts pure

const pos: { x: number, y: number } = ctx.playground.config.getPoseFromMouseEvent(domMouseEvent)

```

### scroll

æ»šåŠ¨ç”»å¸ƒ, éœ€è¦ä¼ å…¥æ»šåŠ¨ä½ç½®, ä»¥åŠæ˜¯å¦å¹³æ»‘æ»šåŠ¨, æ»šåŠ¨æ—¶é—´

```ts pure
ctx.playground.config.scroll({ scrollX: 100, scrollY: 100 }, true, 300)
```

### getViewport

è·å–å½“å‰ç”»å¸ƒçš„è§†çª—å¤§å°

```ts pure
const viewport = ctx.playground.config.getViewport()
```



---
url: /api/hooks/use-client-context.md
---

# useClientContext

æä¾›åœ¨ react å†…éƒ¨è®¿é—®ç”»å¸ƒçš„ä¸Šä¸‹æ–‡, ç›®å‰å›ºå®šå¸ƒå±€å’Œ è‡ªç”±å¸ƒå±€æœ‰ä¸€å®šåŒºåˆ«

## å›ºå®šå¸ƒå±€

* Return: [FixedLayoutPluginContext](https://flowgram.ai/auto-docs/fixed-layout-editor/interfaces/FixedLayoutPluginContext.html)

```ts pure
import { useClientContext } from '@flowgram.ai/fixed-layout-editor'
const ctx = useClientContext()
console.log(ctx.operation) // FlowOperationService æ“ä½œæœåŠ¡
console.log(ctx.document) // FlowDocument æ•°æ®æ–‡æ¡£
console.log(ctx.playground) // Playground ç”»å¸ƒ
console.log(ctx.history) // HistoryService å†å²è®°å½•
console.log(ctx.clipboard) // ClipboardService å‰ªè´´æ¿
console.log(ctx.container) // Inversify IOC å®¹å™¨
console.log(ctx.get(MyService)) // è·å–ä»»æ„çš„ IOC æ¨¡å—ï¼Œè¯¦ç»†è§ è‡ªå®šä¹‰ Service
```

## è‡ªç”±å¸ƒå±€

* Return: [FreeLayoutPluginContext](https://flowgram.ai/auto-docs/free-layout-editor/interfaces/FreeLayoutPluginContext.html)

```ts pure
import { useClientContext } from '@flowgram.ai/free-layout-editor'
const ctx = useClientContext()
console.log(ctx.document) // WorkflowDocument æ•°æ®æ–‡æ¡£
console.log(ctx.playground) // Playground ç”»å¸ƒ
console.log(ctx.history) // HistoryService å†å²è®°å½•
console.log(ctx.selection) // SelectionService é€‰æ‹©å™¨æœåŠ¡
console.log(ctx.clipboard) // ClipboardService å‰ªè´´æ¿
console.log(ctx.container) // Inversify IOC å®¹å™¨
console.log(ctx.get(MyService)) // è·å–ä»»æ„çš„ IOC æ¨¡å—ï¼Œè¯¦ç»†è§ è‡ªå®šä¹‰ Service
```



---
url: /api/hooks/use-node-render.md
---

# useNodeRender

æä¾›èŠ‚ç‚¹æ¸²æŸ“ç›¸å…³çš„æ–¹æ³•, è¿”å›ç»“æœçš„ form ç­‰ä»·äº [getNodeForm](/api/utils/get-node-form.md)

## å›ºå®šå¸ƒå±€

* Return: [NodeRenderReturnType](https://flowgram.ai/auto-docs/fixed-layout-editor/interfaces/NodeRenderReturnType.html)

```tsx pure

import { FlowNodeEntity, useNodeRender } from '@flowgram.ai/fixed-layout-editor';

export const BaseNode = ({ node }: { node: FlowNodeEntity }) => {
  /**
   * æä¾›èŠ‚ç‚¹æ¸²æŸ“ç›¸å…³çš„æ–¹æ³•
   */
  const nodeRender = useNodeRender();
  /**
   * åªæœ‰åœ¨èŠ‚ç‚¹å¼•æ“å¼€å¯æ—¶å€™æ‰èƒ½ä½¿ç”¨è¡¨å•
   */
  const form = nodeRender.form;

  return (
    <div
      className="demo-fixed-node"
      /*
       * onMouseEnter åŠ åˆ°å›ºå®šå¸ƒå±€èŠ‚ç‚¹ä¸»è¦æ˜¯ä¸ºäº†ç›‘å¬ åˆ†æ”¯çº¿æ¡çš„ hover é«˜äº®
       **/
      onMouseEnter={nodeRender.onMouseEnter}
      onMouseLeave={nodeRender.onMouseLeave}
      onMouseDown={e => {
        // trigger drag node
        nodeRender.startDrag(e);
        e.stopPropagation();
      }}
      style={{
        /**
         * ç”¨äºç²¾ç¡®æ§åˆ¶åˆ†æ”¯èŠ‚ç‚¹çš„æ ·å¼
         * isBlockIcon: æ•´ä¸ª condition åˆ†æ”¯çš„ å¤´éƒ¨èŠ‚ç‚¹
         * isBlockOrderIcon: åˆ†æ”¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
         */
        ...(nodeRender.isBlockOrderIcon || nodeRender.isBlockIcon ? { width: 260 } : {}),
      }}
    >
      {form?.render()}
    </div>
  );
};

```

## è‡ªç”±å¸ƒå±€

* Return: [NodeRenderReturnType](https://flowgram.ai/auto-docs/free-layout-core/interfaces/NodeRenderReturnType.html)

```tsx pure
import { WorkflowNodeRenderer, useNodeRender } from '@flowgram.ai/free-layout-editor';
export const BaseNode = () => {
  const { form, node } = useNodeRender()
  return (
    <WorkflowNodeRenderer className="demo-free-node" node={node}>
      {form?.render()}
    </WorkflowNodeRenderer>
  )
}

```



---
url: /api/hooks/use-playground-tools.md
---

# usePlaygroundTools

ç”»å¸ƒå·¥å…·æ–¹æ³•

## å›ºå®šå¸ƒå±€

* Return: [PlaygroundTools](https://flowgram.ai/auto-docs/fixed-layout-editor/interfaces/PlaygroundTools.html)

```tsx pure
import { useEffect, useState } from 'react'
import { usePlaygroundTools, useClientContext } from '@flowgram.ai/fixed-layout-editor';

export function Tools() {
  const { history } = useClientContext();
  const tools = usePlaygroundTools();
  const [canUndo, setCanUndo] = useState(false);
  const [canRedo, setCanRedo] = useState(false);

  useEffect(() => {
    const disposable = history.undoRedoService.onChange(() => {
      setCanUndo(history.canUndo());
      setCanRedo(history.canRedo());
    });
    return () => disposable.dispose();
  }, [history]);

  return <div style={{ position: 'absolute', zIndex: 10, bottom: 16, left: 16, display: 'flex', gap: 8 }}>
    <button onClick={() => tools.zoomin()}>ZoomIn</button>
    <button onClick={() => tools.zoomout()}>ZoomOut</button>
    <button onClick={() => tools.fitView()}>Fitview</button>
    <button onClick={() => tools.changeLayout()}>ChangeLayout</button>
    <button onClick={() => history.undo()} disabled={!canUndo}>Undo</button>
    <button onClick={() => history.redo()} disabled={!canRedo}>Redo</button>
    <span>{Math.floor(tools.zoom * 100)}%</span>
  </div>
}
```

## è‡ªç”±å¸ƒå±€

* Return: [PlaygroundTools](https://flowgram.ai/auto-docs/free-layout-editor/interfaces/PlaygroundTools.html)

```tsx pure
import { usePlaygroundTools, useClientContext } from '@flowgram.ai/free-layout-editor';

export function Tools() {
  const { history } = useClientContext();
  const tools = usePlaygroundTools();
  const [canUndo, setCanUndo] = useState(false);
  const [canRedo, setCanRedo] = useState(false);

  useEffect(() => {
    const disposable = history.undoRedoService.onChange(() => {
      setCanUndo(history.canUndo());
      setCanRedo(history.canRedo());
    });
    return () => disposable.dispose();
  }, [history]);

  return <div style={{ position: 'absolute', zIndex: 10, bottom: 16, left: 226, display: 'flex', gap: 8 }}>
    <button onClick={() => tools.zoomin()}>ZoomIn</button>
    <button onClick={() => tools.zoomout()}>ZoomOut</button>
    <button onClick={() => tools.fitView()}>Fitview</button>
    <button onClick={() => tools.autoLayout()}>AutoLayout</button>
    <button onClick={() => history.undo()} disabled={!canUndo}>Undo</button>
    <button onClick={() => history.redo()} disabled={!canRedo}>Redo</button>
    <span>{Math.floor(tools.zoom * 100)}%</span>
  </div>
}
```



---
url: /api/hooks/use-refresh.md
---

# useRefresh

## Source Code

```ts
import { useCallback, useState } from 'react';

export function useRefresh(defaultValue?: any): (v?: any) => void {
  const [, update] = useState<any>(defaultValue);
  return useCallback((v?: any) => update(v !== undefined ? v : {}), []);
}
```

## Usage

```tsx pure
import { useRefresh } from '@flowgram.ai/fixed-layout-editor';

function Demo() {
  const refresh = useRefresh();
  return (
    <div>
      <button onClick={() => refresh()}>Refresh</button>
    </div>
  )
}

```



---
url: /api/hooks/use-service.md
---

# useService

è·å–åº•å±‚ [IOC](/guide/concepts/ioc.md) çš„æ‰€æœ‰å•ä¾‹æ¨¡å—

```ts pure

const playground = useService<Playground>(Playground)
const flowDocument = useService<FlowDocument>(FlowDocument)
const historyService = useService<HistoryService>(HistoryService)

// ç­‰ä»·
const playground1 = useClientContext().playground

// ç­‰ä»·
const playground3 = useClientContext().get<Playground>(Playground)

```

## è‡ªå®šä¹‰ Service

```tsx pure
/**
 *  inversify: https://github.com/inversify/InversifyJS
 */
import { injectable, inject } from 'inversify'
import { FlowDocument } from '@flowgram.ai/fixed-layout-editor'

@injectable()
class MyService {
  // ä¾èµ–æ³¨å…¥å•ä¾‹æ¨¡å—
  @inject(FlowDocument) flowDocument: FlowDocument
  // ...
}

import { useMemo } from 'react';
import { type FixedLayoutProps } from '@flowgram.ai/fixed-layout-editor';

function BaseNode() {
  const mySerivce = useService<MyService>(MyService)
}

export function useEditorProps(
): FixedLayoutProps {
  return useMemo<FixedLayoutProps>(
    () => ({
      // ....other props
      onBind: ({ bind }) => {
        bind(MyService).toSelf().inSingletonScope()
      },
      materials: {
        renderDefaultNode: BaseNode
      }
    }),
    [],
  );
}

```



---
url: /api/components/editor-renderer.md
---

# EditorRenderer

ç”»å¸ƒæ¸²æŸ“ç»„ä»¶ï¼Œéœ€è¦ é…åˆ `FixedLayoutEditorProvider` æˆ– `FreeLayoutEditorProvider` ä½¿ç”¨

```tsx pure
function App() {
  return (
    <FixedLayoutEditorProvider {...editorProps}>
      <EditorRenderer className="demo-editor" style={{ /* style */}}>
        {/* å¦‚æœæä¾› childrenï¼Œè¯¥å†…å®¹ä¼šæ”¾åˆ° ç”»å¸ƒ div ä¸‹è¾¹ */}
      </EditorRenderer>
    </FixedLayoutEditorProvider>
  )
}
```



---
url: /api/components/fixed-layout-editor-provider.md
---

# FixedLayoutEditorProvider

å›ºå®šå¸ƒå±€ç”»å¸ƒé…ç½®å™¨ï¼Œæ”¯æŒ ref

```tsx pure
import { FixedLayoutEditorProvider, FixedLayoutPluginContext, EditorRenderer } from '@flowgram.ai/fixed-layout-editor'

function App() {
  const ref = useRef<FixedLayoutPluginContext | undefined>();

  useEffect(() => {
    console.log(ref.current.document.toJSON())
  }, [])
  return (
    <FixedLayoutEditorProvider {...editorProps} ref={ref}>
      <EditorRenderer className="demo-editor" />
    </FixedLayoutEditorProvider>
  )
}

```



---
url: /api/components/fixed-layout-editor.md
---

# FixedLayoutEditor

å›ºå®šå¸ƒå±€ç”»å¸ƒ, ç­‰ä»·äº `FixedLayoutEditorProvider` å’Œ `EditorRenderer` çš„ç»„åˆ

```tsx pure
import { FixedLayoutEditor, FixedLayoutPluginContext } from '@flowgram.ai/fixed-layout-editor'

function App() {
  const ref = useRef<FixedLayoutPluginContext | undefined>();

  useEffect(() => {
    console.log(ref.current.document.toJSON())
  }, [])

  return (
    <FixedLayoutEditor className="demo-editor" {...editorProps} ref={ref} />
  )
}
```



---
url: /api/components/free-layout-editor-provider.md
---

# FreeLayoutEditorProvider

è‡ªç”±å¸ƒå±€ç”»å¸ƒé…ç½®å™¨ï¼Œæ”¯æŒ ref

```tsx pure
import { FreeLayoutEditorProvider, FreeLayoutPluginContext, EditorRenderer } from '@flowgram.ai/free-layout-editor'

function App() {
  const ref = useRef<FreeLayoutPluginContext | undefined>();

  useEffect(() => {
    console.log(ref.current.document.toJSON())
  }, [])
  return (
    <FreeLayoutEditorProvider {...editorProps} ref={ref}>
      <EditorRenderer className="demo-editor" />
    </FreeLayoutEditorProvider>
  )
}

```



---
url: /api/components/free-layout-editor.md
---

# FreeLayoutEditor

è‡ªç”±å¸ƒå±€ç”»å¸ƒ, ç­‰ä»·äº `FreeLayoutEditorProvider` å’Œ `EditorRenderer` çš„ç»„åˆ

```tsx pure
import { FreeLayoutEditor, FreeLayoutPluginContext } from '@flowgram.ai/free-layout-editor'

function App() {
  const ref = useRef<FreeLayoutPluginContext | undefined>();

  useEffect(() => {
    console.log(ref.current.document.toJSON())
  }, [])
  return (
    <FreeLayoutEditor className="demo-editor" {...editorProps} ref={ref} />
  )
}
```



---
url: /api/components/workflow-node-renderer.md
---

# WorkflowNodeRenderer(free)

è‡ªç”±å¸ƒå±€èŠ‚ç‚¹å®¹å™¨

## Usage

```tsx pure
import { useNodeRender, WorkflowNodeRenderer } from '@flowgram.ai/free-layout-editor';

export const BaseNode = () => {
  /**
   * æä¾›èŠ‚ç‚¹æ¸²æŸ“ç›¸å…³çš„æ–¹æ³•
   */
  const { form } = useNodeRender()
  /**
   * WorkflowNodeRenderer ä¼šæ·»åŠ èŠ‚ç‚¹æ‹–æ‹½äº‹ä»¶åŠ ç«¯å£æ¸²æŸ“ï¼Œå¦‚æœè¦æ·±åº¦å®šåˆ¶ï¼Œå¯ä»¥çœ‹è¯¥ç»„ä»¶æºä»£ç :
   * https://github.com/bytedance/flowgram.ai/blob/main/packages/client/free-layout-editor/src/components/workflow-node-renderer.tsx
   */
  return (
    <WorkflowNodeRenderer className="demo-free-node" node={props.node}>
      {
        // è¡¨å•æ¸²æŸ“é€šè¿‡ formMeta ç”Ÿæˆ
        form?.render()
      }
    </WorkflowNodeRenderer>
  )
};
```



---
url: /api/services/clipboard-service.md
---

# ClipboardService

å‰ªè´´æ¿æœåŠ¡

[> API Detail](https://flowgram.ai/auto-docs/core/interfaces/ClipboardService.html)



---
url: /api/services/command-service.md
---

# CommandService

æŒ‡ä»¤æœåŠ¡ï¼Œéœ€è¦å’Œ [Shortcuts](/guide/advanced/interactive/shortcuts.md) ä¸€èµ·ä½¿ç”¨

[> API Detail](https://flowgram.ai/auto-docs/command/interfaces/CommandService.html)

```Usage

ctx.get(CommandService).execCommand('selectAll')
```



---
url: /api/services/flow-operation-service.md
---

# FlowOperationService

èŠ‚ç‚¹æ“ä½œæœåŠ¡, ç›®å‰ç”¨äºå›ºå®šå¸ƒå±€ï¼Œè‡ªç”±å¸ƒå±€ç°é˜¶æ®µå¯é€šè¿‡ WorkflowDocument ç›´æ¥æ“ä½œ, åç»­ä¹Ÿä¼šæŠ½è±¡å‡º operation

[> API Detail](https://flowgram.ai/auto-docs/fixed-layout-editor/interfaces/FlowOperationService.html)

```typescript pure
const operationService = useService<FlowOperationService>(FlowOperationService)
operationService.addNode({ id: 'xxx', type: 'custom', data: {} })

// or
const ctx = useClientContext();
ctx.operation.addNode({ id: 'xxx', type: 'custom', data: {} })


```

## Interface

```typescript pure

export interface FlowOperationBaseService extends Disposable {
  /**
   * æ‰§è¡Œæ“ä½œ
   * @param operation å¯åºåˆ—åŒ–çš„æ“ä½œ
   * @returns æ“ä½œè¿”å›
   */
  apply(operation: FlowOperation): any;

  /**
   * æ·»åŠ èŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨åˆ™ä¸ä¼šé‡å¤åˆ›å»º
   * @param nodeJSON èŠ‚ç‚¹æ•°æ®
   * @param config é…ç½®
   * @returns æˆåŠŸæ·»åŠ çš„èŠ‚ç‚¹
   */
  addNode(nodeJSON: FlowNodeJSON, config?: AddNodeConfig): FlowNodeEntity;

  /**
   * åŸºäºæŸä¸€ä¸ªèµ·å§‹èŠ‚ç‚¹å¾€åé¢æ·»åŠ 
   * @param fromNode èµ·å§‹èŠ‚ç‚¹
   * @param nodeJSON æ·»åŠ çš„èŠ‚ç‚¹JSON
   */
  addFromNode(fromNode: FlowNodeEntityOrId, nodeJSON: FlowNodeJSON): FlowNodeEntity;

  /**
   * åˆ é™¤èŠ‚ç‚¹
   * @param node èŠ‚ç‚¹
   * @returns
   */
  deleteNode(node: FlowNodeEntityOrId): void;

  /**
   * æ‰¹é‡åˆ é™¤èŠ‚ç‚¹
   * @param nodes
   */
  deleteNodes(nodes: FlowNodeEntityOrId[]): void;

  /**
   * æ·»åŠ å—ï¼ˆåˆ†æ”¯ï¼‰
   * @param target ç›®æ ‡
   * @param blockJSON å—æ•°æ®
   * @param config é…ç½®
   * @returns
   */
  addBlock(
    target: FlowNodeEntityOrId,
    blockJSON: FlowNodeJSON,
    config?: AddBlockConfig,
  ): FlowNodeEntity;

  /**
   * ç§»åŠ¨èŠ‚ç‚¹
   * @param node è¢«ç§»åŠ¨çš„èŠ‚ç‚¹
   * @param config ç§»åŠ¨èŠ‚ç‚¹é…ç½®
   */
  moveNode(node: FlowNodeEntityOrId, config?: MoveNodeConfig): void;

  /**
   * æ‹–æ‹½èŠ‚ç‚¹
   * @param param0
   * @returns
   */
  dragNodes({ dropNode, nodes }: { dropNode: FlowNodeEntity; nodes: FlowNodeEntity[] }): void;

  /**
   * æ·»åŠ èŠ‚ç‚¹çš„å›è°ƒ
   */
  onNodeAdd: Event<OnNodeAddEvent>;
}

export interface FlowOperationService extends FlowOperationBaseService {
  /**
   * åˆ›å»ºåˆ†ç»„
   * @param nodes èŠ‚ç‚¹åˆ—è¡¨
   */
  createGroup(nodes: FlowNodeEntity[]): FlowNodeEntity | undefined;
  /**
   * å–æ¶ˆåˆ†ç»„
   * @param groupNode
   */
  ungroup(groupNode: FlowNodeEntity): void;
  /**
   * å¼€å§‹äº‹åŠ¡
   */
  startTransaction(): void;
  /**
   * ç»“æŸäº‹åŠ¡
   */
  endTransaction(): void;
  /**
   * ä¿®æ”¹è¡¨å•æ•°æ®
   * @param node èŠ‚ç‚¹
   * @param path å±æ€§è·¯å¾„
   * @param value å€¼
   */
  setFormValue(node: FlowNodeEntityOrId, path: string, value: unknown): void;
}
```



---
url: /api/services/history-service.md
---

## HistoryService

[> API Detail](https://flowgram.ai/auto-docs/fixed-history-plugin/classes/HistoryService.html)

## Redo/Undo

```tsx pure
import { useEffect, useState } from 'react'
import { useClientContext } from '@flowgram.ai/fixed-layout-editor';

export function Tools() {
  const { history } = useClientContext();
  const [canUndo, setCanUndo] = useState(false);
  const [canRedo, setCanRedo] = useState(false);

  useEffect(() => {
    const disposable = history.undoRedoService.onChange(() => {
      setCanUndo(history.canUndo());
      setCanRedo(history.canRedo());
    });
    return () => disposable.dispose();
  }, [history]);

  return <div>
    <button onClick={() => history.undo()} disabled={!canUndo}>Undo</button>
    <button onClick={() => history.redo()} disabled={!canRedo}>Redo</button>
  </div>
}
```

## æ¸²æŸ“å†å²è®°å½•

```tsx pure
import { useEffect } from 'react'
import { useRefresh, useClientContext } from '@flowgram.ai/fixed-layout-editor'

function HistoryListRender() {
  const refresh = useRefresh()
  const ctx = useClientContext()
  useEffect(() => {
    ctx.history.onApply(() => refresh())
  }, [ctx])
  return (
    <div>
      {ctx.history.historyManager.historyStack.items.map((record) => <HistoryOperations key={record.id} operations={record.operations} />)}
    </div>
  )
}
```



---
url: /api/services/selection-service.md
---

# SelectionService

ç”¨äºæ§åˆ¶é€‰æ‹©çš„èŠ‚ç‚¹

[> API Detail](https://flowgram.ai/auto-docs/core/classes/SelectionService.html)

## Usage

```tsx pure
// Listen Selection Change
ctx.selection.onSelectionChanged((nodes) => {
})
// Select All Nodes
ctx.selection.selection = ctx.document.getAllNodes()
```



---
url: /api/utils/disposable-collection.md
---

# DisposableCollection

## Usage

```ts pure

import { DisposableCollection, Disposable } from '@flowgram.ai/utils'
const disposable1: Disposable = {
  dispose() {
    console.log(1)
  },
};
const disposable2: Disposable = {
  dispose() {
    console.log(2)
  },
};
const dc = new DisposableCollection();
dc.onDispose(() => {
  console.log('end')
});

dc.pushAll([disposable1, disposable2]);
dc.dispose(); // Log: 1, 2, dispose end

```

## Source Code

https://github.com/bytedance/flowgram.ai/blob/main/packages/common/utils/src/disposable.ts



---
url: /api/utils/disposable.md
---

# Disposable

## Interface

```ts
/**
 * An object that performs a cleanup operation when `.dispose()` is called.
 *
 * Some examples of how disposables are used:
 *
 * - An event listener that removes itself when `.dispose()` is called.
 * - The return value from registering a provider. When `.dispose()` is called, the provider is unregistered.
 */
export interface Disposable {
  dispose(): void;
}
```

## Source Code

https://github.com/bytedance/flowgram.ai/blob/main/packages/common/utils/src/disposable.ts



---
url: /api/utils/emitter.md
---

# Emitter

äº‹ä»¶æ¨¡å—

## Usage

```tsx pure
import { Emitter } from '@flowgram.ai/utils'

class Doc {
  private _content = ''
  private _onContentChangeEmitter = new Emitter<string>()
  readonly onContentChange = this._onContentChangeEmitter.event
  setContent(content: string) {
    this._content = content
    this._onContentChangeEmitter.fire(content)
  }
  get content() {
    return this._content
  }
}

function App() {
  const doc1 = useMemo(() => new Doc(), [])
  const [content, updateContent] = useState(doc1.content)
  useEffect(() => {
    const toDispose = doc1.onContentChange((content) => {
      updateContent(content)
    })
    return () => toDispose.dispose()
  }, [doc1])
  return <div>{content}</div>
}


```

## Source Code

https://github.com/bytedance/flowgram.ai/blob/main/packages/common/utils/src/event.ts



---
url: /api/utils/get-node-form.md
---

# getNodeForm

è·å–èŠ‚ç‚¹çš„è¡¨å•èƒ½åŠ›ï¼Œéœ€è¦å¼€å¯ èŠ‚ç‚¹å¼•æ“æ‰èƒ½ä½¿ç”¨

[> API Detail](https://flowgram.ai/auto-docs/editor/functions/getNodeForm.html)

## Usage

```tsx pure

// 1. BaseNode
function BaseNode({ node }) {
  const form = getNodeForm(node);
  console.log(form.getValueIn('title'))
  return <div>{form?.render()}</div>
}

// 2. useNodeRender
function BaseNode() {
  const { form } = useNodeRender();
  console.log(form.getValueIn('title'))
  return <div>{form?.render()}</div>
}

```

## Return Inteface

```ts pure

export interface NodeFormProps<TValues> {
  /**
   * The initialValues of the form.
   */
  initialValues: TValues;
  /**
   * Form values. Returns a deep copy of the data in the store.
   */
  values: TValues;
  /**
   * Form state
   */
  state: FormState;
  /**
   * Get value in certain path
   * @param name path
   */
  getValueIn<TValue = FieldValue>(name: FieldName): TValue;

  /**
   * Set value in certain path.
   * It will trigger the re-rendering of the Field Component if a Field is related to this path
   * @param name path
   */
  setValueIn<TValue>(name: FieldName, value: TValue): void;
  /**
   * set form values
   */
  updateFormValues(values: any): void;
  /**
   * Render form
   */
  render: () => React.ReactNode;
  /**
   * Form value change event
   */
  onFormValuesChange: Event<OnFormValuesChangePayload>;
  /**
   * Trigger form validate
   */
  validate: () => Promise<boolean>;
  /**
   * Form validate event
   */
  onValidate: Event<FormState>;
  /**
   * Form field value change event
   */
  onFormValueChangeIn<TValue = FieldValue, TFormValue = FieldValue>(
    name: FieldName,
    callback: (payload: onFormValueChangeInPayload<TValue, TFormValue>) => void
  ): Disposable;
}

```



---
url: /guide/advanced/custom-plugin.md
---

# è‡ªå®šä¹‰æ’ä»¶

## æ’ä»¶çš„ç”Ÿå‘½å‘¨æœŸè¯´æ˜

```tsx pure

/**
  * from: https://github.com/bytedance/flowgram.ai/blob/main/packages/canvas-engine/core/src/plugin/plugin.ts
 */
import { ContainerModule, interfaces } from 'inversify';

export interface PluginBindConfig {
  bind: interfaces.Bind;
  unbind: interfaces.Unbind;
  isBound: interfaces.IsBound;
  rebind: interfaces.Rebind;
}
export interface PluginConfig<Opts, CTX extends PluginContext = PluginContext> {
  /**
   * æ’ä»¶ IOC æ³¨å†Œ, ç­‰ä»·äº containerModule
   * @param ctx
   */
  onBind?: (bindConfig: PluginBindConfig, opts: Opts) => void;
  /**
   * ç”»å¸ƒæ³¨å†Œé˜¶æ®µ
   */
  onInit?: (ctx: CTX, opts: Opts) => void;
  /**
   * ç”»å¸ƒå‡†å¤‡é˜¶æ®µï¼Œä¸€èˆ¬ç”¨äº dom äº‹ä»¶æ³¨å†Œç­‰
   */
  onReady?: (ctx: CTX, opts: Opts) => void;
  /**
   * ç”»å¸ƒé”€æ¯é˜¶æ®µ
   */
  onDispose?: (ctx: CTX, opts: Opts) => void;
  /**
   * ç”»å¸ƒæ‰€æœ‰ layer æ¸²æŸ“ç»“æŸ
   */
  onAllLayersRendered?: (ctx: CTX, opts: Opts) => void;
  /**
   * IOC æ¨¡å—ï¼Œç”¨äºæ›´åº•å±‚çš„æ’ä»¶æ‰©å±•
   */
  containerModules?: interfaces.ContainerModule[];
}

```

## åˆ›å»ºæ’ä»¶

```tsx pure
/**
 * å¦‚æœå¸Œæœ›æ’ä»¶å›ºå®šå¸ƒå±€å’Œè‡ªç”±å¸ƒå±€éƒ½èƒ½ä½¿ç”¨ï¼Œ è¯·åªç”¨
*  import { definePluginCreator } from '@flowgram.ai/core'
 */
import { definePluginCreator, FixedLayoutPluginContext } from '@flowgram.ai/fixed-layout-editor'

export interface MyPluginOptions {
  opt1: string;
}

export const createMyPlugin = definePluginCreator<MyPluginOptions, FixedLayoutPluginContext>({
  onBind: (bindConfig, opts) => {
    // æ³¨å†Œ IOC æ¨¡å—, Service å¦‚ä½•å®šä¹‰ è§ è‡ªå®šä¹‰ Service
    bindConfig.bind(MyService).toSelf().inSingletonScope()
  },
  onInit: (ctx, opts) => {
    // æ’ä»¶é…ç½®
    console.log(opts.opt1)
    // ctx å¯¹åº” FixedLayoutPluginContext æˆ–è€… FreeLayoutPluginContext
    console.log(ctx.document)
    console.log(ctx.playground)
    console.log(ctx.get<MyService>(MyService)) // è·å– IOC æ¨¡å—
  },
});
```

## æ·»åŠ æ’ä»¶

```tsx pure title="use-editor-props.ts"

// EditorProps
{
  plugins: () => [
    createMyPlugin({
      opt1: 'xxx'
    })
  ]
}
```



---
url: /guide/advanced/custom-service.md
---

# è‡ªå®šä¹‰ Service

ä¸šåŠ¡ä¸­éœ€è¦æŠ½è±¡å‡ºå•ä¾‹æœåŠ¡ä¾¿äºæ’ä»¶åŒ–ç®¡ç†

```tsx pure
import { useMemo } from 'react';
import { FlowDocument, type FixedLayoutProps, inject, injectable } from '@flowgram.ai/fixed-layout-editor'

/**
 * Docs: https://inversify.io/docs/introduction/getting-started/
 * Warning: Use decorator legacy
 *   // rsbuild.config.ts
 *   {
 *     source: {
 *       decorators: {
 *         version: 'legacy'
 *       }
 *     }
 *   }
 * Usage:
 *  1.
 *    const myService = useService(MyService)
 *    myService.save()
 *  2.
 *    const myService = useClientContext().get(MyService)
 *  3.
 *    const myService = node.getService(MyService)
 */
@injectable()
class MyService {
  // ä¾èµ–æ³¨å…¥å•ä¾‹æ¨¡å—
  @inject(FlowDocument) flowDocument: FlowDocument
  // ...
}

function BaseNode() {
  const mySerivce = useService<MyService>(MyService)
}

export function useEditorProps(
): FixedLayoutProps {
  return useMemo<FixedLayoutProps>(
    () => ({
      // ....other props
      onBind: ({ bind }) => {
        bind(MyService).toSelf().inSingletonScope()
      },
      materials: {
        renderDefaultNode: BaseNode
      }
    }),
    [],
  );
}

```



---
url: /guide/advanced/fixed-layout/composite-nodes.md
---

# å¤åˆèŠ‚ç‚¹

å¤åˆèŠ‚ç‚¹ç”±å¤šä¸ªèŠ‚ç‚¹ç»„åˆï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰çº¿æ¡ï¼Œå¦‚ åˆ†æ”¯èŠ‚ç‚¹ã€Loop èŠ‚ç‚¹ã€TryCatch èŠ‚ç‚¹:

## ä½¿ç”¨

```ts pure title="node-registries.ts"

import { FlowNodeRegistry  } from '@flowgram.ai/fixed-layout-editor';

/**
 * èŠ‚ç‚¹æ³¨å†Œ
 */
export const nodeRegistries: FlowNodeRegistry[] = [
  {
    type: 'yourCustomNodeType',
    extend: 'dynamicSplit',
  },
];

```

## å†…ç½®çš„å¤åˆèŠ‚ç‚¹

Source Code




---
url: /guide/advanced/fixed-layout/load.md
---

# åŠ è½½ä¸ä¿å­˜

ç”»å¸ƒçš„æ•°æ®é€šè¿‡ [FlowDocument](/api/core/flow-document.md) æ¥å­˜å‚¨

## ç”»å¸ƒæ•°æ®æ ¼å¼

ç”»å¸ƒæ–‡æ¡£æ•°æ®é‡‡ç”¨æ ‘å½¢ç»“æ„ï¼Œæ”¯æŒåµŒå¥—

:::note æ–‡æ¡£æ•°æ®åŸºæœ¬ç»“æ„:

* nodes `array` èŠ‚ç‚¹åˆ—è¡¨, æ”¯æŒåµŒå¥—

:::

:::note èŠ‚ç‚¹æ•°æ®åŸºæœ¬ç»“æ„:

* id: `string` èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†, å¿…é¡»ä¿è¯å”¯ä¸€
* meta: `object` èŠ‚ç‚¹çš„ ui é…ç½®ä¿¡æ¯ï¼Œå¦‚è‡ªç”±å¸ƒå±€çš„ `position` ä¿¡æ¯æ”¾è¿™é‡Œ
* type: `string | number` èŠ‚ç‚¹ç±»å‹ï¼Œä¼šå’Œ `nodeRegistries` ä¸­çš„ `type` å¯¹åº”
* data: `object` èŠ‚ç‚¹è¡¨å•æ•°æ®
* blocks: `array` èŠ‚ç‚¹çš„åˆ†æ”¯, é‡‡ç”¨ `block` æ›´è´´è¿‘ `Gramming`

:::

```tsx pure title="initial-data.tsx"
import { FlowDocumentJSON } from '@flowgram.ai/fixed-layout-editor';

/**
 * é…ç½®æµç¨‹æ•°æ®ï¼Œæ•°æ®ä¸º blocks åµŒå¥—çš„æ ¼å¼
 */
export const initialData: FlowDocumentJSON = {
  nodes: [
    // å¼€å§‹èŠ‚ç‚¹
    {
      id: 'start_0',
      type: 'start',
      data: {
        title: 'Start',
        content: 'start content'
      },
      blocks: [],
    },
    // åˆ†æ”¯èŠ‚ç‚¹
    {
      id: 'condition_0',
      type: 'condition',
      data: {
        title: 'Condition'
      },
      blocks: [
        {
          id: 'branch_0',
          type: 'block',
          data: {
            title: 'Branch 0',
            content: 'branch 1 content'
          },
          blocks: [
            {
              id: 'custom_0',
              type: 'custom',
              data: {
                title: 'Custom',
                content: 'custrom content'
              },
            },
          ],
        },
        {
          id: 'branch_1',
          type: 'block',
          data: {
            title: 'Branch 1',
            content: 'branch 1 content'
          },
          blocks: [],
        },
      ],
    },
    // ç»“æŸèŠ‚ç‚¹
    {
      id: 'end_0',
      type: 'end',
      data: {
        title: 'End',
        content: 'end content'
      },
    },
  ],
};

```

## åŠ è½½

* é€šè¿‡ initialData åŠ è½½

```tsx pure
import { FixedLayoutEditorProvider, FixedLayoutPluginContext, EditorRenderer } from '@flowgram.ai/fixed-layout-editor'

function App({ data }) {
  return (
    <FixedLayoutEditorProvider initialData={data} {...otherProps}>
      <EditorRenderer className="demo-editor" />
    </FixedLayoutEditorProvider>
  )
}
```

* é€šè¿‡ ref åŠ¨æ€åŠ è½½

```tsx pure

import { FixedLayoutEditorProvider, FixedLayoutPluginContext, EditorRenderer } from '@flowgram.ai/fixed-layout-editor'

function App() {
  const ref = useRef<FixedLayoutPluginContext | undefined>();

  useEffect(async () => {
    const data = await request('https://xxxx/getJSON')
    ref.current.document.fromJSON(data)
    setTimeout(() => {
      // åŠ è½½åè§¦å‘ç”»å¸ƒçš„ fitview è®©èŠ‚ç‚¹è‡ªåŠ¨å±…ä¸­
      ref.current.playground.config.fitView(ref.current.document.root.bounds.pad(30));
    }, 100)
  }, [])
  return (
    <FixedLayoutEditorProvider ref={ref} {...otherProps}>
      <EditorRenderer className="demo-editor" />
    </FixedLayoutEditorProvider>
  )
}
```

* åŠ¨æ€ reload æ•°æ®

```tsx pure

import { FixedLayoutEditorProvider, FixedLayoutPluginContext, EditorRenderer } from '@flowgram.ai/fixed-layout-editor'

function App({ data }) {
  const ref = useRef<FixedLayoutPluginContext | undefined>();

  useEffect(async () => {
    // å½“ data å˜åŒ–æ—¶å€™é‡æ–°åŠ è½½ç”»å¸ƒæ•°æ®
    await ref.current.document.fromJSON(data)
    setTimeout(() => {
      // åŠ è½½åè§¦å‘ç”»å¸ƒçš„ fitview è®©èŠ‚ç‚¹è‡ªåŠ¨å±…ä¸­
      ref.current.playground.config.fitView(ref.current.document.root.bounds.pad(30));
    }, 100)
  }, [data])
  return (
    <FixedLayoutEditorProvider ref={ref} {...otherProps}>
      <EditorRenderer className="demo-editor" />
    </FixedLayoutEditorProvider>
  )
}
```

## ç›‘å¬å˜åŒ–å¹¶è‡ªåŠ¨ä¿å­˜

```tsx pure

import { FixedLayoutEditorProvider, FixedLayoutPluginContext, EditorRenderer } from '@flowgram.ai/fixed-layout-editor'
import { debounce } from 'lodash'

function App() {
  const ref = useRef<FixedLayoutPluginContext | undefined>();

  useEffect(() => {
    // ç›‘å¬ç”»å¸ƒå˜åŒ– å»¶è¿Ÿ 1 ç§’ ä¿å­˜æ•°æ®, é¿å…ç”»å¸ƒé¢‘ç¹æ›´æ–°
    const toDispose = ref.current.history.onApply(debounce(() => {
        // é€šè¿‡ toJSON è·å–ç”»å¸ƒæœ€æ–°çš„æ•°æ®
        request('https://xxxx/save', {
          data: ref.current.document.toJSON()
        })
    }, 1000))
    return () => toDispose.dispose()
  }, [])
  return (
    <FixedLayoutEditorProvider ref={ref} {...otherProps}>
      <EditorRenderer className="demo-editor" />
    </FixedLayoutEditorProvider>
  )
}

```



---
url: /guide/advanced/fixed-layout/node.md
---

# èŠ‚ç‚¹

èŠ‚ç‚¹é€šè¿‡ [FlowNodeEntity](/api/core/flow-node-entity.md) å®šä¹‰

## èŠ‚ç‚¹æ•°æ®

é€šè¿‡ `node.toJSON()` å¯ä»¥è·å–

:::note åŸºæœ¬ç»“æ„:

* id: `string` èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†, å¿…é¡»ä¿è¯å”¯ä¸€
* meta: `object` èŠ‚ç‚¹çš„ ui é…ç½®ä¿¡æ¯ï¼Œå¦‚è‡ªç”±å¸ƒå±€çš„ `position` ä¿¡æ¯æ”¾è¿™é‡Œ
* type: `string | number` èŠ‚ç‚¹ç±»å‹ï¼Œä¼šå’Œ `nodeRegistries` ä¸­çš„ `type` å¯¹åº”
* data: `object` èŠ‚ç‚¹è¡¨å•æ•°æ®, ä¸šåŠ¡å¯è‡ªå®šä¹‰
* blocks: `array` èŠ‚ç‚¹çš„åˆ†æ”¯, é‡‡ç”¨ `block` æ›´è´´è¿‘ `Gramming`

:::

```ts pure
const nodeData: FlowNodeJSON = {
  id: 'xxxx',
  type: 'condition',
  data: {
    title: 'MyCondition',
    desc: 'xxxxx'
  },
}
```

## èŠ‚ç‚¹å®šä¹‰

å£°æ˜èŠ‚ç‚¹å¯ä»¥ç”¨äºç¡®å®šèŠ‚ç‚¹çš„ç±»å‹åŠæ¸²æŸ“æ–¹å¼

```tsx pure
import { FlowNodeRegistry, ValidateTrigger } from '@flowgram.ai/fixed-layout-editor';

/**
 * è‡ªå®šä¹‰èŠ‚ç‚¹æ³¨å†Œ
 */
export const nodeRegistries: FlowNodeRegistry[] = [
  {
    /**
     * è‡ªå®šä¹‰èŠ‚ç‚¹ç±»å‹
     */
    type: 'condition',
    /**
     * è‡ªå®šä¹‰èŠ‚ç‚¹æ‰©å±•:
     *  - loop: æ‰©å±•ä¸ºå¾ªç¯èŠ‚ç‚¹
     *  - start: æ‰©å±•ä¸ºå¼€å§‹èŠ‚ç‚¹
     *  - dynamicSplit: æ‰©å±•ä¸ºåˆ†æ”¯èŠ‚ç‚¹
     *  - end: æ‰©å±•ä¸ºç»“æŸèŠ‚ç‚¹
     *  - tryCatch: æ‰©å±•ä¸º tryCatch èŠ‚ç‚¹
     *  - default: æ‰©å±•ä¸ºæ™®é€šèŠ‚ç‚¹ (é»˜è®¤)
     */
    extend: 'dynamicSplit',
    /**
     * èŠ‚ç‚¹é…ç½®ä¿¡æ¯
     */
    meta: {
      // isStart: false, // æ˜¯å¦ä¸ºå¼€å§‹èŠ‚ç‚¹
      // isNodeEnd: false, // æ˜¯å¦ä¸ºç»“æŸèŠ‚ç‚¹ï¼Œç»“æŸèŠ‚ç‚¹åè¾¹æ— æ³•å†æ·»åŠ èŠ‚ç‚¹
      // draggable: false, // æ˜¯å¦å¯æ‹–æ‹½ï¼Œå¦‚å¼€å§‹èŠ‚ç‚¹å’Œç»“æŸèŠ‚ç‚¹æ— æ³•æ‹–æ‹½
      // selectable: false, // è§¦å‘å™¨ç­‰å¼€å§‹èŠ‚ç‚¹ä¸èƒ½è¢«æ¡†é€‰
      // deleteDisable: true, // ç¦æ­¢åˆ é™¤
      // copyDisable: true, // ç¦æ­¢copy
      // addDisable: true, // ç¦æ­¢æ·»åŠ 
    },
    /**
     * é…ç½®èŠ‚ç‚¹è¡¨å•çš„æ ¡éªŒåŠæ¸²æŸ“,
     * æ³¨ï¼švalidate é‡‡ç”¨æ•°æ®å’Œæ¸²æŸ“åˆ†ç¦»ï¼Œä¿è¯èŠ‚ç‚¹å³ä½¿ä¸æ¸²æŸ“ä¹Ÿèƒ½å¯¹æ•°æ®åšæ ¡éªŒ
     */
    formMeta: {
      validateTrigger: ValidateTrigger.onChange,
      validate: {
        title: ({ value }) => (value ? undefined : 'Title is required'),
      },
      /**
       * Render form
       */
      render: () => (
       <>
          <Field name="title">
            {({ field }) => <div className="demo-free-node-title">{field.value}</div>}
          </Field>
          <Field name="content">
            {({ field }) => <input onChange={field.onChange} value={field.value}/>}
          </Field>
        </>
      )
    },
  },
];
```

## å½“å‰æ¸²æŸ“èŠ‚ç‚¹è·å–

é€šè¿‡ [useNodeRender](/api/hooks/use-node-render.md) è·å–èŠ‚ç‚¹ç›¸å…³æ–¹æ³•

## åˆ›å»ºèŠ‚ç‚¹

é€šè¿‡ [FlowOperationService](/api/services/flow-operation-service.md) åˆ›å»º

* æ·»åŠ èŠ‚ç‚¹

```ts pure
const ctx = useClientContext()

ctx.operation.addNode({
  id: 'xxx', // è¦ä¿è¯ç”»å¸ƒå†…å”¯ä¸€
  type: 'custom',
  meta: {},
  data: {}, // è¡¨å•ç›¸å…³æ•°æ®
  blocks: [], // å­èŠ‚ç‚¹
  parent: someParent // çˆ¶äº²èŠ‚ç‚¹ï¼Œåˆ†æ”¯ä¼šç”¨åˆ°
})

```

* åœ¨æŒ‡å®šèŠ‚ç‚¹ä¹‹åæ·»åŠ 

```ts pure
const ctx = useClientContext()

ctx.operation.addFromNode(targetNode, {
  id: 'xxx', // è¦ä¿è¯ç”»å¸ƒå†…å”¯ä¸€
  type: 'custom',
  meta: {},
  data: {}, // è¡¨å•ç›¸å…³æ•°æ®
  blocks: [], // å­èŠ‚ç‚¹
})

```

* æ·»åŠ åˆ†æ”¯èŠ‚ç‚¹ ï¼ˆç”¨äºæ¡ä»¶åˆ†æ”¯ï¼‰

```ts pure
const ctx = useClientContext()

ctx.operation.addBlock(parentNode, {
  id: 'xxx', // è¦ä¿è¯ç”»å¸ƒå†…å”¯ä¸€
  type: 'block',
  meta: {},
  data: {}, // è¡¨å•ç›¸å…³æ•°æ®
  blocks: [], // å­èŠ‚ç‚¹
})
```

## åˆ é™¤èŠ‚ç‚¹

```tsx pure
function BaseNode({ node }) {
  const ctx = useClientContext()
  function onClick() {
    ctx.operation.deleteNode(node)
  }
  return (
    <button onClick={onClick}>Delete</button>
  )
}
```

## æ›´æ–°èŠ‚ç‚¹ data æ•°æ®

* é€šè¿‡ [useNodeRender](/api/hooks/use-node-render.md) æˆ– [getNodeForm](/api/utils/get-node-form.md) è·å–èŠ‚ç‚¹çš„ data æ•°æ®

```tsx pure
function BaseNode() {
  const { form } = useNodeRender();
  // å¯¹åº”èŠ‚ç‚¹çš„ data æ•°æ®
  console.log(form.values)

  // ç›‘å¬èŠ‚ç‚¹çš„æ•°æ®å˜åŒ–
  useEffect(() => {
    const toDispose = form.onFormValuesChange(() => {
      // changed
    })
    return () => toDispose.dispose()
  }, [form])

  function onChange(e) {
    form.setValueIn('title', e.target.value)
  }
  return <input value={form.getValueIn('title')} onChange={onChange}/>
}
```

* é€šè¿‡ Field æ›´æ–°è¡¨å•æ•°æ®, è¯¦ç»†è§ [è¡¨å•çš„ä½¿ç”¨](/guide/advanced/form.md)

```tsx pure

function FormRender() {
  return (
    <Field name="title">
      <Input />
    </Field>
  )
}
```

## æ›´æ–°èŠ‚ç‚¹çš„ extInfo æ•°æ®

extInfo ç”¨äºå­˜å‚¨ ä¸€äº› ui çŠ¶æ€, å¦‚æœæœªå¼€å¯èŠ‚ç‚¹å¼•æ“ï¼ŒèŠ‚ç‚¹çš„ data æ•°æ®ä¼šé»˜è®¤å­˜åˆ° extInfo é‡Œ

```tsx pure
function BaseNode({ node }) {
  const times = node.getExtInfo()?.times || 0
  function onClick() {
    node.updateExtInfo({ times: times ++ })
  }
  return (
    <div>
      <span>Click Times: {times}</span>
      <button onClick={onClick}>Click</button>
    </div>
  )
}
```



---
url: /guide/advanced/form-materials.md
---



# å®˜æ–¹è¡¨å•ç‰©æ–™

## å¦‚ä½•ä½¿ç”¨ï¼Ÿ

### é€šè¿‡åŒ…å¼•ç”¨ä½¿ç”¨

å®˜æ–¹è¡¨å•ç‰©æ–™å¯ä»¥ç›´æ¥é€šè¿‡åŒ…å¼•ç”¨ä½¿ç”¨ï¼š

```tsx
import { JsonSchemaEditor } from '@flowgram.ai/form-materials'
```

### é€šè¿‡ CLI æ·»åŠ ç‰©æ–™æºä»£ç ä½¿ç”¨

å¦‚æœä¸šåŠ¡å¯¹ç»„ä»¶æœ‰å®šåˆ¶è¯‰æ±‚ï¼ˆå¦‚ï¼šæ›´æ”¹æ–‡æ¡ˆã€æ ·å¼ã€ä¸šåŠ¡é€»è¾‘ï¼‰ï¼Œæ¨è **é€šè¿‡ CLI å°†ç‰©æ–™æºä»£ç æ·»åŠ åˆ°é¡¹ç›®ä¸­è¿›è¡Œå®šåˆ¶**ï¼š

```bash
npx @flowgram.ai/form-materials@latest
```

è¿è¡Œå CLI ä¼šæç¤ºç”¨æˆ·é€‰æ‹©è¦æ·»åŠ åˆ°é¡¹ç›®ä¸­çš„ç‰©æ–™:

```console
? Select one material to add: (Use arrow keys)
â¯ components/json-schema-editor
  components/type-selector
  components/variable-selector
```

ä½¿ç”¨è€…ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ CLI ä¸­æ·»åŠ æŒ‡å®šç‰©æ–™çš„æºä»£ç :

```bash
npx @flowgram.ai/form-materials@latest components/json-schema-editor
```

CLI è¿è¡ŒæˆåŠŸåï¼Œç›¸å…³ç‰©æ–™ä¼šè‡ªåŠ¨æ·»åŠ åˆ°å½“å‰é¡¹ç›®ä¸‹çš„ `src/form-materials` ç›®å½•ä¸‹

:::warning æ³¨æ„äº‹é¡¹

1. å®˜æ–¹ç‰©æ–™ç›®å‰åº•å±‚åŸºäº [Semi Design](https://semi.design/) å®ç°ï¼Œä¸šåŠ¡å¦‚æœæœ‰åº•å±‚ç»„ä»¶åº“çš„è¯‰æ±‚ï¼Œå¯ä»¥é€šè¿‡ CLI å¤åˆ¶æºç è¿›è¡Œæ›¿æ¢
2. ä¸€äº›ç‰©æ–™ä¼šä¾èµ–ä¸€äº›ç¬¬ä¸‰æ–¹ npm åº“ï¼Œè¿™äº›åº“ä¼šåœ¨ CLI è¿è¡Œæ—¶è‡ªåŠ¨å®‰è£…
3. ä¸€äº›ç‰©æ–™ä¼šä¾èµ–å¦å¤–ä¸€äº›å®˜æ–¹ç‰©æ–™ï¼Œè¿™äº›è¢«ä¾èµ–çš„ç‰©æ–™æºä»£ç åœ¨ CLI è¿è¡Œæ—¶ä¼šä¸€èµ·è¢«æ·»åŠ åˆ°é¡¹ç›®ä¸­å»

:::

## å½“å‰æ”¯æŒçš„ Component ç‰©æ–™

### TypeSelector

TypeSelector ç”¨äºå˜é‡ç±»å‹é€‰æ‹©

### VariableSelector

VariableSelector ç”¨äºå±•ç¤ºå˜é‡æ ‘ï¼Œå¹¶ä»å˜é‡æ ‘ä¸­é€‰æ‹©å•ä¸ªå˜é‡

### JsonSchemaEditor

JsonSchemaEditor ç”¨äºå¯è§†åŒ–ç¼–è¾‘ [JsonSchema](https://json-schema.org/)

å¸¸ç”¨äºå¯è§†åŒ–é…ç½®èŠ‚ç‚¹çš„è¾“å‡ºå˜é‡

### DynamicValueInput

DynamicValueInput ç”¨äºå€¼ï¼ˆå¸¸é‡å€¼ + å˜é‡å€¼ï¼‰çš„é…ç½®

### ConditionRow

ConditionRow ç”¨äº **ä¸€è¡Œ** æ¡ä»¶åˆ¤æ–­çš„é…ç½®

## å½“å‰æ”¯æŒçš„ Effect ç‰©æ–™

### provideBatchInput

provideBatchInputEffect ç”¨äºé…ç½®å¾ªç¯æ‰¹å¤„ç†è¾“å…¥æ¨å¯¼ï¼Œä¼šæ ¹æ®è¾“å…¥è‡ªåŠ¨æ¨å¯¼å‡ºä¸¤ä¸ªå˜é‡ï¼š

* itemï¼šæ ¹æ®è¾“å…¥å˜é‡æ•°ç»„ç±»å‹è‡ªåŠ¨æ¨å¯¼ï¼Œä»£è¡¨å¾ªç¯çš„æ¯ä¸€é¡¹
* indexï¼šæ•°å­—ç±»å‹ï¼Œä»£è¡¨å¾ªç¯ç¬¬å‡ æ¬¡

### autoRenameRef

å½“å‰ç½®è¾“å‡ºå˜é‡åå‘ç”Ÿå˜åŒ–æ—¶:

* è¡¨å•é¡¹ä¸­æ‰€æœ‰çš„å¯¹è¯¥å˜é‡çš„å¼•ç”¨ï¼Œè‡ªåŠ¨é‡å‘½å



---
url: /guide/advanced/form.md
---

# èŠ‚ç‚¹è¡¨å•

## æœ¯è¯­

èŠ‚ç‚¹è¡¨å•
<td>ç‰¹æŒ‡æµç¨‹èŠ‚ç‚¹å†…çš„è¡¨å•æˆ–ç‚¹å‡»èŠ‚ç‚¹å±•å¼€çš„è¡¨å•ï¼Œå…³è”èŠ‚ç‚¹æ•°æ®ã€‚</td>

èŠ‚ç‚¹å¼•æ“
<td>FlowGram.ai å†…ç½®çš„å¼•æ“ä¹‹ä¸€ï¼Œå®ƒæ ¸å¿ƒç»´æŠ¤äº†èŠ‚ç‚¹æ•°æ®çš„å¢åˆ æŸ¥æ”¹ï¼Œå¹¶æä¾›æ¸²æŸ“ã€æ ¡éªŒã€å‰¯ä½œç”¨ã€ç”»å¸ƒæˆ–å˜é‡è”åŠ¨ç­‰èƒ½åŠ›ï¼Œ é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æä¾›èŠ‚ç‚¹é”™è¯¯æ•è·æ¸²æŸ“ã€æ— å†…å®¹æ—¶çš„ placeholder æ¸²æŸ“ç­‰èƒ½åŠ›ï¼Œè§ä»¥ä¸‹ç« èŠ‚ä¾‹å­ã€‚</td>

## å¿«é€Ÿå¼€å§‹

### å¼€å¯èŠ‚ç‚¹å¼•æ“

[> API Detail](https://github.com/bytedance/flowgram.ai/blob/main/packages/client/editor/src/preset/editor-props.ts#L54)

```tsx pure title="use-editor-props.ts" {3}

// EditorProps
{
  nodeEngine: {
    /**
     * éœ€è¦å¼€å¯èŠ‚ç‚¹å¼•æ“æ‰èƒ½ä½¿ç”¨
     */
    enable: true;
    materials: {
      /**
       * èŠ‚ç‚¹å†…éƒ¨æŠ¥é”™çš„æ¸²æŸ“ç»„ä»¶
       */
      nodeErrorRender?: NodeErrorRender;
      /**
       * èŠ‚ç‚¹æ— å†…å®¹æ—¶çš„æ¸²æŸ“ç»„ä»¶
       */
      nodePlaceholderRender?: NodePlaceholderRender;
    }
  }
}
```

### é…ç½®è¡¨å•

`formMeta` æ˜¯èŠ‚ç‚¹è¡¨å•å”¯ä¸€é…ç½®å…¥å£ï¼Œé…ç½®åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„NodeRegistry ä¸Šã€‚

[> node-registries.ts](https://github.com/bytedance/flowgram.ai/blob/main/apps/demo-fixed-layout-simple/src/node-registries.ts)

```tsx pure title="node-registries.ts"
import { FlowNodeRegistry, ValidateTrigger } from '@flowgram.ai/fixed-layout-editor';

export const nodeRegistries: FlowNodeRegistry[] = [
  {
    type: 'start',
    /**
     * é…ç½®èŠ‚ç‚¹è¡¨å•çš„æ ¡éªŒåŠæ¸²æŸ“
     */
    formMeta: {
      /**
       * é…ç½®æ ¡éªŒåœ¨æ•°æ®å˜æ›´æ—¶è§¦å‘
       */
      validateTrigger: ValidateTrigger.onChange,
      /**
       * é…ç½®æ ¡éªŒè§„åˆ™ï¼Œ 'content' ä¸ºå­—æ®µè·¯å¾„ï¼Œä»¥ä¸‹é…ç½®å€¼å¯¹è¯¥è·¯å¾„ä¸‹çš„æ•°æ®è¿›è¡Œæ ¡éªŒã€‚
       */
      validate: {
        content: ({ value }) => (value ? undefined : 'Content is required'),
      },
      /**
       * é…ç½®è¡¨å•æ¸²æŸ“
       */
      render: () => (
       <>
          <Field<string> name="title">
            {({ field }) => <div className="demo-free-node-title">{field.value}</div>}
          </Field>
          <Field<string> name="content">
            {({ field, fieldState }) => (
              <>
                <input onChange={field.onChange} value={field.value}/>
                {fieldState?.invalid && <Feedback errors={fieldState?.errors}/>}
              </>
            )}
          </Field>
        </>
      )
    },
  }
]

```

[> è¡¨å•å†™æ³•çš„åŸºç¡€ä¾‹å­](/examples/node-form/basic.md)

### æ¸²æŸ“è¡¨å•

[> base-node.tsx](https://github.com/bytedance/flowgram.ai/blob/main/apps/demo-fixed-layout-simple/src/components/base-node.tsx)

```tsx pure title="base-node.tsx"

export const BaseNode = () => {
  /**
   * æä¾›èŠ‚ç‚¹æ¸²æŸ“ç›¸å…³çš„æ–¹æ³•
   */
  const { form } = useNodeRender()
  return (
    <div className="demo-free-node" className={form?.state.invalid && "error"}>
      {
        // è¡¨å•æ¸²æŸ“é€šè¿‡ formMeta ç”Ÿæˆ
        form?.render()
      }
    </div>
  )
};

```

## æ ¸å¿ƒæ¦‚å¿µ

### FormMeta

åœ¨ `NodeRegistry` ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡`formMeta` æ¥é…ç½®èŠ‚ç‚¹è¡¨å•, å®ƒéµå¾ªä»¥ä¸‹APIã€‚

[> FormMeta API](https://github.com/bytedance/flowgram.ai/blob/main/packages/node-engine/node/src/types.ts#L89)

è¿™é‡Œç‰¹åˆ«è¯´æ˜, èŠ‚ç‚¹è¡¨å•ä¸é€šç”¨è¡¨å•æœ‰ä¸€ä¸ªå¾ˆå¤§çš„åŒºåˆ«ï¼Œå®ƒçš„æ•°æ®é€»è¾‘ï¼ˆå¦‚æ ¡éªŒã€æ•°æ®å˜æ›´åçš„å‰¯ä½œç”¨ç­‰ï¼‰éœ€è¦åœ¨è¡¨å•ä¸æ¸²æŸ“çš„æƒ…å†µä¸‹ä¾ç„¶ç”Ÿæ•ˆï¼Œæˆ‘ä»¬ç§° æ•°æ®ä¸æ¸²æŸ“åˆ†ç¦»
ã€‚æ‰€ä»¥è¿™äº›æ•°æ®é€»è¾‘éœ€è¦é…ç½®åœ¨formMeta ä¸­çš„érender å­—æ®µä¸­ï¼Œä¿è¯ä¸æ¸²æŸ“æƒ…å†µä¸‹èŠ‚ç‚¹å¼•æ“ä¹Ÿå¯ä»¥è°ƒç”¨åˆ°è¿™äº›é€»è¾‘, è€Œé€šç”¨è¡¨å•å¼•æ“ï¼ˆå¦‚react-hook-formï¼‰åˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶, æ ¡éªŒå¯ä»¥ç›´æ¥å†™åœ¨reactç»„ä»¶ä¸­ã€‚

### FormMeta.render (æ¸²æŸ“)

`render` å­—æ®µç”¨äºé…ç½®è¡¨å•çš„æ¸²æŸ“é€»è¾‘

`render: (props: FormRenderProps<any>) => React.ReactElement;`

[> FormRenderProps](https://github.com/bytedance/flowgram.ai/blob/main/packages/node-engine/form/src/types/form.ts#L91)

è¿”å›çš„ react ç»„ä»¶å¯ä½¿ç”¨ä»¥ä¸‹è¡¨å•ç»„ä»¶å’Œæ¨¡å‹ï¼š

#### Field (ç»„ä»¶)

`Field` æ˜¯è¡¨å•å­—æ®µçš„ React é«˜é˜¶ç»„ä»¶ï¼Œå°è£…äº†è¡¨å•å­—æ®µçš„é€šç”¨é€»è¾‘ï¼Œå¦‚æ•°æ®ä¸çŠ¶æ€çš„æ³¨å…¥ï¼Œç»„ä»¶çš„åˆ·æ–°ç­‰ã€‚å…¶æ ¸å¿ƒå¿…å¡«å‚æ•°ä¸º `name`, ç”¨äºå£°æ˜è¡¨å•é¡¹çš„è·¯å¾„ï¼Œåœ¨ä¸€ä¸ªè¡¨å•ä¸­å…·æœ‰å”¯ä¸€æ€§ã€‚

[> Field Props API](https://github.com/bytedance/flowgram.ai/blob/main/packages/node-engine/form/src/types/field.ts#L106)

Field çš„æ¸²æŸ“éƒ¨åˆ†ï¼Œæ”¯æŒä¸‰ç§å†™æ³•ï¼Œå¦‚ä¸‹:

```tsx pure
const render = () => (
  <div>
    <Label> 1. é€šè¿‡ children </Label>
    {/* è¯¥æ–¹å¼é€‚ç”¨äºç®€å•åœºæ™¯ï¼ŒField ä¼šå°†  value onChange ç­‰å±æ€§ç›´æ¥æ³¨å…¥ç¬¬ä¸€å±‚childrenç»„ä»¶ä¸­  */}
    <Field name="c">
      <Input />
    </Field>
    <Label> 2. é€šè¿‡ Render Props  </Label>
    {/* è¯¥æ–¹å¼é€‚ç”¨äºå¤æ‚åœºæ™¯ï¼Œå½“ return çš„ç»„ä»¶å­˜åœ¨å¤šå±‚åµŒå¥—ï¼Œç”¨æˆ·å¯ä»¥ä¸»åŠ¨å°†field ä¸­çš„å±æ€§æ³¨å…¥å¸Œæœ›æ³¨å…¥çš„ç»„ä»¶ä¸­ */}
    <Field name="a">
        {({ field, fieldState, formState }: FieldRenderProps<string>) => <div><Input {...field} /><Feedbacks errors={fieldState.errors}/></div>}
    </Field>

    <Label> 3. é€šè¿‡ä¼  render å‡½æ•°</Label>
    {/* è¯¥æ–¹å¼ç±»ä¼¼æ–¹å¼2ï¼Œä½†é€šè¿‡props ä¼ å…¥ */}
    <Field name="b" render={({ field }: FieldRenderProps<string>) => <Input {...field} />} />
  </div>
);
```

```ts pure
interface FieldRenderProps<TValue> {
  // Field å®ä¾‹
  field: Field<TValue>;
  // Field çŠ¶æ€ï¼ˆå“åº”å¼ï¼‰
  fieldState: Readonly<FieldState>;
  // Form çŠ¶æ€
  formState: Readonly<FormState>;
}
```

[> FieldRenderProps API](https://github.com/bytedance/flowgram.ai/blob/main/packages/node-engine/form/src/types/field.ts#L125)

#### Field (æ¨¡å‹)

`Field` å®ä¾‹é€šå¸¸é€šè¿‡render props ä¼ å…¥ï¼ˆå¦‚ä¸Šä¾‹å­ï¼‰ï¼Œæˆ–é€šè¿‡ `useCurrentField` hook è·å–ã€‚å®ƒåŒ…å«è¡¨å•å­—æ®µåœ¨æ¸²æŸ“å±‚é¢çš„å¸¸è§APIã€‚
æ³¨æ„: `Field` æ˜¯ä¸€ä¸ªæ¸²æŸ“æ¨¡å‹ï¼Œä»…æä¾›ä¸€èˆ¬ç»„ä»¶éœ€è¦çš„API, å¦‚ `value` `onChange` `onFocus` `onBlur`ï¼Œå¦‚æœæ˜¯æ•°æ®ç›¸å…³çš„API è¯·ä½¿ç”¨ `Form` æ¨¡å‹å®ä¾‹ï¼Œå¦‚ `form.setValueIn(name, value)` è®¾ç½®æŸå­—æ®µçš„å€¼ã€‚

[> Field æ¨¡å‹ API](https://github.com/bytedance/flowgram.ai/blob/main/packages/node-engine/form/src/types/field.ts#L34)

#### FieldArray (ç»„ä»¶)

`FieldArray` æ˜¯æ•°ç»„ç±»å‹å­—æ®µçš„ React é«˜é˜¶ç»„ä»¶ï¼Œå°è£…äº†æ•°ç»„ç±»å‹å­—æ®µçš„é€šç”¨é€»è¾‘ï¼Œå¦‚æ•°æ®ä¸çŠ¶æ€çš„æ³¨å…¥ï¼Œç»„ä»¶çš„åˆ·æ–°ï¼Œä»¥åŠæ•°ç»„é¡¹çš„éå†ç­‰ã€‚å…¶æ ¸å¿ƒå¿…å¡«å‚æ•°ä¸º `name`, ç”¨äºå£°æ˜è¯¥è¡¨å•é¡¹çš„è·¯å¾„ï¼Œåœ¨ä¸€ä¸ªè¡¨å•ä¸­å…·æœ‰å”¯ä¸€æ€§ã€‚

`FieldArray` çš„åŸºç¡€ç”¨æ³•å¯ä»¥å‚ç…§ä»¥ä¸‹ä¾‹å­:

[> æ•°ç»„ä¾‹å­](https://flowgram.ai/examples/node-form/array.html)

#### FieldArray (æ¨¡å‹)

`FieldArray` ç»§æ‰¿äº `Field` ï¼Œæ˜¯æ•°ç»„ç±»å‹å­—æ®µåœ¨æ¸²æŸ“å±‚çš„æ¨¡å‹ï¼Œé™¤äº†åŒ…å«æ¸²æŸ“å±‚çš„å¸¸è§APIï¼Œè¿˜åŒ…å«æ•°ç»„çš„åŸºæœ¬æ“ä½œå¦‚ `FieldArray.map`, `FieldArray.remove`, `FieldArray.append` ç­‰ã€‚API çš„ä½¿ç”¨æ–¹æ³•ä¹Ÿå¯è§ä¸Šè¿°[æ•°ç»„ä¾‹å­](https://flowgram.ai/examples/node-form/array.html)ã€‚

[> FieldArray æ¨¡å‹ API](https://github.com/bytedance/flowgram.ai/blob/main/packages/node-engine/form/src/types/field.ts#L69)

#### Form(ç»„ä»¶)

`Form` ç»„ä»¶æ˜¯è¡¨å•çš„æœ€å¤–å±‚é«˜é˜¶ç»„ä»¶ï¼Œä¸Šè¿° `Field` `FieldArray` ç­‰èƒ½åŠ›ä»…åœ¨è¯¥é«˜é˜¶ç»„ä»¶ä¸‹å¯ä»¥ä½¿ç”¨ã€‚èŠ‚ç‚¹è¡¨å•çš„æ¸²æŸ“å·²ç»å°†`<Form />` å°è£…åˆ°äº†å¼•æ“å†…éƒ¨ï¼Œæ‰€ä»¥ç”¨æˆ·æ— éœ€å…³æ³¨ï¼Œå¯ä»¥ç›´æ¥åœ¨`render` è¿”å›çš„ react ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ `Field`ã€‚ä½†å¦‚æœç”¨æˆ·éœ€è¦ç‹¬ç«‹ä½¿ç”¨è¡¨å•å¼•æ“ï¼Œæˆ–è€…åœ¨èŠ‚ç‚¹ä¹‹å¤–ç‹¬ç«‹å†æ¸²æŸ“ä¸€æ¬¡è¡¨å•ï¼Œéœ€è¦è‡ªè¡Œåœ¨è¡¨å•å†…å®¹å¤–åŒ…ä¸Š`Form`ç»„ä»¶ã€‚

#### Form(æ¨¡å‹)

`Form` å®ä¾‹å¯é€šè¿‡`render` å‡½æ•°çš„å…¥å‚è·å¾—ï¼Œ ä¹Ÿå¯é€šè¿‡ hook `useForm` è·å–ï¼Œè§[ä¾‹å­](#useform)ã€‚å®ƒæ˜¯è¡¨å•æ ¸å¿ƒæ¨¡å‹é—¨é¢ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡Form å®ä¾‹æ“ä½œè¡¨å•æ•°æ®ã€ç›‘å¬å˜æ›´ã€è§¦å‘æ ¡éªŒç­‰ã€‚

[> Form æ¨¡å‹ API](https://github.com/bytedance/flowgram.ai/blob/main/packages/node-engine/form/src/types/form.ts#L58)

### æ ¡éªŒ

åŸºäº[FormMeta](#formmeta)ç« èŠ‚ä¸­æåˆ°çš„"æ•°æ®ä¸æ¸²æŸ“åˆ†ç¦»"æ¦‚å¿µï¼Œæ ¡éªŒé€»è¾‘éœ€é…ç½®åœ¨ `FormMeta` å…¨å±€, å¹¶é€šè¿‡è·¯å¾„åŒ¹é…æ–¹å¼å£°æ˜æ ¡éªŒé€»è¾‘æ‰€ä½œç”¨çš„è¡¨å•é¡¹ï¼Œå¦‚ä¸‹ä¾‹å­ã€‚

è·¯å¾„æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œè§[è·¯å¾„](#è·¯å¾„)ç« èŠ‚ã€‚

```tsx pure
export const renderValidateExample = ({ form }: FormRenderProps<FormData>) => (
  <>
    <Label> a (æœ€å¤§é•¿åº¦ä¸º 5)</Label>
    <Field name="a">
      {({ field: { value, onChange }, fieldState }: FieldRenderProps<string>) => (
        <>
          <Input value={value} onChange={onChange} />
          <Feedback errors={fieldState?.errors} />
        </>
      )}
    </Field>
    <Label> b (å¦‚æœaå­˜åœ¨ï¼Œbå¯ä»¥é€‰å¡«) </Label>
    <Field
      name="b"
      render={({ field: { value, onChange }, fieldState }: FieldRenderProps<string>) => (
        <>
          <Input value={value} onChange={onChange} />
          <Feedback errors={fieldState?.errors} />
        </>
  )}
/>
  </>
);

export const VALIDATE_EXAMPLE: FormMeta = {
  render: renderValidateExample,
  // æ ¡éªŒæ—¶æœºé…ç½®
  validateTrigger: ValidateTrigger.onChange,
  validate: {
    // å•çº¯æ ¡éªŒå€¼
    a: ({ value }) => (value.length > 5 ? 'æœ€å¤§é•¿åº¦ä¸º5' : undefined),
    // æ ¡éªŒä¾èµ–å…¶ä»–è¡¨å•é¡¹çš„å€¼
    b: ({ value, formValues }) => {
      if (formValues.a) {
        return undefined;
      } else {
        return value ? 'undefined' : 'a å­˜åœ¨æ—¶ b å¿…å¡«';
      }
    },
    // æ ¡éªŒä¾èµ–èŠ‚ç‚¹æˆ–ç”»å¸ƒä¿¡æ¯
    c: ({ value, formValues, context }) => {
      const { nodeï¼Œ playgroundContext } = context;
      // æ­¤å¤„é€»è¾‘çœç•¥
    },
  },
};
```

#### æ ¡éªŒæ—¶æœº

`ValidateTrigger.onChange`
<td>è¡¨å•æ•°æ®å˜æ›´æ—¶æ ¡éªŒï¼ˆä¸åŒ…å«åˆå§‹åŒ–æ•°æ®ï¼‰</td>

`ValidateTrigger.onBlur`
<td>è¡¨å•é¡¹è¾“å…¥æ§ä»¶onBluræ—¶æ ¡éªŒã€‚<br />æ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªå‰æï¼šä¸€æ˜¯è¡¨å•é¡¹çš„è¾“å…¥æ§ä»¶éœ€è¦æ”¯æŒ `onBlur` å…¥å‚ï¼ŒäºŒæ˜¯è¦å°† `Field.onBlur` ä¼ å…¥è¯¥æ§ä»¶: <br />`<Field>{({field})=><Input ... onBlur={field.onBlur}>}</Field>`</td>

`validateTrigger` å»ºè®®é…ç½® `ValidateTrigger.onChange` å³æ•°æ®å˜æ›´æ—¶æ ¡éªŒï¼Œå¦‚æœé…ç½® `ValidateTrigger.onBlur`, æ ¡éªŒåªä¼šåœ¨ç»„ä»¶bluräº‹ä»¶è§¦å‘æ—¶è§¦å‘ã€‚é‚£ä¹ˆå½“èŠ‚ç‚¹è¡¨å•ä¸æ¸²æŸ“çš„æƒ…å†µä¸‹ï¼Œå°±ç®—æ˜¯æ•°æ®å˜æ›´äº†ï¼Œä¹Ÿä¸ä¼šè§¦å‘æ ¡éªŒã€‚

#### ä¸»åŠ¨è§¦å‘æ ¡éªŒ

1. ä¸»åŠ¨è§¦å‘æ•´ä¸ªè¡¨å•çš„æ ¡éªŒ

```pure tsx
const form = useForm()
form.validate()
```

2. ä¸»åŠ¨è§¦å‘å•ä¸ªè¡¨å•é¡¹æ ¡éªŒ

```pure tsx
const validate = useFieldValidate(name)
validate()
```

`name` ä¸ä¼ åˆ™é»˜è®¤è·å–å½“å‰ `<Field />` æ ‡ç­¾ä¸‹çš„ `Field` çš„ `validate`, é€šè¿‡ä¼  `name` å¯è·å– `<Form />` ä¸‹ä»»æ„ `Field`ã€‚

### è·¯å¾„

1. è¡¨å•è·¯å¾„ä»¥`.`ä¸ºå±‚çº§åˆ†éš”ç¬¦ï¼Œ å¦‚ `a.b.c` æŒ‡å‘æ•°æ® `{a:{b:{c:1}}}` ä¸‹çš„ `1`
2. è·¯å¾„æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œåœ¨æ ¡éªŒå’Œå‰¯ä½œç”¨é…ç½®ä¸­ä¼šä½¿ç”¨åˆ°ã€‚å¦‚ä¸‹ä¾‹å­ã€‚é€šå¸¸åœ¨æ•°ç»„åœºæ™¯ä¸­ä½¿ç”¨è¾ƒå¤šã€‚

æ³¨æ„ï¼š\* ä»…ä»£è¡¨ä¸‹é’»ä¸€çº§

`arr.*`
<td>`arr` å­—æ®µçš„æ‰€æœ‰ä¸€çº§å­é¡¹</td>

`arr.x.*`
<td>`arr.x` çš„æ‰€æœ‰ä¸€çº§å­é¡¹</td>

`arr.*.x`
<td>`arr` æ‰€æœ‰ä¸€çº§å­é¡¹ä¸‹çš„ `x`</td>

### å‰¯ä½œç”¨ (effect)

å‰¯ä½œç”¨æ˜¯èŠ‚ç‚¹è¡¨å•ç‰¹æœ‰çš„æ¦‚å¿µï¼ŒæŒ‡åœ¨èŠ‚ç‚¹æ•°æ®å‘ç”Ÿå˜æ›´æ—¶éœ€è¦æ‰§è¡Œçš„å‰¯ä½œç”¨ã€‚åŒæ ·ï¼Œéµå¾ª "æ•°æ®ä¸æ¸²æŸ“åˆ†ç¦»" çš„åŸåˆ™ï¼Œå‰¯ä½œç”¨å’Œæ ¡éªŒç›¸ä¼¼ï¼Œä¹Ÿé…ç½®åœ¨ `FormMeta` å…¨å±€ã€‚

* é€šè¿‡ key value å½¢å¼é…ç½®ï¼Œkey è¡¨ç¤ºè¡¨å•é¡¹è·¯å¾„åŒ¹é…è§„åˆ™ï¼Œæ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œvalue ä¸ºä½œç”¨åœ¨è¯¥è·¯å¾„ä¸Šçš„effectã€‚
* value ä¸ºæ•°ç»„ï¼Œå³æ”¯æŒä¸€ä¸ªè¡¨å•é¡¹æœ‰å¤šä¸ªeffectã€‚

```tsx pur

export const EFFECT_EXAMPLE: FormMeta = {
  ...
  effect: {
    ['a.b']: [
      {
        event: DataEvent.onValueChange,
        effect: ({ value }: EffectFuncProps<string, FormData>) => {
          console.log('a.b value changed:', value);
        },
      },
    ],
    ['arr.*']:[
      {
        event: DataEvent.onValueInit,
        effect: ({ value, name }: EffectFuncProps<string, FormData>) => {
          console.log(name + ' value init:', value);
        },
      },
    ]
  }
};
```

```tsx pur
interface EffectFuncProps<TFieldValue = any, TFormValues = any> {
  name: FieldName;
  value: TFieldValue;
  prevValue?: TFieldValue;
  formValues: TFormValues;
  form: IForm;
  context: NodeContext;
}
```

[Effect ç›¸å…³ API](https://github.com/bytedance/flowgram.ai/blob/main/packages/node-engine/node/src/types.ts#L54)

#### å‰¯ä½œç”¨æ—¶æœº

`DataEvent.onValueChange`
<td>æ•°æ®å˜æ›´æ—¶è§¦å‘</td>

`DataEvent.onValueInit`
<td>æ•°æ®åˆå§‹åŒ–æ—¶è§¦å‘</td>

`DataEvent.onValueInitOrChange`
<td>æ•°æ®åˆå§‹åŒ–å’Œå˜æ›´æ—¶éƒ½ä¼šè§¦å‘</td>

### è”åŠ¨

[> è”åŠ¨ä¾‹å­](/examples/node-form/dynamic.md)

## hooks

### èŠ‚ç‚¹è¡¨å•å†…

ä»¥ä¸‹hook å¯åœ¨èŠ‚ç‚¹è¡¨å•å†…éƒ¨ä½¿ç”¨

#### useCurrentField

`() => Field`

è¯¥ hook éœ€è¦åœ¨Field æ ‡ç­¾å†…éƒ¨ä½¿ç”¨

```tsx pur
const field = useCurrentField()
```

[> Field æ¨¡å‹ API](https://github.com/bytedance/flowgram.ai/blob/main/packages/node-engine/form/src/types/field.ts#L34)

#### useCurrentFieldState

`() => FieldState`

è¯¥ hook éœ€è¦åœ¨Field æ ‡ç­¾å†…éƒ¨ä½¿ç”¨

```tsx pur
const fieldState = useCurrentFieldState()
```

[> FieldState API](https://github.com/bytedance/flowgram.ai/blob/main/packages/node-engine/form/src/types/field.ts#L158)

#### useFieldValidate

`(name?: FieldName) => () => Promise<void>`

å¦‚æœéœ€è¦ä¸»åŠ¨è§¦å‘å­—æ®µçš„æ ¡éªŒï¼Œå¯ä»¥ä½¿ç”¨è¯¥hook è·å–åˆ° Field çš„ validate å‡½æ•°ã€‚

`name` ä¸º Field çš„è·¯å¾„ï¼Œä¸ä¼ åˆ™é»˜è®¤è·å–å½“å‰ `<Field />` ä¸‹çš„validate

```tsx pur
const validate = useFieldValidate()
validate()
```

#### useForm

`() => Form`

ç”¨äºè·å– Form å®ä¾‹ã€‚

æ³¨æ„ï¼Œè¯¥hook åœ¨ `render` å‡½æ•°ç¬¬ä¸€å±‚ä¸ç”Ÿæ•ˆï¼Œä»…åœ¨ `render` å‡½æ•°å†…çš„ react ç»„ä»¶å†…éƒ¨æ‰å¯ä½¿ç”¨ã€‚`render` å‡½æ•°çš„å…¥å‚ä¸­å·²ç»ä¼ å…¥äº† `form: Form`, å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

1. åœ¨ render å‡½æ•°ç¬¬ä¸€å±‚ç›´æ¥ä½¿ç”¨ `props.form`

```tsx pur
const formMeta = {
  render: ({form}) =>
  <div>
    {form.getValueIn('my.path')}
  </div>
}
```

2. åœ¨ç»„ä»¶å†…éƒ¨å¯ä½¿ç”¨ `useForm`

```tsx pur

const formMeta = {
  render: () =>
    <div>
      <Field name={'my.path'}>
        <MySelect />
      </Field>
    </div>
}

// MySelect.tsx
...
const form = useForm()
const valueNeeded = form.getValueIn('my.other.path')
...
```

æ³¨æ„ï¼šForm çš„ api ä¸å…·å¤‡ä»»ä½•å“åº”å¼èƒ½åŠ›ï¼Œè‹¥éœ€ç›‘å¬æŸå­—æ®µå€¼ï¼Œå¯ä½¿ç”¨ [useWatch](#usewatch)&#x20;

#### useWatch

`<TValue = FieldValue>(name: FieldName) => TValue`

è¯¥ hook å’Œä¸Šè¿° `useForm` ç›¸ä¼¼, åœ¨ `render` å‡½æ•°è¿”å›ç»„ä»¶çš„ç¬¬ä¸€å±‚ä¸ç”Ÿæ•ˆï¼Œä»…åœ¨å°è£…è¿‡çš„ç»„ä»¶å†…éƒ¨å¯ç”¨ã€‚å¦‚æœéœ€è¦åœ¨ `render` æ ¹çº§åˆ«ä½¿ç”¨ï¼Œå¯ä»¥å¯¹ `render` è¿”å›çš„å†…å®¹åšä¸€å±‚ç»„ä»¶å°è£…ã€‚

```tsx pur
{
  render: () =>
    <div>
      <Field name={'a'}><A /></Field>
      <Field name={'b'}><B /></Field>
    </div>
}

// A.tsx
...
const b = useWatch('b')
// do something with b
...
```

### èŠ‚ç‚¹è¡¨å•å¤–

ä»¥ä¸‹ hook ç”¨äºåœ¨èŠ‚ç‚¹è¡¨å•å¤–éƒ¨ï¼Œå¦‚ç”»å¸ƒå…¨å±€ã€ç›¸é‚»èŠ‚ç‚¹ä¸Šéœ€è¦å»ç›‘å¬æŸä¸ªèŠ‚ç‚¹è¡¨å•çš„æ•°æ®æˆ–çŠ¶æ€ã€‚é€šå¸¸éœ€è¦ä¼ å…¥ `node: FlowNodeEntity` ä½œä¸ºå‚æ•°

#### useWatchFormValues

ç›‘å¬ node å†…æ•´ä¸ªè¡¨å•çš„å€¼

`<TFormValues = any>(node: FlowNodeEntity) => TFormValues | undefined`

```tsx pur
const values = useWatchFormValues(node)
```

#### useWatchFormValueIn

ç›‘å¬ node å†…æŸä¸ªè¡¨å•é¡¹çš„å€¼

`<TValue = any>(node: FlowNodeEntityï¼Œname: string) => TFormValues | undefined`

```tsx pur
const value = useWatchFormValueIn(node, name)
```

#### useWatchFormState

ç›‘å¬ node å†…è¡¨å•çš„çŠ¶æ€

`(node: FlowNodeEntity) => FormState | undefined`

```tsx pur
const formState = useWatchFormState(node)
```

#### useWatchFormErrors

ç›‘å¬ node å†…è¡¨å•çš„ Errors

`(node: FlowNodeEntity) => Errors | undefined`

```tsx pur
const errors = useWatchFormErrors(node)
```

#### useWatchFormWarnings

ç›‘å¬ node å†…è¡¨å•çš„ Warnings

`(node: FlowNodeEntity) => Warnings | undefined`

```tsx pur
const warnings = useWatchFormErrors(node)
```



---
url: /guide/advanced/free-layout/line.md
---

# çº¿æ¡

* [WorkflowLinesManager](https://github.com/bytedance/flowgram.ai/blob/main/packages/canvas-engine/free-layout-core/src/workflow-lines-manager.ts) ç®¡ç†æ‰€æœ‰çš„çº¿æ¡
* [WorkflowNodeLinesData](https://github.com/bytedance/flowgram.ai/blob/main/packages/canvas-engine/free-layout-core/src/entity-datas/workflow-node-lines-data.ts) èŠ‚ç‚¹ä¸Šè¿æ¥çš„çº¿æ¡ç®¡ç†
* [WorkflowLineEntity](https://github.com/bytedance/flowgram.ai/blob/main/packages/canvas-engine/free-layout-core/src/entities/workflow-line-entity.ts) çº¿æ¡å®ä½“

## è·å–æ‰€æœ‰çº¿æ¡çš„å®ä½“

```ts pure
const allLines = ctx.document.linesManager.getAllLines() // çº¿æ¡å®ä½“ åŒ…å« from/to åˆ†åˆ«ä»£è¡¨çº¿æ¡è¿æ¥çš„èŠ‚ç‚¹

```

## åˆ›å»º/åˆ é™¤çº¿æ¡

```ts pure
// fromå’Œ to ä¸ºå¯¹åº”è¦è¿çº¿çš„èŠ‚ç‚¹idï¼Œ fromPort, toPort ä¸º ç«¯å£ id, å¦‚æœèŠ‚ç‚¹ä¸ºå•ä¸ªç«¯å£å¯ä»¥ä¸æŒ‡å®š
const line = ctx.document.linesManager.createLine({ from, to, fromPort, toPort })

// åˆ é™¤çº¿æ¡
line.dispose()

```

## å¯¼å‡ºçº¿æ¡æ•°æ®

:::note çº¿æ¡åŸºæœ¬ç»“æ„:

* sourceNodeID: `string` å¼€å§‹èŠ‚ç‚¹ id
* targetNodeID: `string` ç›®æ ‡èŠ‚ç‚¹ id
* sourcePortID?: `string | number` å¼€å§‹ç«¯å£ id, ç¼ºçœåˆ™é‡‡ç”¨å¼€å§‹èŠ‚ç‚¹çš„é»˜è®¤ç«¯å£
* targetPortID?: `string | number` ç›®æ ‡ç«¯å£ id, ç¼ºçœåˆ™é‡‡ç”¨ç›®æ ‡èŠ‚ç‚¹çš„é»˜è®¤ç«¯å£

:::

```ts pure
const json = ctx.document.linesManager.toJSON()
```

## è·å–å½“å‰èŠ‚ç‚¹çš„è¾“å…¥/è¾“å‡ºèŠ‚ç‚¹æˆ–çº¿æ¡

```ts pure
import { WorkflowNodeLinesData } from '@flowgram.ai/free-layout-editor'

// è·å–å½“å‰èŠ‚ç‚¹çš„è¾“å…¥èŠ‚ç‚¹ï¼ˆé€šè¿‡è¿æ¥çº¿è®¡ç®—ï¼‰
node.getData(WorkflowNodeLinesData).inputNodes
// è·å–æ‰€æœ‰è¾“å…¥èŠ‚ç‚¹ ï¼ˆä¼šå¾€ä¸Šé€’å½’è·å–æ‰€æœ‰ï¼‰
node.getData(WorkflowNodeLinesData).allInputNodes
// è·å–è¾“å‡ºèŠ‚ç‚¹
node.getData(WorkflowNodeLinesData).outputNodes
// è·å–æ‰€æœ‰è¾“å‡ºèŠ‚ç‚¹
node.getData(WorkflowNodeLinesData).allOutputNodes
// è¾“å…¥çº¿æ¡
node.getData(WorkflowNodeLinesData).inputLines
// è¾“å‡ºçº¿æ¡
node.getData(WorkflowNodeLinesData).outputLines

```

## çº¿æ¡é…ç½®

æˆ‘ä»¬æä¾›ä¸°å¯Œçš„çº¿æ¡é…ç½®å‚æ•°, ç»™ `FreeLayoutEditorProvider`, è¯¦ç»†è§ [FreeLayoutProps](https://github.com/bytedance/flowgram.ai/blob/main/packages/client/free-layout-editor/src/preset/free-layout-props.ts)

```tsx pure
interface FreeLayoutProps {
    /**
     * çº¿æ¡é¢œè‰²é…ç½®
     */
    lineColor?: LineColor;
    /**
     * åˆ¤æ–­çº¿æ¡æ˜¯å¦æ ‡çº¢
     * @param ctx
     * @param fromPort
     * @param toPort
     * @param lines
     */
    isErrorLine?: (ctx: FreeLayoutPluginContext, fromPort: WorkflowPortEntity, toPort: WorkflowPortEntity | undefined, lines: WorkflowLinesManager) => boolean;
    /**
     * åˆ¤æ–­ç«¯å£æ˜¯å¦æ ‡çº¢
     * @param ctx
     * @param port
     */
    isErrorPort?: (ctx: FreeLayoutPluginContext, port: WorkflowPortEntity) => boolean;
    /**
     * åˆ¤æ–­ç«¯å£æ˜¯å¦ç¦ç”¨
     * @param ctx
     * @param port
     */
    isDisabledPort?: (ctx: FreeLayoutPluginContext, port: WorkflowPortEntity) => boolean;
    /**
     * åˆ¤æ–­çº¿æ¡ç®­å¤´æ˜¯å¦åè½¬
     * @param ctx
     * @param line
     */
    isReverseLine?: (ctx: FreeLayoutPluginContext, line: WorkflowLineEntity) => boolean;
    /**
     * åˆ¤æ–­çº¿æ¡æ˜¯å¦éšè—ç®­å¤´
     * @param ctx
     * @param line
     */
    isHideArrowLine?: (ctx: FreeLayoutPluginContext, line: WorkflowLineEntity) => boolean;
    /**
     * åˆ¤æ–­çº¿æ¡æ˜¯å¦å±•ç¤ºæµåŠ¨æ•ˆæœ
     * @param ctx
     * @param line
     */
    isFlowingLine?: (ctx: FreeLayoutPluginContext, line: WorkflowLineEntity) => boolean;
    /**
     * åˆ¤æ–­çº¿æ¡æ˜¯å¦ç¦ç”¨
     * @param ctx
     * @param line
     */
    isDisabledLine?: (ctx: FreeLayoutPluginContext, line: WorkflowLineEntity) => boolean;
    /**
     * åˆ¤æ–­çº¿æ¡æ˜¯å¦ç«–å‘
     * @param ctx
     * @param line
     */
    isVerticalLine?: (ctx: FreeLayoutPluginContext, line: WorkflowLineEntity) => boolean;
    /**
     * æ‹–æ‹½çº¿æ¡ç»“æŸ
     * @param ctx
     * @param params
     */
    onDragLineEnd?: (ctx: FreeLayoutPluginContext, params: onDragLineEndParams) => Promise<void>;
    /**
     * è®¾ç½®çº¿æ¡æ¸²æŸ“å™¨ç±»å‹
     * @param ctx
     * @param line
     */
    setLineRenderType?: (ctx: FreeLayoutPluginContext, line: WorkflowLineEntity) => LineRenderType | undefined;
    /**
     * è®¾ç½®çº¿æ¡æ ·å¼
     * @param ctx
     * @param line
     */
    setLineClassName?: (ctx: FreeLayoutPluginContext, line: WorkflowLineEntity) => string | undefined;
    /**
     * æ˜¯å¦å…è®¸åˆ›å»ºçº¿æ¡
     * @param ctx
     * @param fromPort - å¼€å§‹ç‚¹
     * @param toPort - ç›®æ ‡ç‚¹
     */
    canAddLine?: (ctx: FreeLayoutPluginContext, fromPort: WorkflowPortEntity, toPort: WorkflowPortEntity, lines: WorkflowLinesManager, silent?: boolean) => boolean;
    /**
     *
     * æ˜¯å¦å…è®¸åˆ é™¤çº¿æ¡
     * @param ctx
     * @param line - ç›®æ ‡çº¿æ¡
     * @param newLineInfo - æ–°çš„çº¿æ¡ä¿¡æ¯
     * @param silent - å¦‚æœä¸ºfalseï¼Œå¯ä»¥åŠ  toast å¼¹çª—
     */
    canDeleteLine?: (ctx: FreeLayoutPluginContext, line: WorkflowLineEntity, newLineInfo?: Required<WorkflowLinePortInfo>, silent?: boolean) => boolean;
    /**
     * æ˜¯å¦å…è®¸é‡ç½®çº¿æ¡
     * @param fromPort - å¼€å§‹ç‚¹
     * @param oldToPort - æ—§çš„è¿æ¥ç‚¹
     * @param newToPort - æ–°çš„è¿æ¥ç‚¹
     * @param lines - çº¿æ¡ç®¡ç†å™¨
     */
    canResetLine?: (ctx: FreeLayoutPluginContext, fromPort: WorkflowPortEntity, oldToPort: WorkflowPortEntity, newToPort: WorkflowPortEntity, lines: WorkflowLinesManager) => boolean;
}
```

### 1.è‡ªå®šä¹‰é¢œè‰²

```tsx pure

function App() {
  const editorProps: FreeLayoutProps = {
      lineColor: {
        hidden: 'transparent',
        default: '#4d53e8',
        drawing: '#5DD6E3',
        hovered: '#37d0ff',
        selected: '#37d0ff',
        error: 'red',
      },
      // ...others
  }
  return (
    <FreeLayoutEditorProvider {...editorProps}>
      <EditorRenderer className="demo-editor" />
    </FreeLayoutEditorProvider>
  )
}

```

### 2.è®©å•ä¸ªè¾“å‡ºç«¯å£åªèƒ½è¿ä¸€æ¡çº¿

```tsx pure

function App() {
  const editorProps: FreeLayoutProps = {
      /*
       * Check whether the line can be added
       * åˆ¤æ–­æ˜¯å¦è¿çº¿
       */
      canAddLine(ctx, fromPort, toPort) {
        // not the same node
        if (fromPort.node === toPort.node) {
          return false;
        }
        // æ§åˆ¶çº¿æ¡æ·»åŠ æ•°ç›®
        if (fromPort.availableLines.length >= 1) {
          return false
        }
        return true;
      },
      // ...others
  }
  return (
    <FreeLayoutEditorProvider {...editorProps}>
      <EditorRenderer className="demo-editor" />
    </FreeLayoutEditorProvider>
  )
}

```

### 3.è¿æ¥åˆ°ç©ºç™½åœ°æ–¹æ·»åŠ èŠ‚ç‚¹

ä»£ç è§è‡ªç”±å¸ƒå±€æœ€ä½³å®è·µ

```tsx pure

function App() {
  const editorProps: FreeLayoutProps = {
      /**
       * Drag the end of the line to create an add panel (feature optional)
       * æ‹–æ‹½çº¿æ¡ç»“æŸéœ€è¦åˆ›å»ºä¸€ä¸ªæ·»åŠ é¢æ¿ ï¼ˆåŠŸèƒ½å¯é€‰ï¼‰
       */
      async onDragLineEnd(ctx, params) {
        const { fromPort, toPort, mousePos, line, originLine } = params;
        if (originLine || !line) {
          return;
        }
        if (toPort) {
          return;
        }
        // è¿™é‡Œå¯ä»¥æ ¹æ® mousePos æ‰“å¼€æ·»åŠ é¢æ¿
        await ctx.get(WorkflowNodePanelService).call({
          fromPort,
          toPort: undefined,
          panelPosition: mousePos,
          enableBuildLine: true,
          panelProps: {
            enableNodePlaceholder: true,
            enableScrollClose: true,
          },
        });
      },
      // ...others
  }
  return (
    <FreeLayoutEditorProvider {...editorProps}>
      <EditorRenderer className="demo-editor" />
    </FreeLayoutEditorProvider>
  )
}

```

## åœ¨çº¿æ¡ä¸Šæ·»åŠ  Label

ä»£ç è§è‡ªç”±å¸ƒå±€æœ€ä½³å®è·µ

```ts pure

import { createFreeLinesPlugin } from '@flowgram.ai/free-lines-plugin';

const editorProps = {
  plugins: () => [
      /**
       * Line render plugin
       * è¿çº¿æ¸²æŸ“æ’ä»¶
       */
      createFreeLinesPlugin({
        renderInsideLine: LineAddButton,
      }),
  ]
}
```

## èŠ‚ç‚¹ç›‘å¬è‡ªèº«çš„è¿çº¿å˜åŒ–å¹¶åˆ·æ–°

```tsx pure

import {
  useRefresh,
  WorkflowNodeLinesData,
} from '@flowgram.ai/free-layout-editor';

function NodeRender({ node }) {
  const refresh = useRefresh()
  const linesData = node.get(WorkflowNodeLinesData)
  useEffect(() => {
    const dispose = linesData.onDataChange(() => refresh())
    return () => dispose.dispose()
  }, [])
  return <div>xxxx</div>
}

```

## ç›‘å¬æ‰€æœ‰çº¿æ¡çš„è¿çº¿å˜åŒ–

è¿™ä¸ªåœºæ™¯ç”¨äºå½“å¸Œæœ›åœ¨å¤–éƒ¨ç»„ä»¶ç›‘å¬çº¿æ¡è¿æ¥æƒ…å†µ

```ts pure
import { useEffect } from 'react'
import { WorkflowLinesManager, useRefresh } from '@flowgram.ai/free-layout-editor'


function SomeReact() {
  const refresh = useRefresh()
  const linesManager = useService(WorkflowLinesManager)
  useEffect(() => {
      const dispose = linesManager.onAvailableLinesChange(() => refresh())
      return () => dispose.dispose()
  }, [])
  console.log(ctx.document.linesManager.getAllLines())
}
```



---
url: /guide/advanced/free-layout/load.md
---

# åŠ è½½ä¸ä¿å­˜

ç”»å¸ƒçš„æ•°æ®é€šè¿‡ [WorkflowDocument](/api/core/workflow-document.md) æ¥å­˜å‚¨

## ç”»å¸ƒæ•°æ®

:::note æ–‡æ¡£æ•°æ®åŸºæœ¬ç»“æ„:

* nodes `array` èŠ‚ç‚¹åˆ—è¡¨, æ”¯æŒåµŒå¥—
* edges `array` è¾¹åˆ—è¡¨

:::

:::note èŠ‚ç‚¹æ•°æ®åŸºæœ¬ç»“æ„:

* id: `string` èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†, å¿…é¡»ä¿è¯å”¯ä¸€
* meta: `object` èŠ‚ç‚¹çš„ ui é…ç½®ä¿¡æ¯ï¼Œå¦‚è‡ªç”±å¸ƒå±€çš„ `position` ä¿¡æ¯æ”¾è¿™é‡Œ
* type: `string | number` èŠ‚ç‚¹ç±»å‹ï¼Œä¼šå’Œ `nodeRegistries` ä¸­çš„ `type` å¯¹åº”
* data: `object` èŠ‚ç‚¹è¡¨å•æ•°æ®, ä¸šåŠ¡å¯è‡ªå®šä¹‰
* blocks: `array` èŠ‚ç‚¹çš„åˆ†æ”¯, é‡‡ç”¨ `block` æ›´è´´è¿‘ `Gramming`, ç›®å‰ä¼šå­˜å­ç”»å¸ƒçš„èŠ‚ç‚¹
* edges: `array` å­ç”»å¸ƒçš„è¾¹æ•°æ®

:::

:::note è¾¹æ•°æ®åŸºæœ¬ç»“æ„:

* sourceNodeID: `string` å¼€å§‹èŠ‚ç‚¹ id
* targetNodeID: `string` ç›®æ ‡èŠ‚ç‚¹ id
* sourcePortID?: `string | number` å¼€å§‹ç«¯å£ id, ç¼ºçœåˆ™é‡‡ç”¨å¼€å§‹èŠ‚ç‚¹çš„é»˜è®¤ç«¯å£
* targetPortID?: `string | number` ç›®æ ‡ç«¯å£ id, ç¼ºçœåˆ™é‡‡ç”¨ç›®æ ‡èŠ‚ç‚¹çš„é»˜è®¤ç«¯å£

:::

```tsx pure title="initial-data.ts"
import { WorkflowJSON } from '@flowgram.ai/free-layout-editor';

export const initialData: WorkflowJSON = {
  nodes: [
    {
      id: 'start_0',
      type: 'start',
      meta: {
        position: { x: 0, y: 0 },
      },
      data: {
        title: 'Start',
        content: 'Start content'
      },
    },
    {
      id: 'node_0',
      type: 'custom',
      meta: {
        position: { x: 400, y: 0 },
      },
      data: {
        title: 'Custom',
        content: 'Custom node content'
      },
    },
    {
      id: 'end_0',
      type: 'end',
      meta: {
        position: { x: 800, y: 0 },
      },
      data: {
        title: 'End',
        content: 'End content'
      },
    },
  ],
  edges: [
    {
      sourceNodeID: 'start_0',
      targetNodeID: 'node_0',
    },
    {
      sourceNodeID: 'node_0',
      targetNodeID: 'end_0',
    },
  ],
};

```

## åŠ è½½

* é€šè¿‡ initialData åŠ è½½

```tsx pure
import { FreeLayoutEditorProvider, FreeLayoutPluginContext, EditorRenderer } from '@flowgram.ai/free-layout-editor'

function App({ data }) {
  return (
    <FreeLayoutEditorProvider initialData={data} {...otherProps}>
      <EditorRenderer className="demo-editor" />
    </FreeLayoutEditorProvider>
  )
}
```

* é€šè¿‡ ref åŠ¨æ€åŠ è½½

```tsx pure

import { FreeLayoutEditorProvider, FreeLayoutPluginContext, EditorRenderer } from '@flowgram.ai/free-layout-editor'

function App() {
  const ref = useRef<FreeLayoutPluginContext | undefined>();

  useEffect(async () => {
    const data = await request('https://xxxx/getJSON')
    ref.current.document.fromJSON(data)
    setTimeout(() => {
      // åŠ è½½åè§¦å‘ç”»å¸ƒçš„ fitview è®©èŠ‚ç‚¹è‡ªåŠ¨å±…ä¸­
      ref.current.document.fitView()
    }, 100)
  }, [])
  return (
    <FreeLayoutEditorProvider ref={ref} {...otherProps}>
      <EditorRenderer className="demo-editor" />
    </FreeLayoutEditorProvider>
  )
}
```

* åŠ¨æ€ reload æ‰€æœ‰æ•°æ®

```tsx pure

import { FreeLayoutEditorProvider, FreeLayoutPluginContext, EditorRenderer } from '@flowgram.ai/free-layout-editor'

function App({ data }) {
  const ref = useRef<FreeLayoutPluginContext | undefined>();

  useEffect(async () => {
    // å½“ data å˜åŒ–æ—¶å€™é‡æ–°åŠ è½½ç”»å¸ƒæ•°æ®
    await ref.current.document.reload(data)
    setTimeout(() => {
      // åŠ è½½åè§¦å‘ç”»å¸ƒçš„ fitview è®©èŠ‚ç‚¹è‡ªåŠ¨å±…ä¸­
      ref.current.document.fitView()
    }, 100)
  }, [data])
  return (
    <FreeLayoutEditorProvider ref={ref} {...otherProps}>
      <EditorRenderer className="demo-editor" />
    </FreeLayoutEditorProvider>
  )
}
```

## ç›‘å¬å˜åŒ–å¹¶è‡ªåŠ¨ä¿å­˜

```tsx pure

import { FreeLayoutEditorProvider, FreeLayoutPluginContext, EditorRenderer } from '@flowgram.ai/free-layout-editor'
import { debounce } from 'lodash'

function App() {
  const ref = useRef<FreeLayoutPluginContext | undefined>();

  useEffect(() => {
    // ç›‘å¬ç”»å¸ƒå˜åŒ– å»¶è¿Ÿ 1 ç§’ ä¿å­˜æ•°æ®, é¿å…ç”»å¸ƒé¢‘ç¹æ›´æ–°
    const toDispose = ref.current.document.onContentChange(debounce(() => {
        // é€šè¿‡ toJSON è·å–ç”»å¸ƒæœ€æ–°çš„æ•°æ®
        request('https://xxxx/save', {
          data: ref.current.document.toJSON()
        })
    }, 1000))
    return () => toDispose.dispose()
  }, [])
  return (
    <FreeLayoutEditorProvider ref={ref} {...otherProps}>
      <EditorRenderer className="demo-editor" />
    </FreeLayoutEditorProvider>
  )
}

```



---
url: /guide/advanced/free-layout/node.md
---

# èŠ‚ç‚¹

èŠ‚ç‚¹é€šè¿‡ [FlowNodeEntity](/api/core/flow-node-entity.md) å®šä¹‰

## èŠ‚ç‚¹æ•°æ®

é€šè¿‡ `node.toJSON()` å¯ä»¥è·å–

:::note åŸºæœ¬ç»“æ„:

* id: `string` èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†, å¿…é¡»ä¿è¯å”¯ä¸€
* meta: `object` èŠ‚ç‚¹çš„ ui é…ç½®ä¿¡æ¯ï¼Œå¦‚è‡ªç”±å¸ƒå±€çš„ `position` ä¿¡æ¯æ”¾è¿™é‡Œ
* type: `string | number` èŠ‚ç‚¹ç±»å‹ï¼Œä¼šå’Œ `nodeRegistries` ä¸­çš„ `type` å¯¹åº”
* data: `object` èŠ‚ç‚¹è¡¨å•æ•°æ®, ä¸šåŠ¡å¯è‡ªå®šä¹‰
* blocks: `array` èŠ‚ç‚¹çš„åˆ†æ”¯, é‡‡ç”¨ `block` æ›´è´´è¿‘ `Gramming` è‡ªç”±å¸ƒå±€å¸ƒå±€åœºæ™¯ä¼šç”¨åœ¨å­ç”»å¸ƒçš„å­èŠ‚ç‚¹
* edges: `array` å­ç”»å¸ƒçš„è¾¹æ•°æ®

:::

```ts pure
const nodeData: FlowNodeJSON = {
  id: 'xxxx',
  type: 'condition',
  data: {
    title: 'MyCondition',
    desc: 'xxxxx'
  },
}
```

## èŠ‚ç‚¹å®šä¹‰

åœ¨è‡ªç”±å¸ƒå±€åœºæ™¯ï¼ŒèŠ‚ç‚¹å®šä¹‰ç”¨äºå£°æ˜èŠ‚ç‚¹çš„åˆå§‹åŒ–ä½ç½®/å¤§å°ï¼Œç«¯å£ï¼Œè¡¨å•æ¸²æŸ“ç­‰, è¯¦ç»†è§ [å£°æ˜èŠ‚ç‚¹](/guide/getting-started/create-free-layout-simple.md#4-å£°æ˜èŠ‚ç‚¹)

## å½“å‰æ¸²æŸ“èŠ‚ç‚¹è·å–

é€šè¿‡ [useNodeRender](/api/hooks/use-node-render.md) è·å–èŠ‚ç‚¹ç›¸å…³æ–¹æ³•

## åˆ›å»ºèŠ‚ç‚¹

* é€šè¿‡ [WorkflowDocument](/api/core/workflow-document.md) åˆ›å»º

```ts pure
const ctx = useClientContext()

ctx.document.createWorkflowNode({
  id: 'xxx', // è¦ä¿è¯ç”»å¸ƒå†…å”¯ä¸€
  type: 'custom',
  meta: {
    /**
     * å¦‚æœä¸ä¼ å…¥ï¼Œåˆ™é»˜è®¤åœ¨ç”»å¸ƒä¸­é—´åˆ›å»º
     * å¦‚æœè¦é€šè¿‡é¼ æ ‡ä½ç½®è·å– position (å¦‚ç‚¹å‡»ç”»å¸ƒä»»æ„ä½ç½®åˆ›å»ºèŠ‚ç‚¹)ï¼Œå¯é€šè¿‡ `ctx.playground.config.getPosFromMouseEvent(mouseEvent)` è½¬æ¢
     */
    position: { x: 100, y: 100 } //
  },
  data: {}, // è¡¨å•ç›¸å…³æ•°æ®
  blocks: [], // å­ç”»å¸ƒçš„èŠ‚ç‚¹
  edges: [] // å­ç”»å¸ƒçš„è¾¹
})

```

* é€šè¿‡ WorkflowDragService åˆ›å»º, è§[è‡ªç”±å¸ƒå±€åŸºç¡€ç”¨æ³•](/examples/free-layout/free-layout-simple.md)

```ts pure
const dragService = useService<WorkflowDragService>(WorkflowDragService);

// è¿™é‡Œçš„ mouseEvent ä¼šè‡ªåŠ¨è½¬æˆ ç”»å¸ƒçš„ position
dragService.startDragCard(nodeType, mouseEvent, {
  id: 'xxxx',
  data: {}, // è¡¨å•ç›¸å…³æ•°æ®
  blocks: [], // å­ç”»å¸ƒçš„èŠ‚ç‚¹
  edges: [] // å­ç”»å¸ƒçš„è¾¹
})

```

## åˆ é™¤èŠ‚ç‚¹

é€šè¿‡ `node.dispose` åˆ é™¤èŠ‚ç‚¹

```tsx pure
function BaseNode({ node }) {
  function onClick() {
    node.dispose()
  }
  return (
    <button onClick={onClick}>Delete</button>
  )
}
```

## æ›´æ–°èŠ‚ç‚¹ data æ•°æ®

* é€šè¿‡ [useNodeRender](/api/hooks/use-node-render.md) æˆ– [getNodeForm](/api/utils/get-node-form.md) è·å–èŠ‚ç‚¹çš„ data æ•°æ®

```tsx pure
function BaseNode() {
  const { form } = useNodeRender();
  // å¯¹åº”èŠ‚ç‚¹çš„ data æ•°æ®
  console.log(form.values)

  // ç›‘å¬èŠ‚ç‚¹çš„æ•°æ®å˜åŒ–
  useEffect(() => {
    const toDispose = form.onFormValuesChange(() => {
      // changed
    })
    return () => toDispose.dispose()
  }, [form])

  function onChange(e) {
    form.setValueIn('title', e.target.value)
  }
  return <input value={form.getValueIn('title')} onChange={onChange}/>
}
```

* é€šè¿‡ Field æ›´æ–°è¡¨å•æ•°æ®, è¯¦ç»†è§ [è¡¨å•çš„ä½¿ç”¨](/guide/advanced/form.md)

```tsx pure

function FormRender() {
  return (
    <Field name="title">
      <Input />
    </Field>
  )
}
```

## æ›´æ–°èŠ‚ç‚¹çš„ extInfo æ•°æ®

extInfo ç”¨äºå­˜å‚¨ ä¸€äº› ui çŠ¶æ€, å¦‚æœæœªå¼€å¯èŠ‚ç‚¹å¼•æ“ï¼ŒèŠ‚ç‚¹çš„ data æ•°æ®ä¼šé»˜è®¤å­˜åˆ° extInfo é‡Œ

```tsx pure
function BaseNode({ node }) {
  const times = node.getExtInfo()?.times || 0
  function onClick() {
    node.updateExtInfo({ times: times ++ })
  }
  return (
    <div>
      <span>Click Times: {times}</span>
      <button onClick={onClick}>Click</button>
    </div>
  )
}
```



---
url: /guide/advanced/free-layout/port.md
---

# ç«¯å£

* [WorkflowNodePortsData](https://github.com/bytedance/flowgram.ai/blob/main/packages/canvas-engine/free-layout-core/src/entity-datas/workflow-node-ports-data.ts) ç®¡ç†èŠ‚ç‚¹çš„æ‰€æœ‰ç«¯å£ä¿¡æ¯
* [WorkflowPortEntity](https://github.com/bytedance/flowgram.ai/blob/main/packages/canvas-engine/free-layout-core/src/entities/workflow-port-entity.ts) ç«¯å£å®ä¾‹
* [WorkflowPortRender](https://github.com/bytedance/flowgram.ai/blob/main/packages/plugins/free-lines-plugin/src/components/workflow-port-render/index.tsx) ç«¯å£æ¸²æŸ“ç»„ä»¶

## å®šä¹‰ç«¯å£

* é™æ€ç«¯å£

èŠ‚ç‚¹å£°æ˜æ·»åŠ  `defaultPorts` , å¦‚ `{ type: 'input' }`, åˆ™ä¼šåœ¨èŠ‚ç‚¹å·¦ä¾§åŠ å…¥è¾“å…¥ç«¯å£

```ts pure title="node-registries.ts"
{
  type: 'start',
  meta: {
    defaultPorts: [{ type: 'output' }, { type: 'input'}]
  },
}
```

* åŠ¨æ€ç«¯å£

èŠ‚ç‚¹å£°æ˜æ·»åŠ  `useDynamicPort` , å½“è®¾ç½®ä¸º true åˆ™ä¼šåˆ°èŠ‚ç‚¹dom ä¸Šå¯»æ‰¾ data-port-id å’Œ data-port-type å±æ€§çš„ dom ä½œä¸ºç«¯å£

```ts pure title="node-registries.ts"
{
  type: 'condition',
  meta: {
    defaultPorts: [{ type: 'input'}]
    useDynamicPort: true
  },
}

```

```tsx pure

/**
*  åŠ¨æ€ç«¯å£é€šè¿‡ querySelectorAll('[data-port-id]') æŸ¥æ‰¾ç«¯å£ä½ç½®
 */
function BaseNode() {
  return (
    <div>
      <div data-port-id="condition-if-0" data-port-type="output"></div>
      <div data-port-id="condition-if-1" data-port-type="output"></div>
      {/* others */}
    </div>
  )
}
```

## ç«¯å£æ¸²æŸ“

ç«¯å£æœ€ç»ˆé€šè¿‡ `WorkflowPortRender` ç»„ä»¶æ¸²æŸ“ï¼Œæ”¯æŒè‡ªå®šä¹‰ style, æˆ–è€…ä¸šåŠ¡åŸºäºæºç é‡æ–°å®ç°è¯¥ç»„ä»¶, å‚è€ƒ [è‡ªç”±å¸ƒå±€æœ€ä½³å®è·µ - èŠ‚ç‚¹æ¸²æŸ“](https://github.com/bytedance/flowgram.ai/blob/main/apps/demo-free-layout/src/components/base-node/node-wrapper.tsx)

```tsx pure

import { WorkflowPortRender, useNodeRender } from '@flowgram.ai/free-layout-editor';

function BaseNode() {
  const { ports } = useNodeRender();
  return (
    <div>
      <div data-port-id="condition-if-0" data-port-type="output"></div>
      <div data-port-id="condition-if-1" data-port-type="output"></div>
      {ports.map((p) => (
        <WorkflowPortRender key={p.id} entity={p} className="xxx" style={{ /* custom style */}}/>
      ))}
    </div>
  )
}
```

## è·å–ç«¯å£æ•°æ®

```ts pure
const ports = node.getData(WorkflowNodePortsData)

console.log(ports.inputPorts) // è·å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰è¾“å…¥ç«¯å£
console.log(ports.outputPorts) // è·å–å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰è¾“å‡ºç«¯å£

console.log(ports.inputPorts.map(port => port.availableLines)) // é€šè¿‡ç«¯å£æ‰¾åˆ°è¿æ¥çš„çº¿æ¡

ports.updateDynamicPorts() // å½“åŠ¨æ€ç«¯å£ä¿®æ”¹äº† dom ç»“æ„æˆ–ä½ç½®ï¼Œå¯ä»¥é€šè¿‡è¯¥æ–¹æ³•æ‰‹åŠ¨åˆ·æ–°ç«¯å£ä½ç½®(dom æ¸²æŸ“æœ‰å»¶è¿Ÿï¼Œæœ€å¥½åœ¨ useEffect æˆ–è€… setTimeout æ‰§è¡Œ)
```



---
url: /guide/advanced/free-layout/sub-canvas.md
---

# å­ç”»å¸ƒ

è¯¦ç»†ä»£ç è§ [è‡ªç”±å¸ƒå±€æœ€ä½³å®è·µ](/examples/free-layout/free-feature-overview.md)

## æ·»åŠ å­ç”»å¸ƒæ’ä»¶

```tsx pure

import { createContainerNodePlugin } from '@flowgram.ai/free-container-plugin';

function App() {
  const editorProps = {
    plugins: () => [
      createContainerNodePlugin({}),
    ]
    // ..others
  }
  return (
    <FreeLayoutEditorProvider {...editorProps}>
      <EditorRenderer className="demo-editor" />
    </FreeLayoutEditorProvider>
  )
}
```

## å®šä¹‰å­ç”»å¸ƒèŠ‚ç‚¹

```tsx pure
import { SubCanvasRender } from '@flowgram.ai/free-container-plugin';

export const LoopNodeRegistry: FlowNodeRegistry = {
  type: 'loop',
  info: {
    icon: iconLoop,
    description:
      'Used to repeatedly execute a series of tasks by setting the number of iterations and logic.',
  },
  meta: {
    /**
     * å­ç”»å¸ƒæ ‡è®°
     */
    isContainer: true,
    /**
    * å­ç”»å¸ƒé»˜è®¤å¤§å°è®¾ç½®
     */
    size: {
      width: 560,
      height: 400,
    },
    /**
    * å­ç”»å¸ƒ padding è®¾ç½®
     */
    padding: () => ({ // å®¹å™¨ padding è®¾ç½®
      top: 150,
      bottom: 100,
      left: 100,
      right: 100,
    }),
    /**
      * æ§åˆ¶å­ç”»å¸ƒå†…çš„èŠ‚ç‚¹é€‰ä¸­çŠ¶æ€
      */
    selectable(node: WorkflowNodeEntity, mousePos?: PositionSchema): boolean {
      if (!mousePos) {
        return true;
      }
      const transform = node.getData<FlowNodeTransformData>(FlowNodeTransformData);
      // é¼ æ ‡å¼€å§‹æ—¶æ‰€åœ¨ä½ç½®ä¸åŒ…æ‹¬å½“å‰èŠ‚ç‚¹æ—¶æ‰å¯é€‰ä¸­
      return !transform.bounds.contains(mousePos.x, mousePos.y);
    },
  },
  formMeta: {
    render: () => (
      <div>
        { /* others */ }
        <SubCanvasRender />
      </div>
    )
  }
}
```



---
url: /guide/advanced/history.md
---

# å†å²è®°å½•

Undo/Redo æ˜¯ FlowGram.AI çš„ä¸€ä¸ªæ’ä»¶ï¼Œåœ¨ @flowgram.ai/fixed-layout-editor å’Œ @flowgram.ai/free-layout-editor ä¸¤ç§æ¨¡å¼çš„ç¼–è¾‘å™¨ä¸­å‡æœ‰æä¾›è¯¥åŠŸèƒ½ã€‚

## 1. å¿«é€Ÿå¼€å§‹

[> Demo Detail](https://github.com/bytedance/flowgram.ai/blob/main/apps/demo-fixed-layout/src/hooks/use-editor-props.ts#L125)

### 1.1. å¼€å¯ history

ä½¿ç”¨ Undo/Redo åŠŸèƒ½å‰éœ€è¦å…ˆå¼•å…¥ç¼–è¾‘å™¨ï¼Œä»¥å›ºå®šå¸ƒå±€ç¼–è¾‘å™¨ä¸ºä¾‹ã€‚

1. package.json æ·»åŠ ä¾èµ–

```tsx pure title="use-editor-props.tsx" {4}
export function useEditorProps() {
  return useMemo(
    () => ({
      history: {
        enable: true,
        enableChangeNode: true // Listen Node engine data change
      }
    })
  )
}
```

å¼€å¯ä¹‹åå°†è·å¾—ä»¥ä¸‹èƒ½åŠ›ï¼š

ç®€ä»‹
<td>æè¿°</td>
<td>è‡ªç”±å¸ƒå±€</td>
<td>å›ºå®šå¸ƒå±€</td>

Undo/Redo å¿«æ·é”®
<td>ç”»å¸ƒä¸Šä½¿ç”¨ Cmd/Ctrl + Z è§¦å‘ Undo</td>
<td>âœ…</td>
<td>âœ…</td>

ç”»å¸ƒä¸Šä½¿ç”¨ Cmd/Ctrl + Shift + Z è§¦å‘ Redo
<td>âœ…</td>
<td>âœ…</td>

ç”»å¸ƒèŠ‚ç‚¹æ“ä½œæ”¯æŒundo/redo
<td>å¢åˆ èŠ‚ç‚¹ </td>
<td>âœ…</td>
<td>âœ…</td>

å¢åˆ è¿çº¿
<td>âœ…</td>
<td>âŒ</td>

ç§»åŠ¨èŠ‚ç‚¹
<td>âœ…</td>
<td>âœ…</td>

å¢åˆ åˆ†æ”¯
<td>âŒ</td>
<td>âœ…</td>

ç§»åŠ¨åˆ†æ”¯
<td>âŒ</td>
<td>âœ…</td>

æ·»åŠ åˆ†ç»„
<td>âŒ</td>
<td>âœ…</td>

å–æ¶ˆåˆ†ç»„
<td>âŒ</td>
<td>âœ…</td>

ç”»å¸ƒæ‰¹é‡æ“ä½œ
<td>åˆ é™¤èŠ‚ç‚¹</td>
<td>âœ…</td>
<td>âœ…</td>

ç§»åŠ¨èŠ‚ç‚¹
<td>âœ…</td>
<td>âœ…</td>

### 1.2. å…³é—­ history

å¦‚æœæŸäº›ç³»ç»Ÿè§¦å‘çš„æ•°æ®å˜æ›´ä¸å¸Œæœ›è¢«undo redoç›‘å¬åˆ°ï¼Œå¯ä»¥ä¸»åŠ¨å…³æ‰ å†å²æœåŠ¡ æ“ä½œå®Œæ•°æ®å†é‡æ–°å¯åŠ¨

```tsx pure
const { history } = useClientContext();
history.stop()
// åšä¸€äº›ä¸å¸Œæœ›è¢«æ•è·çš„æ“ä½œï¼Œ è¿™äº›å˜æ›´ä¸ä¼šè¢«è®°å½•åˆ°æ“ä½œæ ˆ
...
history.start()
```

### 1.3. Undo/Redo è°ƒç”¨

ä¸€èˆ¬ Undo/Redo ä¼šåœ¨ç•Œé¢ä¸Šæä¾›ä¸¤ä¸ªæŒ‰é’®å…¥å£ï¼Œç‚¹å‡»äº†èƒ½è§¦å‘ Undo å’Œ Redoï¼ŒæŒ‰é’®æœ¬èº«éœ€è¦æœ‰æ˜¯å¦å¯ä»¥ Undo/Redo çš„çŠ¶æ€ã€‚

```tsx pure
export function useUndoRedo(): UndoRedo {
  const { history } = useClientContext();
  const [canUndo, setCanUndo] = useState(false);
  const [canRedo, setCanRedo] = useState(false);

  useEffect(() => {
    const toDispose = history.undoRedoService.onChange(() => {
      setCanUndo(history.canUndo());
      setCanRedo(history.canRedo());
    });
    return () => {
      toDispose.dispose();
    };
  }, []);

  return {
    canUndo,
    canRedo,
    undo: () => history.undo(),
    redo: () => history.redo(),
  };
}
```

## 2. åŠŸèƒ½æ‰©å±•

### 2.1. æ“ä½œæ³¨å†Œ

æ“ä½œé€šè¿‡ operationMetas å»æ³¨å†Œæ“ä½œ

```tsx pure title="use-editor-props.tsx"
...
history={{
  enable: true,
  operationMetas: [
    {
        type: 'addNode',
        apply: () => { console.log('addNode')},
        inverse: (op) => ({ type: 'deleteNode', value: op.value })
    }
  ]
}}
```

`OperationMeta` æ ¸å¿ƒå®šä¹‰å¦‚ä¸‹

* `type` æ˜¯æ“ä½œçš„å”¯ä¸€æ ‡è¯†
* `inverse` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›å½“å‰æ“ä½œçš„é€†æ“ä½œ
* `apply` æ˜¯æ“ä½œè¢«è§¦å‘çš„æ—¶å€™æ‰§è¡Œçš„é€»è¾‘

```tsx pure
export interface OperationMeta {
  /**
   * æ“ä½œç±»å‹ éœ€è¦å”¯ä¸€
   */
  type: string;
  /**
   * å°†ä¸€ä¸ªæ“ä½œè½¬æ¢æˆå¦ä¸€ä¸ªé€†æ“ä½œï¼Œ å¦‚insertè½¬æˆdelete
   * @param op æ“ä½œ
   * @returns é€†æ“ä½œ
   */
  inverse: (op: Operation) => Operation;
  /**
   * æ‰§è¡Œæ“ä½œ
   * @param operation æ“ä½œ
   */
  apply(operation: Operation, source: any): void | Promise<void>;
}
```

å‡è®¾æˆ‘è¦åšå¢åˆ èŠ‚ç‚¹æ”¯æŒ Undo/Redo çš„åŠŸèƒ½ï¼Œæˆ‘å°±éœ€è¦æ·»åŠ ä¸¤ä¸ªæ“ä½œ

```tsx pure
{
  type: 'addNode',
  inverse: op => ({ ...op, type: 'deleteNode' }),
  apply(op, ctx) {
    document = ctx.get(Document)
    document.addNode(op.value)
  },
}
```

```tsx pure
{
  type: 'deleteNode',
  inverse: op => ({ ...op, type: 'addNode' }),
  apply(op, ctx) {
    document = ctx.get(Document)
    document.deleteNode(op.value.id)
  },
}
```

### 2.2. æ“ä½œåˆå¹¶

operationMeta æ”¯æŒ shouldMerge æ¥è‡ªå®šä¹‰åˆå¹¶ç­–ç•¥ï¼Œå¦‚æœé¢‘ç¹è§¦å‘çš„æ“ä½œå¯ä»¥è¿›è¡Œåˆå¹¶

:::warning shouldMerge è¿”å›

* è¿”å› false ä»£è¡¨ä¸åˆå¹¶
* è¿”å› true ä»£è¡¨åˆå¹¶è¿›ä¸€ä¸ªæ“ä½œæ ˆå…ƒç´ 
* è¿”å› Operation ä»£è¡¨åˆå¹¶æˆä¸€ä¸ªæ“ä½œ

:::

ä»¥ä¸‹ç¤ºä¾‹æ˜¯ä¸€ä¸ªåˆå¹¶ 500ms å†…å¯¹åŒä¸€ä¸ªå­—æ®µç¼–è¾‘è¿›è¡Œåˆå¹¶

```tsx pure
{
  type: 'changeData',
  inverse: op => ({ ...op, type: 'changeData' }),
  apply(op, ctx) {},
  shouldMerge: (op, prev, element) => {
    // åˆå¹¶500mså†…çš„æ“ä½œ
    if (Date.now() - element.getTimestamp() < 500) {
      if (
        op.type === prev.type && // ç›¸åŒç±»å‹
        op.value.id === prev.value.id && // ç›¸åŒèŠ‚ç‚¹
        op.value?.path === prev.value?.path // ç›¸åŒè·¯å¾„
      ) {
        return {
          type: op.type,
          value: {
            ...op.value,
            value: op.value.value,
            oldValue: prev.value.oldValue,
          },
        };
      }
    }
    return false;
  }
}
```

### 2.3. æ“ä½œæ‰§è¡Œ

1. å•æ“ä½œæ‰§è¡Œ

é€šè¿‡ pushOperation è§¦å‘, å¦‚ä¸‹ç¤ºä¾‹ä½¿ç”¨æ–¹åœ¨ä¸šåŠ¡ä¸­è§¦å‘åˆšåˆšå®šä¹‰çš„æ“ä½œ

```tsx pure
function handleAddNode () {
   const { history } = useClientContext()
   history.pushOperation({
       type: 'addNode',
       value: {
          name: 'xx'
          id: 'xxx'
       }
   })
}
```

2. æ‰¹é‡æ‰§è¡Œ
   é€šè¿‡ transact è°ƒç”¨çš„å‡½æ•°ä¸­æ‰€æœ‰æ‰§è¡Œçš„æ“ä½œéƒ½ä¼šè¢«åˆå¹¶è¿›ä¸€ä¸ªæ ˆå…ƒç´ ï¼Œ undo/redo çš„æ—¶å€™ä¼šè¢«ä¸€èµ·æ‰§è¡Œ
   å¦‚ä¸‹æ˜¯å®ç°äº†ä¸€ä¸ªæ‰¹é‡åˆ é™¤çš„ä¾‹å­ï¼š

```tsx pure
function deleteNodes(nodes: FlowNodeEntity[]) {
  const { history } = useClientContext()
  history.transact(() => {
    nodes.forEach(node => {
      history.pushOperation({
        type: OperationType.deleteNode,
        value: {
          fromId: fromNode.id,
          data: node.data,
        },
      });
    });
  });
}
```

### 2.4. æ’¤é”€é‡åš

1. æ’¤é”€é‡åš
   æ’¤é”€æ‰§è¡Œ history.undo æ–¹æ³•
   é‡åšæ‰§è¡Œ history.redo æ–¹æ³•

```tsx pure
function undo() {
    const { history } = useClientContext();
    history.undo();
}

function redo() {
    const { history } = useClientContext();
    history.redo();
}
```

2. ç›‘å¬æ’¤é”€é‡åš
   ç›‘å¬ undoRedoService.onChange çš„ onChange äº‹ä»¶å³å¯
   å¦‚ä¸‹æ˜¯ä¸€ä¸ª undo/redo è§¦å‘åè·¯ç”±å¯¹åº”æ“ä½œçš„uriï¼ˆé€‰ä¸­å¯¹åº”èŠ‚ç‚¹æˆ–è¡¨å•é¡¹ï¼‰

```tsx pure
function listenHistoryChange() {
  const { history } = useClientContext();
  history.undoRedoService.onChange(
    ({ type, element }) => {
      if (type === UndoRedoChangeType.PUSH) {
        return;
      }
      const op = element.getLastOperation();
      if (!op) {
        return;
      }
      if (op.uri) {
        // goto somewhere
      }
    },
  )
}
```

### 2.5. æ“ä½œå†å²

1. æŸ¥çœ‹åˆ·æ–°
   å¯ä»¥é€šè¿‡ HistoryStack.items è·å¾—å†å²è®°å½•ï¼Œ é€šè¿‡ç›‘å¬ HistoryStack.onChange äº‹ä»¶æ¥åˆ·æ–°ç•Œé¢

```tsx pure
import React from 'react';

export function HistoryList() {
  const { historyStack } = useService<HistoryManager>(HistoryManager)
  const { refresh } = useRefresh()
  let items = historyManager.historyStack.items;

  useEffect(() => {
      const disposable = historyStack.onChange(() => {
          refresh()
      ])

      return () => {
          disposable.dispose()
      }
  }, [])

  return (
      <ul>
        {items.map((item, index) => (
          <li key={index}>
            <div>
              {item.type}({item.id}):
              {item.operations.map((o, index) => (
                <Tooltip
                  key={index}
                  title={(o.description || '') + `----uri: ${o.uri?.displayName}`}
                >
                  {o.label || o.type}
                </Tooltip>
              ))}
            </div>

          </li>
        ))}
      </ul>
  );
}
```

2. æŒä¹…åŒ–
   æŒä¹…åŒ–æ˜¯é€šè¿‡ history-storage æ’ä»¶å®ç°

* databaseNameï¼š æ•°æ®åº“åç§°
* resourceStorageLimitï¼š èµ„æºå­˜å‚¨é™åˆ¶æ•°é‡

å¼•å…¥ @flowgram.ai/history-storage åŒ…åï¼Œå¯ä½¿ç”¨è¯¥æ’ä»¶

```tsx pure
import { createHistoryStoragePlugin } from '@flowgram.ai/history-storage';

createHistoryStoragePlugin({
    databaseName: 'your-history',
    resourceStorageLimit: 50,
}),
```

é€šè¿‡ useStorageHistoryItems æŸ¥è¯¢æ•°æ®åº“åˆ—è¡¨

```tsx pure
import {
  useStorageHistoryItems,
} from '@flowgram.ai/history-storage';

export const HistoryList = () => {
  const { uri } = useCurrentWidget();

  const { items } = useStorageHistoryItems(
    storage,
    uri.withoutQuery().toString(),
  );

  return <>
    { JSON.stringify(items) }
  </>
}
```

## 3. API åˆ—è¡¨

### 3.1. [OperationMeta](https://flowgram.ai/auto-docs/fixed-history-plugin/interfaces/OperationMeta.html)

æ“ä½œå…ƒæ•°æ®ï¼Œç”¨ä»¥å®šä¹‰ä¸€ä¸ªæ“ä½œ

### 3.2. [Operation](https://flowgram.ai/auto-docs/fixed-history-plugin/interfaces/Operation.html)

æ“ä½œæ•°æ®ï¼Œé€šè¿‡ type å’Œ OperationMeta å…³è”

### 3.3. [OperationService](https://flowgram.ai/auto-docs/fixed-history-plugin/classes/OperationService.html)

[onApply](https://flowgram.ai/auto-docs/fixed-history-plugin/classes/OperationService.html#onapply)
æƒ³ç›‘å¬æŸä¸ªè§¦å‘çš„æ“ä½œå¯ä»¥ä½¿ç”¨onApply

```tsx pure
useService(OperationService).onApply((op: Operation) => {
    console.log(op)
    // æ­¤å¤„å¯ä»¥æ ¹æ®typeæ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘
})
```

### 3.4. [HistoryService](https://flowgram.ai/auto-docs/fixed-history-plugin/classes/HistoryService.html)

History æ¨¡å—æ ¸å¿ƒ API æš´éœ²çš„Service

### 3.5. [UndoRedoService](https://flowgram.ai/auto-docs/fixed-history-plugin/classes/UndoRedoService.html)

ç®¡ç† UndoRedo æ ˆçš„æœåŠ¡

### 3.6. [HistoryStack](https://flowgram.ai/auto-docs/fixed-history-plugin/classes/HistoryStack.html)

å†å²æ ˆï¼Œç›‘å¬æ‰€æœ‰ push undo redo æ“ä½œï¼Œå¹¶è®°å½•åˆ°æ ˆé‡Œé¢

### 3.7. [HistoryDatabase](https://flowgram.ai/auto-docs/history-storage/classes/HistoryDatabase.html)

æŒä¹…åŒ–æ•°æ®åº“æ“ä½œ



---
url: /guide/advanced/minimap.md
---

# ç¼©ç•¥å›¾



## EditorProps

```ts pure
import { createMinimapPlugin } from '@flowgram.ai/minimap-plugin'


{
  plugins: () => [
    /**
     * Minimap plugin
     */
    createMinimapPlugin({
      disableLayer: true,
      enableDisplayAllNodes: true,
      canvasStyle: {
        canvasWidth: 182,
        canvasHeight: 102,
        canvasPadding: 50,
        canvasBackground: 'rgba(245, 245, 245, 1)',
        canvasBorderRadius: 10,
        viewportBackground: 'rgba(235, 235, 235, 1)',
        viewportBorderRadius: 4,
        viewportBorderColor: 'rgba(201, 201, 201, 1)',
        viewportBorderWidth: 1,
        viewportBorderDashLength: 2,
        nodeColor: 'rgba(255, 255, 255, 1)',
        nodeBorderRadius: 2,
        nodeBorderWidth: 0.145,
        nodeBorderColor: 'rgba(6, 7, 9, 0.10)',
        overlayColor: 'rgba(255, 255, 255, 0)',
      },
      inactiveDebounceTime: 1,
    }),
  ]
}
```

## ç¼©ç•¥å›¾ç»„ä»¶

```tsx pure
import { FlowMinimapService, MinimapRender } from '@flowgram.ai/minimap-plugin';
import { useService } from '@flowgram.ai/editor'; // æˆ– free-layout-editor


export const Minimap = () => {
  const minimapService = useService(FlowMinimapService);
  return (
    <div
      style={{
        position: 'absolute',
        left: 16,
        bottom: 51,
        zIndex: 100,
        width: 182,
      }}
    >
      <MinimapRender
        service={minimapService}
        containerStyles={{
          pointerEvents: 'auto',
          position: 'relative',
          top: 'unset',
          right: 'unset',
          bottom: 'unset',
          left: 'unset',
        }}
        inactiveStyle={{
          opacity: 1,
          scale: 1,
          translateX: 0,
          translateY: 0,
        }}
      />
    </div>
  );
};

```



---
url: /guide/advanced/shortcuts.md
---

# å¿«æ·é”®

## è‡ªå®šä¹‰å¿«æ·é”®

```ts pure
// æ·»åŠ åˆ° EditorProps
{
  shortcuts(shortcutsRegistry, ctx) {
      // æŒ‰ä½ cmmand + aï¼Œé€‰ä¸­æ‰€æœ‰èŠ‚ç‚¹
      shortcutsRegistry.addHandlers({
        commandId: 'selectAll',
        shortcuts: ['meta a', 'ctrl a'],
        isEnabled: (...args) => true,
        execute(...args) {
          const allNodes = ctx.document.getAllNodes();
          ctx.playground.selectionService.selection = allNodes;
        },
      });
  },
}

```

## é€šè¿‡ CommandService è°ƒç”¨å¿«æ·é”®

```ts pure
const commandService = useService(CommandService)
/**
 * è°ƒç”¨å‘½ä»¤æœåŠ¡, args å‚æ•°ä¼šé€ä¼ ç»™ execute å’Œ isEnabled
 */
commandService.executeCommand('selectAll', ...args)

// OR
ctx.get(CommandService).executeCommand('selectAll', ...args)
```



---
url: /guide/advanced/variable/basic.md
---

# å˜é‡åŸºç¡€

## ä¸šåŠ¡èƒŒæ™¯

åœ¨ Workflow ç¼–æ’ä¸­ï¼ŒèŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´éœ€è¦ä¼ é€’ä¿¡æ¯ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨**å˜é‡**æ¥å­˜å‚¨å’Œç®¡ç†è¿™äº›ä¿¡æ¯ã€‚

:::warning ä¸€ä¸ªå˜é‡ç”±ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ç»„æˆï¼š

1. **å”¯ä¸€æ ‡è¯†ç¬¦**ï¼šå˜é‡çš„åå­—ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„å˜é‡ï¼Œä»¥ä¾¿åœ¨ç¨‹åºä¸­å¯ä»¥å‡†ç¡®åœ°å¼•ç”¨å’Œä½¿ç”¨å®ƒã€‚å¦‚ï¼š`userName` æˆ– `totalAmount`ã€‚
2. **å€¼**ï¼šå˜é‡å­˜å‚¨çš„æ•°æ®ã€‚å€¼å¯ä»¥æ˜¯å¤šç§ç±»å‹ï¼Œæ¯”å¦‚æ•°å­—ï¼ˆå¦‚ `42`ï¼‰ã€å­—ç¬¦ä¸²ï¼ˆå¦‚ `"Hello!"`ï¼‰ã€å¸ƒå°”å€¼ï¼ˆå¦‚ `true`ï¼‰ç­‰ã€‚
3. **ç±»å‹**ï¼šå˜é‡å¯ä»¥å­˜å‚¨çš„æ•°æ®ç§ç±»ã€‚ç±»å‹å†³å®šäº†å˜é‡å¯ä»¥æ¥å—ä»€ä¹ˆæ ·çš„å€¼ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå˜é‡å¯ä»¥æ˜¯æ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²æˆ–å¸ƒå°”å€¼ç­‰ã€‚

:::

ä¸‹é¢æ˜¯ä¸€ä¸ªæµç¨‹ç¼–æ’çš„ä¾‹å­ï¼šWebSearch èŠ‚ç‚¹è·å–åˆ°çŸ¥è¯†ï¼Œé€šè¿‡ natural\_language\_desc ä¼ é€’åˆ° LLM èŠ‚ç‚¹è¿›è¡Œåˆ†æ

åœ¨è¯¥ä¾‹å­ä¸­ï¼š
1\. WebSearch èŠ‚ç‚¹å°†ä¿¡æ¯ï¼ˆå€¼ï¼‰å­˜åœ¨ natural\_language\_desc ä¸ºå”¯ä¸€æ ‡è¯†ç¬¦çš„å˜é‡å†…
2\. LLM èŠ‚ç‚¹é€šè¿‡ natural\_language\_desc å”¯ä¸€æ ‡è¯†ç¬¦è·å–åˆ°çŸ¥è¯†åº“æ£€ç´¢çš„ä¿¡æ¯ï¼ˆå€¼ï¼‰ï¼Œå¹¶ä¼ å…¥ LLM èŠ‚ç‚¹è¿›è¡Œåˆ†æ
3\. natural\_language\_desc å˜é‡çš„ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨åœ¨ç½‘ç»œä¸­æ£€ç´¢åˆ°çš„ä¿¡æ¯å†…å®¹ï¼Œä¾‹å¦‚ "DeepSeek ä»Šæ—¥æœ‰æ–°æ¨¡å‹å‘å¸ƒ"

## ä»€ä¹ˆæ˜¯å˜é‡å¼•æ“ï¼Ÿ

å˜é‡å¼•æ“æ˜¯ Flowgram æä¾›çš„ä¸€ä¸ªå¯é€‰å†…ç½®åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ© Workflow è®¾è®¡æ—¶æ›´é«˜æ•ˆåœ°å®ç°**å˜é‡ä¿¡æ¯ç¼–æ’**ã€‚å®ƒå¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

ä½œç”¨åŸŸçº¦æŸæ§åˆ¶
<p className="rs-tip">é€šè¿‡å˜é‡å¼•æ“ï¼Œä½ å¯ä»¥æ§åˆ¶å˜é‡çš„ä½œç”¨åŸŸï¼Œç¡®ä¿å˜é‡åœ¨åˆé€‚çš„èŒƒå›´å†…å¯ç”¨ï¼Œé¿å…ä¸å¿…è¦çš„å†²çªã€‚</p>

å›¾ä¸­ Start èŠ‚ç‚¹çš„ query å˜é‡ï¼Œå¯è¢«åç»­çš„ LLM èŠ‚ç‚¹å’Œ End èŠ‚ç‚¹è®¿é—®

å›¾ä¸­ LLM èŠ‚ç‚¹åœ¨ Condition åˆ†æ”¯å†…ï¼ŒEnd èŠ‚ç‚¹åœ¨ Condition åˆ†æ”¯å¤–ï¼›å› æ­¤ End èŠ‚ç‚¹çš„å˜é‡é€‰æ‹©å™¨æ— æ³•é€‰æ‹©åˆ° LLM èŠ‚ç‚¹ä¸Šçš„ result å˜é‡

å˜é‡ä¿¡æ¯æ ‘çš„ç»´æŠ¤
<p className="rs-tip">å˜é‡å¼•æ“å¯ä»¥å¸®åŠ©ä½ æ„å»ºä¸€ä¸ªæ¸…æ™°çš„å˜é‡ä¿¡æ¯æ ‘ï¼Œæ–¹ä¾¿ä½ æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰å˜é‡çš„çŠ¶æ€å’Œå…³ç³»ã€‚</p>

å›¾ä¸­å±•ç¤ºäº†å¤šä¸ªèŠ‚ç‚¹ + å…¨å±€é…ç½®çš„è¾“å‡ºå˜é‡ï¼›å…¶ä¸­éƒ¨åˆ†å˜é‡åŒ…å«äº†å¤šä¸ªå­å˜é‡ï¼Œå½¢æˆäº†ä¸€æ£µæ ‘çš„ç»“æ„

å˜é‡ç±»å‹è‡ªåŠ¨è”åŠ¨æ¨å¯¼
<p className="rs-tip">å˜é‡å¼•æ“èƒ½å¤Ÿæ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æ¨å¯¼å˜é‡çš„ç±»å‹ï¼Œå‡å°‘æ‰‹åŠ¨æŒ‡å®šç±»å‹çš„å·¥ä½œé‡ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p>

å›¾ä¸­çš„ Batch èŠ‚ç‚¹å¯¹ Start èŠ‚ç‚¹çš„ arr å˜é‡è¿›è¡Œäº†æ‰¹å¤„ç†ï¼Œå½“ arr å˜é‡çš„ç±»å‹å˜åŠ¨æ—¶ï¼ŒBatch èŠ‚ç‚¹æ‰¹å¤„ç†è¾“å‡ºçš„ item å˜é‡ç±»å‹ä¹Ÿéšä¹‹å˜åŠ¨

## å¼€å¯å˜é‡å¼•æ“

[> API Detail](https://flowgram.ai/auto-docs/editor/interfaces/VariablePluginOptions.html)

```tsx pure title="use-editor-props.ts" {3}

// EditorProps
{
  variableEngine: {
    /**
     * éœ€è¦å¼€å¯å˜é‡å¼•æ“æ‰èƒ½ä½¿ç”¨
     */
    enable: true
  }
}
```



---
url: /guide/advanced/variable/variable-consume.md
---

# æ¶ˆè´¹å˜é‡

## åœ¨èŠ‚ç‚¹å†…è·å–å˜é‡æ ‘

### è·å–å˜é‡åˆ—è¡¨

```tsx pure title="use-variable-tree.tsx"
import {
  type BaseVariableField,
  useScopeAvailable,
} from '@flowgram.ai/fixed-layout-editor';

// .... Inside react hooks or component

const available = useScopeAvailable()

const renderVariable = (variable: BaseVariableField) => {
  // ....
}

return available.variables.map(renderVariable)

// ....


```

### è·å– Object ç±»å‹å˜é‡çš„ä¸‹é’»

```tsx pure title="use-variable-tree.tsx"
import {
  type BaseVariableField,
  ASTMatch,
} from '@flowgram.ai/fixed-layout-editor';

// ....

const renderVariable = (variable: BaseVariableField) => ({
  title: variable.meta?.title,
  key: variable.key,
  // Only Object Type can drilldown
  children: ASTMatch.isObject(type) ? type.properties.map(renderVariable) : [],
});

// ....

```

### è·å– Array ç±»å‹å˜é‡çš„ä¸‹é’»

```tsx pure title="use-variable-tree.tsx"
import {
  type BaseVariableField,
  type BaseType,
  ASTMatch,
} from '@flowgram.ai/fixed-layout-editor';

// ....

const getTypeChildren = (type?: BaseType): BaseVariableField[] => {
  if (!type) return [];

  // get properties of Object
  if (ASTMatch.isObject(type)) return type.properties;

  // get items type of Array
  if (ASTMatch.isArray(type)) return getTypeChildren(type.items);
};

const renderVariable = (variable: BaseVariableField) => ({
  title: variable.meta?.title,
  key: variable.key,
  // Only Object Type can drilldown
  children: getTypeChildren(variable.type).map(renderVariable),
});

// ....

```

## ç›´æ¥ä½¿ç”¨ VariableSelector å®˜æ–¹ç‰©æ–™

è¯¦è§: [å®˜æ–¹è¡¨å•ç‰©æ–™](/guide/advanced/form-materials.md)

[VariableSelector](https://github.com/bytedance/flowgram.ai/tree/main/packages/materials/form-materials/src/components/variable-selector/index.tsx) ç»„ä»¶ç”¨äºé€‰æ‹©å•ä¸ªå˜é‡

é€šè¿‡åŒ…å¼•ç”¨ä½¿ç”¨ï¼š

```tsx
import { VariableSelector } from '@flowgram.ai/materials'
```

é€šè¿‡ CLI å¤åˆ¶æºä»£ç ä½¿ç”¨ï¼š

```bash
npx @flowgram.ai/materials components/variable-selector
```



---
url: /guide/advanced/variable/variable-output.md
---

# è¾“å‡ºå˜é‡

## è¾“å‡ºèŠ‚ç‚¹å˜é‡

### FlowNodeVariableData è¾“å‡ºå˜é‡

`Flowgram` åŸºäº [`ECS`](https://flowgram.ai/guide/concepts/ecs.html) (Entity-Component-System) æ¥å®ç°èŠ‚ç‚¹ä¿¡æ¯çš„ç®¡ç†ã€‚

å…¶ä¸­ [`FlowNodeVariableData`](https://flowgram.ai/auto-docs/editor/classes/FlowNodeVariableData.html) æ˜¯èŠ‚ç‚¹ `FlowNodeEntity` ä¸Šçš„ä¸€ä¸ª `Component`ï¼Œä¸“é—¨ç”¨äºå¤„ç†èŠ‚ç‚¹ä¸Šè¾“å‡ºçš„ **å˜é‡ä¿¡æ¯**ã€‚

ä¸‹é¢çš„ Demo å±•ç¤ºäº†ï¼šå¦‚ä½•æ‹¿åˆ° `FlowNodeVariableData`, å¹¶ä¸”é€šè¿‡ `FlowNodeVariableData` å®ç°åœ¨èŠ‚ç‚¹ä¸Šè¾“å‡ºå˜é‡

```tsx pure title="sync-variable-plugin.tsx"
import {
  FlowNodeVariableData,
  ASTFactory,
} from '@flowgram.ai/fixed-layout-editor';

// ....

flowDocument.onNodeCreate(({ node }) => {
  const variableData = node.getData<FlowNodeVariableData>(FlowNodeVariableData);

  // ....

  // 1. Clear VariableData if No value
  variableData.clearVar()

  // 2. Set a String Variable as output
  variableData.setVar(
    ASTFactory.createVariableDeclaration({
      meta: {
        title: `Your Output Variable Title`,
      },
      key: `your_variable_global_unique_key_${node.id}`,
      type: ASTFactory.createString(),
    })
  )

  // 3. Set a Complicated Variable Data as output
  variableData.setVar(
    ASTFactory.createVariableDeclaration({
      meta: {
        title: `Your Output Variable Title`,
      },
      key: `your_variable_global_unique_key_${node.id}`,
      type: ASTFactory.createArray({
        items: ASTFactory.createObject({
          properties: [
            ASTFactory.createProperty({
              key: 'stringType',
              type: ASTFactory.createString(),
            }),
            ASTFactory.createProperty({
              key: 'booleanType',
              type: ASTFactory.createBoolean(),
            }),
            ASTFactory.createProperty({
              key: 'numberType',
              type: ASTFactory.createNumber(),
            }),
            ASTFactory.createProperty({
              key: 'integerType',
              type: ASTFactory.createInteger(),
            }),
          ],
        }),
      }),
    })
  );

  // 4. Get Variable for current Node
  console.log(variableData.getVar())

  // ....
})

// ....

```

è¯¦è§: [> Demo Detail](https://github.com/bytedance/flowgram.ai/blob/main/apps/demo-fixed-layout/src/plugins/sync-variable-plugin/sync-variable-plugin.ts#L25)

### ä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®å¤šä¸ªè¾“å‡ºå˜é‡

```tsx pure title="sync-variable-plugin.tsx"
import {
  FlowNodeVariableData,
  ASTFactory,
} from '@flowgram.ai/fixed-layout-editor';

// ....

flowDocument.onNodeCreate(({ node }) => {
  const variableData = node.getData<FlowNodeVariableData>(FlowNodeVariableData);

  // ...
  // 1. Create, Update, Read, Delete Variable in namespace_1
  variableData.setVar(
    'namespace_1',
    ASTFactory.createVariableDeclaration({
      meta: {
        title: `Your Output Variable Title`,
      },
      key: `your_variable_global_unique_key_${node.id}`,
      type: ASTFactory.createString(),
    })
  )

  console.log(variableData.getVar('namespace_1'))

  variableData.clearVar('namespace_1')

  // ....

  // 2. Create, Update, Read, Delete Variable in namespace_2
  variableData.setVar(
    'namespace_2',
    ASTFactory.createVariableDeclaration({
      meta: {
        title: `Your Output Variable Title 2`,
      },
      key: `your_variable_global_unique_key_${node.id}_2`,
      type: ASTFactory.createString(),
    })
  )

  console.log(variableData.getVar('namespace_2'))

  variableData.clearVar('namespace_2')

  // ....
})

// ....

```

æ›´å¤šç”¨æ³•ï¼Œè¯¦è§ï¼š[Class: FlowNodeVariableData](https://flowgram.ai/auto-docs/editor/classes/FlowNodeVariableData.html)

### è¡¨å•å‰¯ä½œç”¨è®¾ç½®è¾“å‡ºå˜é‡

```tsx pure title="node-registries.ts"
import {
  FlowNodeRegistry,
  createEffectFromVariableProvider,
  ASTFactory,
  type ASTNodeJSON
} from '@flowgram.ai/fixed-layout-editor';

export function createTypeFromValue(value: string): ASTNodeJSON | undefined {
  switch (value) {
    case 'string':
      return ASTFactory.createString();
    case 'number':
      return ASTFactory.createNumber();
    case 'boolean':
      return ASTFactory.createBoolean();
    case 'integer':
      return ASTFactory.createInteger();

    default:
      return;
  }
}

export const nodeRegistries: FlowNodeRegistry[] = [
  {
    type: 'start',
    formMeta: {
      effect: {
        // Create first variable
        // = variableData.setVar('path.to.value', ASTFactory.createVariableDeclaration(parse(v)))
        'path.to.value': createEffectFromVariableProvider({
          // parse form value to variable
          parse(v: string) {
            return {
              meta: {
                title: `Your Output Variable Title`,
              },
              key: `your_variable_global_unique_key_${node.id}`,
              type: createTypeFromValue(v)
            }
          }
        }),
        // Create second variable
        // = variableData.setVar('path.to.value2', ASTFactory.createVariableDeclaration(parse(v)))
        'path.to.value2': createEffectFromVariableProvider({
          // parse form value to variable
          parse(v: string) {
            return {
              meta: {
                title: `Your Output Variable Title 2`,
              },
              key: `your_variable_global_unique_key_${node.id}_2`,
              type: createTypeFromValue(v)
            }
          }
        }),
      },
      render: () => (
       // ...
      )
    },
  }
]

```

## è¾“å‡ºå…¨å±€å˜é‡

### è·å–å…¨å±€å˜é‡ä½œç”¨åŸŸ

å…¨å±€ä½œç”¨åŸŸå¯ä»¥åœ¨ Plugin ä¸­é€šè¿‡ `ctx` è·å–ï¼š

```tsx pure title="sync-variable-plugin.tsx"
import {
  GlobalScope,
  definePluginCreator,
  PluginCreator
} from '@flowgram.ai/fixed-layout-editor';


export const createSyncVariablePlugin: PluginCreator<SyncVariablePluginOptions> =
  definePluginCreator<SyncVariablePluginOptions, FixedLayoutPluginContext>({
    onInit(ctx, options) {
      const globalScope = ctx.get(GlobalScope)

      globalScope.setVar(
         ASTFactory.createVariableDeclaration({
          meta: {
            title: `Your Output Variable Title`,
          },
          key: `your_variable_global_unique_key`,
          type: ASTFactory.createString(),
        })
      )
    }
  })

```

ä¹Ÿå¯ä»¥åœ¨ç”»å¸ƒä¸­çš„ React ç»„ä»¶å†…ï¼Œé€šè¿‡ `useService` è·å–å…¨å±€ä½œç”¨åŸŸï¼š

```tsx pure title="global-variable-component.tsx"
import {
  GlobalScope,
  useService,
} from '@flowgram.ai/fixed-layout-editor';

function GlobalVariableComponent() {

  const globalScope = useService(GlobalScope)

  // ...

  const handleChange = (v: string) => {
    globalScope.setVar(
      ASTFactory.createVariableDeclaration({
        meta: {
          title: `Your Output Variable Title`,
        },
        key: `your_variable_global_unique_key_${v}`,
        type: ASTFactory.createString(),
      })
    )
  }

  return <Input onChange={handleChange}/>
}

```

### å…¨å±€ä½œç”¨åŸŸè¾“å‡ºå˜é‡

[`GlobalScope`](https://flowgram.ai/auto-docs/editor/classes/GlobalScope.html) è¾“å‡ºå˜é‡çš„ API å’Œ `FlowNodeVariableData` ç±»ä¼¼:

```tsx pure title="sync-variable-plugin.tsx"
import {
  GlobalScope,
} from '@flowgram.ai/fixed-layout-editor';

// ...

onInit(ctx, options) {
  const globalScope = ctx.get(GlobalScope);

  // 1. Create, Update, Read, Delete Variable in GlobalScope
  globalScope.setVar(
    ASTFactory.createVariableDeclaration({
      meta: {
        title: `Your Output Variable Title`,
      },
      key: `your_variable_global_unique_key`,
      type: ASTFactory.createString(),
    })
  )

  console.log(globalScope.getVar())

  globalScope.clearVar()


  // 2.  Create, Update, Read, Delete Variable in GlobalScope's namespace: 'namespace_1'
    globalScope.setVar(
      'namespace_1',
      ASTFactory.createVariableDeclaration({
        meta: {
          title: `Your Output Variable Title 2`,
        },
        key: `your_variable_global_unique_key_2`,
        type: ASTFactory.createString(),
      })
  )

  console.log(globalScope.getVar('namespace_1'))

  globalScope.clearVar('namespace_1')

  // ...
}
```

è¯¦è§ï¼š[Class: GlobalScope](https://flowgram.ai/auto-docs/editor/classes/GlobalScope.html)



---
url: /guide/advanced/without-form.md
---

# ä¸ä½¿ç”¨è¡¨å•

å½“èŠ‚ç‚¹å¼•æ“ä¸å¼€å¯ï¼ŒèŠ‚ç‚¹çš„ data æ•°æ®ä¼šå­˜åœ¨ `node.getExtInfo` ä¸­, å¦‚ä¸‹

```tsx pure

export const useEditorProps = () => {
  return {
    // ...
    nodeEngine: {
      enable: false, // ä¸å¼€å¯èŠ‚ç‚¹å¼•æ“ï¼Œåˆ™æ— æ³•ä½¿ç”¨ form
    },
    history: {
      enable: true,
      enableChangeNode: false // ä¸å†ç›‘å¬è¡¨å•æ•°æ®å˜åŒ–
    },
    materials: {
      /**
       * Render Node
       */
      renderDefaultNode: ({ node }: WorkflowNodeProps) => {
        return (
          <WorkflowNodeRenderer className="demo-free-node" node={node}>
            <input value={node.getExtInfo()?.title} onChange={e => node.updateExtInfo({ title: e.target.value})}/>
          </WorkflowNodeRenderer>
        );
      },
    },
    // /...
  }
}

```



---
url: /guide/concepts/canvas-engine.md
---

import image0 from "@/public/layer-uml.jpg"

# ç”»å¸ƒå¼•æ“

## Playground

ç”»å¸ƒå¼•æ“åº•å±‚ä¼šæä¾›ä¸€å¥—è‡ªå·±çš„åæ ‡ç³», ä¸»è¦ç”± Playground é©±åŠ¨

```ts
interface Playground {
   node: HTMLDivElement // ç”»å¸ƒæŒ‚è½½çš„domèŠ‚ç‚¹
   toReactComponent() // æ¸²æŸ“ä¸ºreact èŠ‚ç‚¹
   readonly: boolean // åªè¯»æ¨¡å¼
   config: PlaygroundConfigEntity // åŒ…å« zoomï¼Œscroll ç­‰ç”»å¸ƒæ•°æ®
}
// hook å¿«é€Ÿè·å–
const { playground } = useClientContext()
```

## Layer

:::warning P.S.

* æ¸²æŸ“å±‚åœ¨åº•å±‚å»ºç«‹äº†ä¸€å¥—è‡ªå·±çš„åæ ‡ç³»ï¼ŒåŸºäºè¿™ä¸ªåæ ‡ç³»å®ç°æ¨¡æ‹Ÿæ»šåŠ¨ã€ç¼©æ”¾ç­‰é€»è¾‘ï¼Œåœ¨ç®—viewportæ—¶å€™èŠ‚ç‚¹ä¹Ÿéœ€è¦è½¬æ¢åˆ°è¯¥åæ ‡ç³»ä¸Š
* æ¸²æŸ“æŒ‰ç”»å¸ƒè¢«æ‹†åˆ†æˆå¤šä¸ªå±‚ (Layer)ï¼Œåˆ†å±‚è®¾è®¡æ˜¯åŸºäºECSçš„æ•°æ®åˆ‡å‰²æ€æƒ³ï¼Œä¸åŒ Layer åªç›‘å¬è‡ªå·±æƒ³è¦çš„æ•°æ®ï¼Œç‹¬ç«‹æ¸²æŸ“ä¸å¹²æ‰°ï¼ŒLayer å¯ä»¥ç†è§£ä¸ºECSçš„ Systemï¼Œå³æœ€ç»ˆEntityæ•°æ®æ¶ˆè´¹çš„åœ°æ–¹
* Layer å®ç°äº†ç±»mobxçš„observerå“åº”å¼åŠ¨æ€ä¾èµ–æ”¶é›†ï¼Œæ•°æ®æ›´æ–°ä¼šè§¦å‘ autorunæˆ–render

:::

<img alt="åˆ‡é¢ç¼–ç¨‹" src={image0} />

* Layer ç”Ÿå‘½å‘¨æœŸ

```ts
interface Layer {
    /**
     * åˆå§‹åŒ–æ—¶å€™è§¦å‘
     */
    onReady?(): void;

    /**
     * playground å¤§å°å˜åŒ–æ—¶å€™ä¼šè§¦å‘
     */
    onResize?(size: PipelineDimension): void;

    /**
     * playground focus æ—¶å€™è§¦å‘
     */
    onFocus?(): void;

    /**
     * playground blur æ—¶å€™è§¦å‘
     */
    onBlur?(): void;

    /**
     * ç›‘å¬ç¼©æ”¾
     */
    onZoom?(scale: number): void;

    /**
     * ç›‘å¬æ»šåŠ¨
     */
    onScroll?(scroll: { scrollX: number; scrollY: number }): void;

    /**
     * viewport æ›´æ–°è§¦å‘
     */
    onViewportChange?(): void;

    /**
     * readonly æˆ– disable çŠ¶æ€å˜åŒ–
     * @param state
     */
    onReadonlyOrDisabledChange?(state: { disabled: boolean; readonly: boolean }): void;

    /**
   * æ•°æ®æ›´æ–°è‡ªåŠ¨è§¦å‘react renderï¼Œå¦‚æœä¸æä¾›åˆ™ä¸ä¼šè°ƒç”¨reactæ¸²æŸ“
   */
    render?(): JSX.Element
 }
```

Layerçš„å®šä½å…¶å®å’Œ Unity æ¸¸æˆå¼•æ“ æä¾›çš„ [MonoBehaviour](https://docs.unity3d.com/ScriptReference/MonoBehaviour.html) ç±»ä¼¼ï¼Œ Unity æ¸¸æˆå¼•æ“çš„è„šæœ¬æ‰©å±•éƒ½æ˜¯åŸºäºè¿™ä¸ªï¼Œå¯ä»¥è®¤ä¸ºæ˜¯æœ€æ ¸å¿ƒçš„è®¾è®¡ï¼Œåº•å±‚ä¹Ÿæ˜¯åŸºäº C# æä¾›çš„åå°„ (Reflection) èƒ½åŠ›çš„ä¾èµ–æ³¨å…¥

```C#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
public class MyMonoBehavior : MonoBehaviour
{
    void Awake()
    {
        Debug.Log("Awake method is always called before application starts.");
    }
    void Start()
    {
        Debug.Log("Start method is always called after Awake().");
    }
    void Update()
    {
        Debug.Log("Update method is called in every frame.");
    }
}
```

* Layer çš„å“åº”å¼æ›´æ–°

```ts
export class DemoLayer extends Layer {
    // ä»»æ„çš„inversifyæ¨¡å— çš„æ³¨å…¥
    @inject(FlowDocument) document: FlowDocument
    // ç›‘å¬å•ä¸ªEntity
    @observeEntity(SomeEntity) entity: SomeEntity
    // ç›‘å¬å¤šä¸ªEntity
    @observeEntities(SomeEntity) entities: SomeEntity[]
    // ç›‘å¬ Entityçš„æ•°æ®å—ï¼ˆECS - Componentï¼‰å˜åŒ–
    @observeEntityDatas(SomeEntity, SomeEntityData) transforms: SomeEntityData[]
    autorun() {}
    render() {
      return <div></div>
    }
}
```

## FlowNodeEntity

* èŠ‚ç‚¹æ˜¯ä¸€é¢—æ ‘, åŒ…å«å­èŠ‚ç‚¹ (blocks) å’Œçˆ¶äº²èŠ‚ç‚¹, èŠ‚ç‚¹é‡‡ç”¨ ECS æ¶æ„

```ts
inteface FlowNodeEntity {
    idï¼š string
    blocks: FlowNodeEntity[]
    pre?: FlowNodeEntity
    next?: FlowNodeEntity
    parent?: FlowNodeEntity
    collapsed: boolean // æ˜¯å¦å±•å¼€
    getData(dataRegistry): NodeEntityData
    addData(dataRegistry)
}
```

## FlowNodeTransformData èŠ‚ç‚¹çš„ä½ç½®åŠå¤§å°æ•°æ®

```ts
class FlowNodeTransformData {
    localTransform: Matrix, // ç›¸å¯¹åç§», åªç›¸å¯¹äºåŒä¸€ä¸ªBlockçš„ä¸Šä¸€ä¸ªSiblingèŠ‚ç‚¹çš„åç§»
    worldTransform: Matrix, // ç»å¯¹åç§», ç›¸å¯¹äºParentå’ŒSiblingèŠ‚ç‚¹å åŠ åçš„åç§»
    deltaï¼šPoint // å±…ä¸­å±…å·¦åç§», å’ŒMatrixç‹¬ç«‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹è‡ªå·±æ§åˆ¶
    getSize(): Size, // ç”±è‡ªå·±(ç‹¬ç«‹èŠ‚ç‚¹) æˆ–è€… å­åˆ†æ”¯èŠ‚ç‚¹å®½é«˜é—´è·è®¡ç®—å¾—å‡º
    getBounds(): Rectangle // ç”±worldMatixåŠ size è®¡ç®—å¾—å‡º, ç”¨äºæœ€ç»ˆæ¸²æŸ“ï¼Œè¯¥èŒƒå›´ä¹Ÿå¯ç”¨äºç¡®å®šé«˜äº®é€‰ä¸­åŒºåŸŸ
    inputPoint(): Point // è¾“å…¥ç‚¹ä½ç½®ï¼Œä¸€èˆ¬æ˜¯Blockçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸­ä¸Šä½ç½®(å±…ä¸­å¸ƒå±€)
    outputPoint(): Point // è¾“å‡ºç‚¹ä½ç½®ï¼Œé»˜è®¤æ˜¯èŠ‚ç‚¹ä¸­ä¸‹ä½ç½®ï¼Œä½†æ¡ä»¶åˆ†æ”¯ï¼Œæ˜¯ç”±å†…ç½®ç»“æŸèŠ‚ç‚¹ç­‰å…·ä½“é€»è¾‘åˆ¤æ–­å¾—å‡º
   // ...others
}
```

## FlowNodeRenderData èŠ‚ç‚¹å†…å®¹æ¸²æŸ“æ•°æ®

```ts
class FlowNodeRenderData {
  node: HTMLDivElement // å½“å‰èŠ‚ç‚¹çš„dom
  expandedï¼šboolean // æ˜¯å¦å±•å¼€
  activatedï¼š boolean // æ˜¯å¦æ¿€æ´»
  hiddenï¼š boolean // æ˜¯å¦éšè—
  // ...others
}
```

## FlowDocument

```ts
interface FLowDocument {
    root: FlowNodeEntity // ç”»å¸ƒçš„æ ¹èŠ‚ç‚¹
    fromJSON(data): void // å¯¼å…¥æ•°æ®
    toJSON(): FlowDocumentJSON // å¯¼å‡ºæ•°æ®
    addNode(type: string, meta: any): FlowNodeEntity // æ·»åŠ èŠ‚ç‚¹
    travese(fn: (node: flowNodeEntity) => void, startNode = this.root) // éå†
}
```



---
url: /guide/concepts/ecs.md
---

# ECS

## ä¸ºä»€ä¹ˆéœ€è¦ ECS

:::warning ECS ï¼ˆEntity-Component-Systemï¼‰
é€‚åˆè§£è€¦å¤§çš„æ•°æ®å¯¹è±¡ï¼Œå¸¸ç”¨äºæ¸¸æˆï¼Œæ¸¸æˆçš„æ¯ä¸ªè§’è‰²ï¼ˆEntityï¼‰æ•°æ®éƒ½éå¸¸åºå¤§ï¼Œéœ€è¦æ‹†åˆ†æˆå¦‚ç‰©ç†å¼•æ“ç›¸å…³æ•°æ®ã€çš®è‚¤ç›¸å…³ã€è§’è‰²å±æ€§ç­‰ (å¤šä¸ª Component)ï¼Œä¾›ä¸åŒçš„å­ç³»ç»Ÿï¼ˆSystemï¼‰æ¶ˆè´¹ã€‚æµç¨‹çš„æ•°æ®ç»“æ„å¤æ‚ï¼Œå¾ˆé€‚åˆç”¨ECSåšæ‹†è§£

:::

## æ–¹æ¡ˆå¯¹æ¯”

æˆ‘ä»¬å¯¹æ¯”ä¸¤ä¸ªæ•°æ®æ–¹æ¡ˆï¼š

### 1. ReduxStore æ–¹æ¡ˆ

```jsx pure
const store = () => ({
  nodes: [{
    position: any
    form: any
    data3: any

  }],
  edges: []
})

function Playground() {
  const { nodes } = useStore(store)

  return nodes.map(node => <Node data={node} />)
}
```

ä¼˜ç‚¹ï¼š

* ä¸­å¿ƒåŒ–æ•°æ®ç®¡ç†ä½¿ç”¨ç®€å•

ç¼ºç‚¹ï¼š

* ä¸­å¿ƒåŒ–æ•°æ®ç®¡ç†æ— æ³•ç²¾ç¡®æ›´æ–°ï¼Œå¸¦æ¥æ€§èƒ½ç“¶é¢ˆ
* æ‰©å±•æ€§å·®ï¼ŒèŠ‚ç‚¹æ–°å¢ä¸€ä¸ªæ•°æ®ï¼Œéƒ½è€¦åˆåˆ°ä¸€ä¸ª å¤§JSON é‡Œ

### 2. ECS æ–¹æ¡ˆ

å¤‡æ³¨ï¼š

* NodeData å¯¹åº”çš„æ˜¯ ECS - Component
* Layer å¯¹åº” ECS - System

```jsx pure

/**
  *  ç”»å¸ƒæ–‡æ¡£æ•°æ®
  */
class FlowDocument {
  /**
*  * èŠ‚ç‚¹æ•°æ®å®šä¹‰, èŠ‚ç‚¹åˆ›å»ºæ—¶å€™ä¼šæŠŠæ•°æ®å®ä¾‹åŒ–
    */
  nodeDefines: [
    NodePositionData,
    NodeFormData,
    NodeLineData
  ]
  nodeEntities: Entity[] = []
}

/**
 *  èŠ‚ç‚¹
 */
class FlowNodeEntity {
  id: string // åªæœ‰id ä¸å¸¦æ•°æ®
  getData: (dataId: string) => EntityData
}

// æ¸²æŸ“çº¿æ¡
class LinesLayer {
  /**
   *  å†…éƒ¨é€šè¿‡ node.getData(NodeLineData) è·å–å¯¹åº”çš„æ•°æ®ï¼Œä¸‹åŒ
   */
  @observeEntityData(FlowNodeEntity, NodeLineData) lines: NodeLineData[]
  render() {
    // æ¸²æŸ“çº¿æ¡
    return this.lines.map(line => <Line data={line} />)
  }
}

// æ¸²æŸ“èŠ‚ç‚¹ä½ç½®
class NodePositionsLayer {
  @observeEntityData(FlowNodeEntity, NodePositionData) positions: NodePositionData[]
  render() {
    // æ¸²æŸ“ä½ç½®åŠæ’ç‰ˆ
  }
}

// æ¸²æŸ“èŠ‚ç‚¹è¡¨å•
class  NodeFormsLayer {
  @observeEntityData(FlowNodeEntity, NodeFormData) contents: NodeFormData[]
  render() {
    // æ¸²æŸ“èŠ‚ç‚¹å†…å®¹
  }
}


/**
 * ç”»å¸ƒå®ä¾‹ï¼Œé€šè¿‡ Layer åˆ†å±‚æ¸²æŸ“
 */
class Playground {
  layers: [
    LinesLayer, // çº¿æ¡æ¸²æŸ“
    NodePositionsLayer, // ä½ç½®æ¸²æŸ“
    NodeFormsLayer // å†…å®¹æ¸²æŸ“
  ]ï¼Œ
  render() {
    // ç”»å¸ƒåˆ†å±‚æ¸²æŸ“
    return this.layers.map(layer => layer.render())
  }
}
```

ä¼˜ç‚¹ï¼š

* èŠ‚ç‚¹æ•°æ®æ‹†å¼€æ¥å•ç‹¬æ§åˆ¶æ¸²æŸ“ï¼Œæ€§èƒ½å¯åšåˆ°ç²¾ç¡®æ›´æ–°
* æ‰©å±•æ€§å¼ºï¼Œæ–°å¢ä¸€ä¸ªèŠ‚ç‚¹æ•°æ®ï¼Œåˆ™æ–°å¢ä¸€ä¸ª XXXData + XXXLayer

ç¼ºç‚¹ï¼š

* æœ‰ä¸€å®šå­¦ä¹ æˆæœ¬



---
url: /guide/concepts/index.md
---

import image0 from "@/public/canvas-engine.png"

# æ¦‚å¿µ

<img alt="FlowGramAI æ¶æ„" src={image0} />

* CanvasEngineï¼šç”»å¸ƒå¼•æ“è´Ÿè´£ç»˜åˆ¶â€œç‚¹-çº¿â€æ„æˆçš„å›¾, ä¿éšœå¤§è§„æ¨¡èŠ‚ç‚¹æ—¶çš„æµç•…æ€§
* NodeEngine: èŠ‚ç‚¹å¼•æ“æä¾› æ¸²æŸ“ã€æ ¡éªŒã€æ•°æ®ä¿®æ”¹ç­‰è¡¨å•èƒ½åŠ›
* VariableEngine: å˜é‡å¼•æ“å¼•å…¥ä½œç”¨åŸŸæ¨¡å‹, æŠ½è±¡å„ä¸šåŠ¡åœºæ™¯çš„å˜é‡
* Material: ç‰©æ–™åº“åŒ…å«é»˜è®¤ ICON ç­‰ UI, ä¸šåŠ¡æ¥å…¥åå¯è¦†ç›–æ‰©å±•



---
url: /guide/concepts/ioc.md
---

import image0 from "@/public/weaving.png"

# IOC

## ä¸ºä»€ä¹ˆéœ€è¦ IOC

:::warning å‡ ä¸ªæ¦‚å¿µ

* æ§åˆ¶åè½¬ï¼š Inversion of Controlï¼Œ æ˜¯é¢å‘å¯¹è±¡ä¸­çš„ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œå¯ä»¥ç”¨æ¥é™ä½ä»£ç æ¨¡å—ä¹‹é—´çš„è€¦åˆåº¦ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ–¹å¼å«åšä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§°DIï¼‰
* é¢†åŸŸé€»è¾‘ï¼šDomain Logicï¼Œä¹Ÿå¯ä»¥å« ä¸šåŠ¡é€»è¾‘ï¼ˆBusiness Logicï¼‰ï¼Œè¿™äº›ä¸šåŠ¡é€»è¾‘ä¸ç‰¹å®šçš„äº§å“åŠŸèƒ½ç›¸å…³
* é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼šAOP ï¼ˆAspect-Oriented Programmingï¼‰ï¼Œæœ€æ ¸å¿ƒçš„è®¾è®¡åŸåˆ™æ˜¯å°†è½¯ä»¶ç³»ç»Ÿæ‹†åˆ†ä¸ºå…¬ç”¨é€»è¾‘ (æ¨ªåˆ‡ï¼Œæœ‰è´¯ç©¿çš„æ„å‘³) å’Œ é¢†åŸŸé€»è¾‘ ï¼ˆçºµåˆ‡ï¼‰çš„å¤šä¸ªä¸ªæ–¹é¢ (Aspect)ï¼Œæ¨ªåˆ‡éƒ¨åˆ†å¯ä»¥è¢«æ‰€æœ‰çš„ çºµåˆ‡ éƒ¨åˆ† â€œæŒ‰éœ€æ¶ˆè´¹â€

:::

å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰å…ˆäº†è§£åˆ‡é¢ç¼–ç¨‹ï¼Œåˆ‡é¢ç¼–ç¨‹ç›®çš„æ˜¯å°†é¢†åŸŸé€»è¾‘çš„ç²’åº¦æ‹†çš„æ›´ç»†ï¼Œæ¨ªåˆ‡éƒ¨åˆ†å¯è¢«çºµåˆ‡ â€œæŒ‰éœ€æ¶ˆè´¹â€ ï¼Œæ¨ªåˆ‡å’Œçºµåˆ‡çš„è¿æ¥ä¹Ÿå« ç»‡å…¥ (Weaving)ï¼Œè€Œ IOC å°±æ˜¯æ‰®æ¼” Weaving æ³¨å…¥åˆ°çºµåˆ‡çš„è§’è‰²

<img alt="åˆ‡é¢ç¼–ç¨‹" src={image0} />

ç†æƒ³çš„åˆ‡é¢ç¼–ç¨‹

```ts
- myAppliation æä¾›ä¸šåŠ¡é€»è¾‘
  - service ç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘æœåŠ¡
     - customDomainLogicService
  - contributionImplement é’©å­çš„æ³¨å†Œå®ä¾‹åŒ–
    - MyApplicationContributionImpl
  - component ä¸šåŠ¡ç»„ä»¶

- core æä¾›é€šç”¨é€»è¾‘
  - model é€šç”¨æ¨¡å‹
  - contribution é’©å­æ¥å£
     - LifecycleContribution åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ
     - CommandContribution
  - service å…¬ç”¨çš„serviceçš„æœåŠ¡
     - CommandService
     - ClipboardService
  - component å…¬ç”¨çš„ç»„ä»¶
```

```ts
// IOC çš„æ³¨å…¥
@injectable()
export class CustomDomainLogicService {
@inject(FlowContextService) protected flowContextService: FlowContextService;
@inject(CommandService) protected commandService: CommandService;
@inject(SelectionService) protected selectionService: SelectionService;
}
// IOC çš„æ¥å£å£°æ˜
interface LifecycleContribution {
 onInit(): void
 onStart(): void
 onDispose(): void
}
// IOC çš„æ¥å£å®ç°
@injectable()
export class MyApplicationContributionImpl implements LifecycleContribution {
  onStart(): void {
    // ç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘ä»£ç 
  }
}

// æ‰‹åŠ¨æŒ‚åœ¨åˆ°ç”Ÿå‘½å‘¨æœŸé’©å­
bind(LifecycleContribution).toService(MyApplicationContributionImpl)
```

:::warning IOCæ˜¯åˆ‡é¢ç¼–ç¨‹çš„ä¸€ç§æ‰‹æ®µï¼Œå¼•å…¥åï¼Œåº•å±‚æ¨¡å—å¯ä»¥ä»¥æ¥å£å½¢å¼æš´éœ²ç»™å¤–éƒ¨æ³¨å†Œï¼Œå¸¦æ¥çš„å¥½å¤„ï¼š

* å®ç°å¾®å†…æ ¸ + æ’ä»¶åŒ–çš„è®¾è®¡ï¼Œå®ç°æ’ä»¶çš„å¯æ’æ‹”æŒ‰éœ€æ¶ˆè´¹
* å¯ä»¥è®©åŒ…æ‹†å¾—æ›´å¹²å‡€ï¼Œå®ç° feature å¼çš„æ‹†åŒ…

:::



---
url: /guide/concepts/node-engine.md
---

# èŠ‚ç‚¹å¼•æ“

èŠ‚ç‚¹å¼•æ“ NodeEngine æ˜¯ä¸€ä¸ªæµç¨‹èŠ‚ç‚¹é€»è¾‘çš„ä¹¦å†™æ¡†æ¶ï¼Œè®©ä¸šåŠ¡ä¸“æ³¨äºä¸šåŠ¡è‡ªèº«çš„æ¸²æŸ“ä¸æ•°æ®é€»è¾‘ï¼Œæ— éœ€å…³æ³¨ç”»å¸ƒä»¥åŠèŠ‚ç‚¹é—´è”åŠ¨çš„åº•å±‚apiã€‚ä¸æ­¤åŒæ—¶ï¼ŒèŠ‚ç‚¹å¼•æ“æ²‰æ·€äº†æœ€ä½³çš„èŠ‚ç‚¹ä¹¦å†™èŒƒå¼ï¼Œå¸®åŠ©ä¸šåŠ¡è§£å†³æµç¨‹ä¸šåŠ¡ä¸­å¯èƒ½é‡åˆ°çš„å„ç§é—®é¢˜ï¼Œ å¦‚æ•°æ®é€»è¾‘ä¸æ¸²æŸ“è€¦åˆç­‰ã€‚
èŠ‚ç‚¹å¼•æ“æ˜¯å¯é€‰å¯ç”¨çš„ã€‚å¦‚æœä½ ä¸å­˜åœ¨ä»¥ä¸‹è¿™äº›å¤æ‚çš„èŠ‚ç‚¹é€»è¾‘ï¼Œå¯ä»¥é€‰æ‹©ä¸å¯ç”¨èŠ‚ç‚¹å¼•æ“ï¼Œè‡ªå·±ç»´æŠ¤èŠ‚ç‚¹æ•°æ®ä¸æ¸²æŸ“ã€‚å¤æ‚èŠ‚ç‚¹é€»è¾‘å¦‚ï¼š1ï¼‰èŠ‚ç‚¹ä¸æ¸²æŸ“ä¹Ÿèƒ½æ ¡éªŒæˆ–è§¦å‘æ•°æ®å‰¯ä½œç”¨ï¼›2ï¼‰èŠ‚ç‚¹é—´è”åŠ¨ä¸°å¯Œï¼›3ï¼‰redo/undo; ç­‰ç­‰ã€‚

## åŸºç¡€æ¦‚å¿µ

FlowNodeEntity
æµç¨‹èŠ‚ç‚¹æ¨¡å‹ã€‚

FlowNodeRegistry
æµç¨‹èŠ‚ç‚¹çš„é™æ€é…ç½®ã€‚

FormMeta
èŠ‚ç‚¹å¼•æ“çš„é™æ€é…ç½®ã€‚ é…ç½®åœ¨ FlowNodeRegistry ä¸­çš„ formMeta å­—æ®µã€‚

Form
èŠ‚ç‚¹å¼•æ“ä¸­çš„è¡¨å•ã€‚å®ƒç»´æŠ¤èŠ‚ç‚¹çš„æ•°æ®å¹¶æä¾›æ¸²æŸ“ã€æ ¡éªŒã€å‰¯ä½œç”¨ç­‰èƒ½åŠ›ã€‚ä»–çš„æ¨¡å‹ FormModel æä¾›èŠ‚ç‚¹æ•°æ®çš„è®¿é—®å’Œä¿®æ”¹åŠè§¦å‘æ ¡éªŒç­‰èƒ½åŠ›ã€‚

Field
èŠ‚ç‚¹è¡¨å•ä¸­çš„æŸä¸ªæ¸²æŸ“å­—æ®µã€‚æ³¨æ„ï¼Œ Form å·²ç»æä¾›äº†æ•°æ®å±‚çš„é€»è¾‘ï¼ŒField æ›´å¤šæ˜¯ä¸€ä¸ªæ¸²æŸ“å±‚çš„æ¨¡å‹ï¼Œå®ƒå°½åœ¨è¡¨å•å­—æ®µæ¸²æŸ“åæ‰å­˜åœ¨ã€‚

validate
è¡¨å•æ ¡éªŒã€‚é€šå¸¸æœ‰å¯¹å•ä¸ªå­—æ®µçš„æ ¡éªŒä¹Ÿæœ‰æ•´ä½“è¡¨å•æ ¡éªŒã€‚

effect
è¡¨å•æ•°æ®çš„å‰¯ä½œç”¨ã€‚é€šå¸¸æŒ‡åœ¨è¡¨å•æ•°æ®å‘ç”Ÿä¸€äº›äº‹ä»¶æ—¶è¦è§¦å‘ç‰¹å®šé€»è¾‘ã€‚ å¦‚åœ¨æŸå­—æ®µçš„æ•°æ®å˜æ›´æ—¶è¦åŒæ­¥ä¸€äº›ä¿¡æ¯åˆ°æŸä¸ªstoreï¼Œè¿™ä¸ªå¯ä»¥è¢«ç§°ä¸ºä¸€ä¸ªeffectã€‚

FormPlugin
è¡¨å•æ’ä»¶ã€‚å¯ä»¥é…ç½®åœ¨formMeta ä¸­ï¼Œæ’ä»¶å¯ä»¥å¯¹è¡¨å•è¿›è¡Œä¸€ç³»åˆ—æ·±åº¦æ“ä½œã€‚å¦‚å˜é‡æ’ä»¶ã€‚



---
url: /guide/concepts/reactflow.md
---

# å¯¹æ¯” ReactFlow

[Reactflow](https://reactflow.dev/) æ˜¯å¾ˆä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼Œæ¶æ„åŠä»£ç æ¸…æ™°ï¼Œä½†åæµç¨‹æ¸²æŸ“å¼•æ“çš„åº•å±‚æ¶æ„ (Nodeã€Edgeã€Handle)ï¼Œéœ€è¦åœ¨ä¸Šå±‚å¼€å‘å¤§é‡åŠŸèƒ½æ‰èƒ½é€‚é…å¤æ‚åœºæ™¯(å¦‚ å›ºå®šå¸ƒå±€ï¼Œéœ€è¦å¯¹æ•°æ®å»ºæ¨¡å†™å¸ƒå±€ç®—æ³•), é«˜çº§åŠŸèƒ½æ”¶è´¹ã€‚

ç›¸æ¯” Reactflowï¼ŒFlowGram çš„ç›®æ ‡æ˜¯æä¾›æµç¨‹ç¼–è¾‘ä¸€æ•´å¥—å¼€ç®±å³ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚

* ä¸‹è¾¹æ˜¯ Reactflow å®˜æ–¹æä¾›çš„ pro æ”¶è´¹èƒ½åŠ›

| ä»˜è´¹åŠŸèƒ½                         | FlowGram æ˜¯å¦æ”¯æŒ | æœªæ¥è®¡åˆ’æ”¯æŒ |
|----------------------------------|------------------------|--------------|
| åˆ†ç»„                             | æ”¯æŒ                   |              |
| redo/undo                        | æ”¯æŒ                   |              |
| copy/paste                       | æ”¯æŒ                   |              |
| HelpLines è¾…åŠ©çº¿                | æ”¯æŒ                   |              |
| è‡ªå®šä¹‰èŠ‚ç‚¹åŠå½¢çŠ¶                 | æ”¯æŒ                   |              |
| è‡ªå®šä¹‰çº¿æ¡                       | æ”¯æŒ                   |              |
| AutoLayoutï¼Œè‡ªåŠ¨å¸ƒå±€æ•´ç†         | æ”¯æŒ                   |              |
| ForceLayoutï¼ŒèŠ‚ç‚¹æ’æ–¥æ•ˆæœ        | ä¸æ”¯æŒ                 | No           |
| Expand/Collapse                  | æ”¯æŒ                   |              |
| Collaborative å¤šäººååŒ           | ä¸æ”¯æŒ                 | Yes          |
| WorkflowBuilder ç›¸å½“äºå›ºå®šå¸ƒå±€å®Œæ•´æ¡ˆä¾‹ | æ”¯æŒ                   |              |

* Reactflow äº‹ä»¶éƒ½æ˜¯ç»‘å®šåœ¨åŸå­åŒ–çš„ dom èŠ‚ç‚¹ä¸Šï¼Œä¸”å†…ç½®ï¼Œäº¤äº’å®šåˆ¶æˆæœ¬é«˜ï¼Œéœ€è¦ç†è§£å®ƒçš„æºç æ‰èƒ½æ·±åº¦å¼€å‘ï¼Œå¦‚ä¸‹ï¼Œåœ¨ç”»å¸ƒç¼©æ”¾å¾ˆå°æ—¶å€™æ— æ³•é€‰åˆ°ç‚¹ä½

ç”±äº äº‹ä»¶æ˜¯ç»‘å®šåœ¨ svg ä¸Šï¼Œsvg åœ¨ç¼©æ”¾åå¾ˆå®¹æ˜“ç‚¹ä¸åˆ°

FlowGram çš„äº‹ä»¶æ˜¯ä¸€ç§å…¨å±€ç›‘å¬ mousemove å˜åŒ–ï¼Œå¹¶é€šè¿‡è®¡ç®—åŠ Threshold  å¤§è‡´ç¡®å®šä½ç½®ï¼Œå³ä½¿ç¼©æ”¾å¾ˆå°ä¹Ÿèƒ½ç‚¹åˆ°, åŒæ—¶æ”¯æŒçº¿æ¡é‡è¿



---
url: /guide/concepts/variable-engine.md
---

import image0 from "@/public/variable-engine.png"

import image1 from "@/public/varaible-zone.png"

# å˜é‡å¼•æ“

## æ•´ä½“è®¾è®¡

### æ¶æ„åˆ†å±‚

:::warning æ¶æ„åˆ†å±‚
å˜é‡å¼•æ“è®¾è®¡ä¸Šéµå¾ª DIPï¼ˆä¾èµ–åè½¬ï¼‰åŸåˆ™ï¼ŒæŒ‰ç…§ ä»£ç ç¨³å®šæ€§ã€æŠ½è±¡å±‚æ¬¡ ä»¥åŠå’Œ ä¸šåŠ¡çš„è¿œè¿‘ åˆ†ä¸ºä¸‰å±‚ï¼š

* å˜é‡æŠ½è±¡å±‚ï¼šå˜é‡æ¶æ„ä¸­æŠ½è±¡å±‚æ¬¡æœ€é«˜ï¼Œä»£ç ä¹Ÿæœ€ä¸ºç¨³å®šçš„éƒ¨åˆ†
* å˜é‡å®ç°å±‚ï¼šå˜é‡æ¶æ„ä¸­å˜åŠ¨è¾ƒå¤§ï¼Œä¸åŒä¸šåŠ¡ä¹‹é—´é€šå¸¸å­˜åœ¨è°ƒæ•´çš„éƒ¨åˆ†
* å˜é‡ä¸šåŠ¡å±‚ï¼šå˜é‡æ¶æ„ä¸­æä¾›ç»™ä¸šåŠ¡çš„ Facade ï¼Œä¸ç”»å¸ƒå¼•æ“ã€èŠ‚ç‚¹å¼•æ“è”åŠ¨çš„éƒ¨åˆ†

:::

<img alt="æ¶æ„åˆ†å±‚å›¾" src={image0} />

### æœ¯è¯­è¡¨

#### ğŸŒŸ ä½œç”¨åŸŸï¼ˆScopeï¼‰

:::warning â­ï¸â­ï¸â­ï¸ å®šä¹‰ï¼š
ä¸€ç§çº¦å®šçš„ç©ºé—´ï¼Œç©ºé—´å†… é€šè¿‡ AST æ¥æè¿°å˜é‡å£°æ˜å’Œæ¶ˆè´¹æƒ…å†µ

* çº¦å®šçš„ç©ºé—´ï¼šç©ºé—´æ˜¯ä»€ä¹ˆï¼Œå®Œå…¨ç”±ä¸šåŠ¡å®šä¹‰
* åœ¨ä½ä»£ç è®¾è®¡æ€ä¸­ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€ä¸€ä¸ªç»„ä»¶ã€ä¸€ä¸ªå³ä¾§é¢æ¿...
* åœ¨ä¸€æ®µä»£ç ä¸­ï¼Œå¯ä»¥æ˜¯ä¸€è¡Œ Statementã€ä¸€æ®µä»£ç å—ã€ä¸€ä¸ªå‡½æ•°ã€ä¸€ä¸ªæ–‡ä»¶...

:::

ä½œç”¨åŸŸçš„ç©ºé—´æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç”±ä¸åŒçš„ä¸šåŠ¡æ¥åˆ’å®šã€‚

#### ğŸŒŸ æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰

:::warning å®šä¹‰ï¼š
â­ï¸â­ï¸â­ï¸ ä¸€ç§åè®®ï¼Œé€šè¿‡æ ‘çš„å½¢å¼ï¼Œç»„åˆ AST èŠ‚ç‚¹ï¼Œå®ç°å¯¹å˜é‡ä¿¡æ¯çš„æ˜¾å¼/éšå¼ CRUD

* AST èŠ‚ç‚¹ï¼šAST ä¸­å¯å“åº”å¼çš„åè®®èŠ‚ç‚¹
* æ˜¾å¼ CRUDï¼Œå¦‚ï¼šä¸šåŠ¡æ˜¾ç¤ºè®¾å®šä¸€ä¸ªå˜é‡çš„å˜é‡ç±»å‹
* éšå¼ CRUDï¼Œå¦‚ï¼šä¸šåŠ¡å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œå˜é‡ä¼šæ ¹æ®å…¶åˆå§‹åŒ–å‚æ•°è‡ªåŠ¨æ¨å¯¼å˜é‡ç±»å‹

:::

:::warning ä½œç”¨åŸŸé‡Œé¢çš„å˜é‡ã€ç±»å‹ã€è¡¨è¾¾å¼ã€ç»“æ„ä½“ ç­‰ç­‰å˜é‡ä¿¡æ¯... æœ¬è´¨ä¸Šéƒ½æ˜¯ AST èŠ‚ç‚¹çš„ç»„åˆ

* å˜é‡ -> VariableDeclaration èŠ‚ç‚¹
* è¡¨è¾¾å¼ -> Expression èŠ‚ç‚¹
* ç±»å‹ -> TypeNode èŠ‚ç‚¹
* ç»“æ„ä½“ -> StructDeclaration èŠ‚ç‚¹

:::

å‚è€ƒé“¾æ¥ï¼šhttps://ts-ast-viewer.com/

#### å˜é‡ï¼ˆVariableï¼‰

:::warning å®šä¹‰ï¼š
ä¸€ç§ç”¨äºå£°æ˜æ–°å˜é‡çš„ AST èŠ‚ç‚¹ï¼Œé€šè¿‡å”¯ä¸€æ ‡è¯†ç¬¦ æŒ‡å‘ä¸€ä¸ª åœ¨ç‰¹å®šé›†åˆèŒƒå›´å†…å˜åŠ¨çš„å€¼

* åœ¨ç‰¹å®šé›†åˆèŒƒå›´å†…å˜åŠ¨çš„å€¼ï¼šå˜é‡çš„å€¼å¿…é¡»åœ¨ å˜é‡ç±»å‹ æè¿°çš„èŒƒå›´å†…
* å”¯ä¸€æ ‡è¯†ç¬¦ï¼šå˜é‡å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„ Key å€¼

:::

[JavaScriptä¸­çš„å˜é‡ï¼Œå”¯ä¸€ Key + æŒ‡å‘ä¸€ä¸ªå˜åŠ¨çš„å€¼](/@/public/variable-code.png.md)

#### å˜é‡ç±»å‹ï¼ˆVariable Typeï¼‰

:::warning å®šä¹‰ï¼š
â­ï¸â­ï¸â­ï¸ ä¸€ç§ AST èŠ‚ç‚¹ï¼Œç”¨äºçº¦æŸä¸€ä¸ªå˜é‡ï¼Œè¢«çº¦æŸçš„å˜é‡å€¼åªèƒ½åœ¨é¢„å…ˆè®¾å®šçš„é›†åˆèŒƒå›´å†…å˜åŠ¨

* ä¸€ä¸ªå˜é‡å¯ä»¥ç»‘å®šä¸€ä¸ªå˜é‡ç±»å‹

:::

### å˜é‡å¼•æ“çš„å½¢è±¡ç†è§£

:::warning æƒ³åƒè¿™æ ·ä¸€ä¸ªå˜é‡å¼•æ“çš„ä¸–ç•Œï¼š

* é€šè¿‡ä¸€ä¸ªä¸ª ä½œç”¨åŸŸ æ¥åˆ’å®šå‡ºä¸€ä¸ªä¸ª å›½å®¶
* æ¯ä¸ªå›½å®¶åŒ…å«ä¸‰å¤§å…¬æ°‘ï¼šå£°æ˜ã€ç±»å‹ã€è¡¨è¾¾å¼
* å›½å®¶ä¸å›½å®¶ä¹‹é—´é€šè¿‡ ä½œç”¨åŸŸé“¾ æ¥å®ç°äº¤æµ

:::

<img alt="å›¾è§£" src={image1} />



---
url: /guide/contact-us.md
---

# è”ç³»æˆ‘ä»¬

* Issues: [Issues](https://github.com/bytedance/flowgram.ai/issues)
* Discord: https://discord.gg/SwDWdrgA9f
* Lark: é€šè¿‡ [æ³¨å†Œé£ä¹¦](https://www.feishu.cn/en/) å¹¶æ‰«æä¸‹è¾¹çš„äºŒç»´ç åŠ å…¥é£ä¹¦ç¾¤



---
url: /guide/getting-started/create-fixed-layout-simple.md
---

# åˆ›å»ºå›ºå®šå¸ƒå±€ç”»å¸ƒ

æœ¬æ¡ˆä¾‹å¯é€šè¿‡ `npx @flowgram.ai/create-app@latest fixed-layout-simple` å®‰è£…ï¼Œå®Œæ•´ä»£ç åŠæ•ˆæœè§ï¼š

å›ºå®šå¸ƒå±€åŸºç¡€ç”¨æ³•

æ–‡ä»¶ç»“æ„:

```
- hooks
  - use-editor-props.ts # ç”»å¸ƒé…ç½®
- components
  - base-node.tsx # èŠ‚ç‚¹æ¸²æŸ“
  - tools.tsx # ç”»å¸ƒå·¥å…·æ 
- initial-data.ts # åˆå§‹åŒ–æ•°æ®
- node-registries.ts # èŠ‚ç‚¹é…ç½®
- app.tsx # ç”»å¸ƒå…¥å£
```

### 1. ç”»å¸ƒå…¥å£

* `FixedLayoutEditorProvider`: ç”»å¸ƒé…ç½®å™¨, å†…éƒ¨ä¼šç”Ÿæˆ react-context ä¾›å­ç»„ä»¶æ¶ˆè´¹
* `EditorRenderer`: ä¸ºæœ€ç»ˆæ¸²æŸ“çš„ç”»å¸ƒï¼Œå¯ä»¥åŒ…è£…åœ¨å…¶ä»–ç»„ä»¶ä¸‹è¾¹æ–¹ä¾¿å®šåˆ¶ç”»å¸ƒä½ç½®

```tsx pure title="app.tsx"

import {
  FixedLayoutEditorProvider,
  EditorRenderer,
} from '@flowgram.ai/fixed-layout-editor';

import '@flowgram.ai/fixed-layout-editor/index.css'; // åŠ è½½æ ·å¼

import { useEditorProps } from './hooks/use-editor-props' // ç”»å¸ƒè¯¦ç»†çš„ props é…ç½®
import { Tools } from './components/tools' // ç”»å¸ƒå·¥å…·

function App() {
  const editorProps = useEditorProps()
  return (
    <FixedLayoutEditorProvider {...editorProps}>
      <EditorRenderer className="demo-editor" />
      <Tools />
    </FixedLayoutEditorProvider>
  );
}
```

### 2. é…ç½®ç”»å¸ƒ

ç”»å¸ƒé…ç½®é‡‡ç”¨å£°æ˜å¼ï¼Œæä¾› æ•°æ®ã€æ¸²æŸ“ã€äº‹ä»¶ã€æ’ä»¶ç›¸å…³é…ç½®

```tsx pure title="hooks/use-editor-props.tsx"
import { useMemo } from 'react';
import { type FixedLayoutProps } from '@flowgram.ai/fixed-layout-editor';
import { defaultFixedSemiMaterials } from '@flowgram.ai/fixed-semi-materials';
import { createMinimapPlugin } from '@flowgram.ai/minimap-plugin';

import { initialData } from './initial-data' // åˆå§‹åŒ–æ•°æ®
import { nodeRegistries } from './node-registries' // èŠ‚ç‚¹å£°æ˜é…ç½®
import { BaseNode } from './base-node' // èŠ‚ç‚¹æ¸²æŸ“

export function useEditorProps(
): FixedLayoutProps {
  return useMemo<FixedLayoutProps>(
    () => ({
      /**
       * åˆå§‹åŒ–æ•°æ®
       */
      initialData,
      /**
       * ç”»å¸ƒèŠ‚ç‚¹å®šä¹‰
       */
      nodeRegistries,
      /**
       * å¯ä»¥é€šè¿‡ key è‡ªå®šä¹‰ UI ç»„ä»¶, æ¯”å¦‚æ·»åŠ æŒ‰é’®ï¼Œè¿™é‡Œæä¾›äº†ä¸€å¥— semi ç»„ä»¶æ–¹ä¾¿å¿«é€ŸéªŒè¯, å¦‚æœéœ€è¦æ·±åº¦å®šåˆ¶ï¼Œå‚è€ƒï¼š
       * https://github.com/bytedance/flowgram.ai/blob/main/packages/materials/fixed-semi-materials/src/components/index.tsx
       */
      materials: {
        components: {
          ...defaultFixedSemiMaterials,
          // [FlowRendererKey.ADDER]: NodeAdder,
          // [FlowRendererKey.BRANCH_ADDER]: BranchAdder,
        },
        renderDefaultNode: BaseNode, // èŠ‚ç‚¹æ¸²æŸ“ç»„ä»¶
      },
      /**
       * èŠ‚ç‚¹å¼•æ“, ç”¨äºæ¸²æŸ“èŠ‚ç‚¹è¡¨å•
       */
      nodeEngine: {
        enable: true,
      },
      /**
       * ç”»å¸ƒå†å²è®°å½•, ç”¨äºæ§åˆ¶ redo/undo
       */
      history: {
        enable: true,
        enableChangeNode: true, // ç”¨äºç›‘å¬èŠ‚ç‚¹è¡¨å•æ•°æ®å˜åŒ–
      },
      /**
       * ç”»å¸ƒåˆå§‹åŒ–å›è°ƒ
       */
      onInit: ctx => {
        // å¦‚æœè¦åŠ¨æ€åŠ è½½æ•°æ®ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•å¼‚æ­¥æ‰§è¡Œ
        // ctx.docuemnt.fromJSON(initialData)
      },
      /**
       * ç”»å¸ƒç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæˆå›è°ƒ
       */
      onAllLayersRendered: (ctx) => {},
      /**
       * ç”»å¸ƒé”€æ¯å›è°ƒ
       */
      onDispose: () => { },
      plugins: () => [
        /**
         * ç¼©ç•¥å›¾æ’ä»¶
         */
        createMinimapPlugin({}),
      ],
    }),
    [],
  );
}

```

### 3. é…ç½®æ•°æ®

ç”»å¸ƒæ–‡æ¡£æ•°æ®é‡‡ç”¨æ ‘å½¢ç»“æ„ï¼Œæ”¯æŒåµŒå¥—

:::note æ–‡æ¡£æ•°æ®åŸºæœ¬ç»“æ„:

* nodes `array` èŠ‚ç‚¹åˆ—è¡¨, æ”¯æŒåµŒå¥—

:::

:::note èŠ‚ç‚¹æ•°æ®åŸºæœ¬ç»“æ„:

* id: `string` èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†, å¿…é¡»ä¿è¯å”¯ä¸€
* meta: `object` èŠ‚ç‚¹çš„ ui é…ç½®ä¿¡æ¯ï¼Œå¦‚è‡ªç”±å¸ƒå±€çš„ `position` ä¿¡æ¯æ”¾è¿™é‡Œ
* type: `string | number` èŠ‚ç‚¹ç±»å‹ï¼Œä¼šå’Œ `nodeRegistries` ä¸­çš„ `type` å¯¹åº”
* data: `object` èŠ‚ç‚¹è¡¨å•æ•°æ®
* blocks: `array` èŠ‚ç‚¹çš„åˆ†æ”¯, é‡‡ç”¨ `block` æ›´è´´è¿‘ `Gramming`

:::

```tsx pure title="initial-data.tsx"
import { FlowDocumentJSON } from '@flowgram.ai/fixed-layout-editor';

/**
 * é…ç½®æµç¨‹æ•°æ®ï¼Œæ•°æ®ä¸º blocks åµŒå¥—çš„æ ¼å¼
 */
export const initialData: FlowDocumentJSON = {
  nodes: [
    // å¼€å§‹èŠ‚ç‚¹
    {
      id: 'start_0',
      type: 'start',
      data: {
        title: 'Start',
        content: 'start content'
      },
      blocks: [],
    },
    // åˆ†æ”¯èŠ‚ç‚¹
    {
      id: 'condition_0',
      type: 'condition',
      data: {
        title: 'Condition'
      },
      blocks: [
        {
          id: 'branch_0',
          type: 'block',
          data: {
            title: 'Branch 0',
            content: 'branch 1 content'
          },
          blocks: [
            {
              id: 'custom_0',
              type: 'custom',
              data: {
                title: 'Custom',
                content: 'custrom content'
              },
            },
          ],
        },
        {
          id: 'branch_1',
          type: 'block',
          data: {
            title: 'Branch 1',
            content: 'branch 1 content'
          },
          blocks: [],
        },
      ],
    },
    // ç»“æŸèŠ‚ç‚¹
    {
      id: 'end_0',
      type: 'end',
      data: {
        title: 'End',
        content: 'end content'
      },
    },
  ],
};

```

### 4. å£°æ˜èŠ‚ç‚¹

å£°æ˜èŠ‚ç‚¹å¯ä»¥ç”¨äºç¡®å®šèŠ‚ç‚¹çš„ç±»å‹åŠæ¸²æŸ“æ–¹å¼

```tsx pure title="node-registries.tsx"
import { FlowNodeRegistry, ValidateTrigger } from '@flowgram.ai/fixed-layout-editor';

/**
 * è‡ªå®šä¹‰èŠ‚ç‚¹æ³¨å†Œ
 */
export const nodeRegistries: FlowNodeRegistry[] = [
  {
    /**
     * è‡ªå®šä¹‰èŠ‚ç‚¹ç±»å‹
     */
    type: 'condition',
    /**
     * è‡ªå®šä¹‰èŠ‚ç‚¹æ‰©å±•:
     *  - loop: æ‰©å±•ä¸ºå¾ªç¯èŠ‚ç‚¹
     *  - start: æ‰©å±•ä¸ºå¼€å§‹èŠ‚ç‚¹
     *  - dynamicSplit: æ‰©å±•ä¸ºåˆ†æ”¯èŠ‚ç‚¹
     *  - end: æ‰©å±•ä¸ºç»“æŸèŠ‚ç‚¹
     *  - tryCatch: æ‰©å±•ä¸º tryCatch èŠ‚ç‚¹
     *  - default: æ‰©å±•ä¸ºæ™®é€šèŠ‚ç‚¹ (é»˜è®¤)
     */
    extend: 'dynamicSplit',
    /**
     * èŠ‚ç‚¹é…ç½®ä¿¡æ¯
     */
    meta: {
      // isStart: false, // æ˜¯å¦ä¸ºå¼€å§‹èŠ‚ç‚¹
      // isNodeEnd: false, // æ˜¯å¦ä¸ºç»“æŸèŠ‚ç‚¹ï¼Œç»“æŸèŠ‚ç‚¹åè¾¹æ— æ³•å†æ·»åŠ èŠ‚ç‚¹
      // draggable: false, // æ˜¯å¦å¯æ‹–æ‹½ï¼Œå¦‚å¼€å§‹èŠ‚ç‚¹å’Œç»“æŸèŠ‚ç‚¹æ— æ³•æ‹–æ‹½
      // selectable: false, // è§¦å‘å™¨ç­‰å¼€å§‹èŠ‚ç‚¹ä¸èƒ½è¢«æ¡†é€‰
      // deleteDisable: true, // ç¦æ­¢åˆ é™¤
      // copyDisable: true, // ç¦æ­¢copy
      // addDisable: true, // ç¦æ­¢æ·»åŠ 
    },
    /**
     * é…ç½®èŠ‚ç‚¹è¡¨å•çš„æ ¡éªŒåŠæ¸²æŸ“,
     * æ³¨ï¼švalidate é‡‡ç”¨æ•°æ®å’Œæ¸²æŸ“åˆ†ç¦»ï¼Œä¿è¯èŠ‚ç‚¹å³ä½¿ä¸æ¸²æŸ“ä¹Ÿèƒ½å¯¹æ•°æ®åšæ ¡éªŒ
     */
    formMeta: {
      validateTrigger: ValidateTrigger.onChange,
      validate: {
        title: ({ value }) => (value ? undefined : 'Title is required'),
      },
      /**
       * Render form
       */
      render: () => (
       <>
          <Field name="title">
            {({ field }) => <div className="demo-free-node-title">{field.value}</div>}
          </Field>
          <Field name="content">
            {({ field }) => <input onChange={field.onChange} value={field.value}/>}
          </Field>
        </>
      )
    },
  },
];

```

### 5. æ¸²æŸ“èŠ‚ç‚¹

æ¸²æŸ“èŠ‚ç‚¹ç”¨äºæ·»åŠ æ ·å¼ã€äº‹ä»¶åŠè¡¨å•æ¸²æŸ“çš„ä½ç½®

```tsx pure title="components/base-node.tsx"
import { useNodeRender } from '@flowgram.ai/fixed-layout-editor';

export const BaseNode = () => {
  /**
   * æä¾›èŠ‚ç‚¹æ¸²æŸ“ç›¸å…³çš„æ–¹æ³•
   */
  const nodeRender = useNodeRender();
  /**
   * åªæœ‰åœ¨èŠ‚ç‚¹å¼•æ“å¼€å¯æ—¶å€™æ‰èƒ½ä½¿ç”¨è¡¨å•
   */
  const form = nodeRender.form;

  return (
    <div
      className="demo-fixed-node"
      onMouseEnter={nodeRender.onMouseEnter}
      onMouseLeave={nodeRender.onMouseLeave}
      onMouseDown={e => {
        // è§¦å‘æ‹–æ‹½
        nodeRender.startDrag(e);
        e.stopPropagation();
      }}
      style={{
        // BlockOrderIcon è¡¨ç¤ºä¸ºåˆ†æ”¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒBlockIcon åˆ™è¡¨ç¤ºæ•´ä¸ª condition çš„å¤´éƒ¨èŠ‚ç‚¹
        ...(nodeRender.isBlockOrderIcon || nodeRender.isBlockIcon ? { width: 260 } : {}),
        outline: form?.state.invalid ? '1px solid red' : 'none', // è¡¨å•æ ¡éªŒé”™è¯¯è®©è¾¹æ¡†æ ‡çº¢
      }}
    >
      {
        // è¡¨å•æ¸²æŸ“é€šè¿‡ formMeta ç”Ÿæˆ
        form?.render()
      }
    </div>
  );
};

```

### 6. æ·»åŠ å·¥å…·

å·¥å…·ä¸»è¦ç”¨äºæ§åˆ¶ç”»å¸ƒç¼©æ”¾ç­‰æ“ä½œ, å·¥å…·æ±‡æ€»åœ¨ `usePlaygroundTools` ä¸­, è€Œ `useClientContext` ç”¨äºè·å–ç”»å¸ƒçš„ä¸Šä¸‹æ–‡, é‡Œè¾¹åŒ…å«ç”»å¸ƒçš„æ ¸å¿ƒæ¨¡å—å¦‚ `history`

```tsx pure title="components/tools.tsx"
import { useEffect, useState } from 'react'
import { usePlaygroundTools, useClientContext } from '@flowgram.ai/fixed-layout-editor';

export function Tools() {
  const { history } = useClientContext();
  const tools = usePlaygroundTools();
  const [canUndo, setCanUndo] = useState(false);
  const [canRedo, setCanRedo] = useState(false);

  useEffect(() => {
    const disposable = history.undoRedoService.onChange(() => {
      setCanUndo(history.canUndo());
      setCanRedo(history.canRedo());
    });
    return () => disposable.dispose();
  }, [history]);

  return <div style={{ position: 'absolute', zIndex: 10, bottom: 16, left: 16, display: 'flex', gap: 8 }}>
    <button onClick={() => tools.zoomin()}>ZoomIn</button>
    <button onClick={() => tools.zoomout()}>ZoomOut</button>
    <button onClick={() => tools.fitView()}>Fitview</button>
    <button onClick={() => tools.changeLayout()}>ChangeLayout</button>
    <button onClick={() => history.undo()} disabled={!canUndo}>Undo</button>
    <button onClick={() => history.redo()} disabled={!canRedo}>Redo</button>
    <span>{Math.floor(tools.zoom * 100)}%</span>
  </div>
}

```

### 7. æ•ˆæœ




---
url: /guide/getting-started/create-free-layout-simple.md
---

# åˆ›å»ºè‡ªç”±å¸ƒå±€ç”»å¸ƒ

æœ¬æ¡ˆä¾‹å¯é€šè¿‡ `npx @flowgram.ai/create-app@latest free-layout-simple` å®‰è£…ï¼Œå®Œæ•´ä»£ç åŠæ•ˆæœè§ï¼š

è‡ªç”±å¸ƒå±€åŸºç¡€ç”¨æ³•

æ–‡ä»¶ç»“æ„:

```
- hooks
  - use-editor-props.ts # ç”»å¸ƒé…ç½®
- components
  - base-node.tsx # èŠ‚ç‚¹æ¸²æŸ“
  - tools.tsx # ç”»å¸ƒå·¥å…·æ 
- initial-data.ts # åˆå§‹åŒ–æ•°æ®
- node-registries.ts # èŠ‚ç‚¹é…ç½®
- app.tsx # ç”»å¸ƒå…¥å£
```

### 1. ç”»å¸ƒå…¥å£

* `FreeLayoutEditorProvider`: ç”»å¸ƒé…ç½®å™¨, å†…éƒ¨ä¼šç”Ÿæˆ react-context ä¾›å­ç»„ä»¶æ¶ˆè´¹
* `EditorRenderer`: ä¸ºæœ€ç»ˆæ¸²æŸ“çš„ç”»å¸ƒï¼Œå¯ä»¥åŒ…è£…åœ¨å…¶ä»–ç»„ä»¶ä¸‹è¾¹æ–¹ä¾¿å®šåˆ¶ç”»å¸ƒä½ç½®

```tsx pure title="app.tsx"

import {
  FreeLayoutEditorProvider,
  EditorRenderer,
} from '@flowgram.ai/free-layout-editor';

import '@flowgram.ai/free-layout-editor/index.css'; // åŠ è½½æ ·å¼

import { useEditorProps } from './use-editor-props' // ç”»å¸ƒè¯¦ç»†çš„ props é…ç½®
import { Tools } from './components/tools' // ç”»å¸ƒå·¥å…·

function App() {
  const editorProps = useEditorProps()
  return (
    <FreeLayoutEditorProvider {...editorProps}>
      <EditorRenderer className="demo-editor" />
      <Tools />
    </FreeLayoutEditorProvider>
  );
}
```

### 2. é…ç½®ç”»å¸ƒ

ç”»å¸ƒé…ç½®é‡‡ç”¨å£°æ˜å¼ï¼Œæä¾› æ•°æ®ã€æ¸²æŸ“ã€äº‹ä»¶ã€æ’ä»¶ç›¸å…³é…ç½®

```tsx pure title="hooks/use-editor-props.tsx"
import { useMemo } from 'react';
import { type FreeLayoutProps } from '@flowgram.ai/free-layout-editor';
import { createMinimapPlugin } from '@flowgram.ai/minimap-plugin';

import { initialData } from './initial-data' // åˆå§‹åŒ–æ•°æ®
import { nodeRegistries } from './node-registries' // èŠ‚ç‚¹å£°æ˜é…ç½®
import { BaseNode } from './components/base-node' // èŠ‚ç‚¹æ¸²æŸ“

export function useEditorProps(
): FreeLayoutProps {
  return useMemo<FreeLayoutProps>(
    () => ({
      /**
       * åˆå§‹åŒ–æ•°æ®
       */
      initialData,
      /**
       * ç”»å¸ƒèŠ‚ç‚¹å®šä¹‰
       */
      nodeRegistries,
      /**
       * ç‰©æ–™
       */
      materials: {
        renderDefaultNode: BaseNode, // èŠ‚ç‚¹æ¸²æŸ“ç»„ä»¶
      },
      /**
       * èŠ‚ç‚¹å¼•æ“, ç”¨äºæ¸²æŸ“èŠ‚ç‚¹è¡¨å•
       */
      nodeEngine: {
        enable: true,
      },
      /**
       * ç”»å¸ƒå†å²è®°å½•, ç”¨äºæ§åˆ¶ redo/undo
       */
      history: {
        enable: true,
        enableChangeNode: true, // ç”¨äºç›‘å¬èŠ‚ç‚¹è¡¨å•æ•°æ®å˜åŒ–
      },
      /**
       * ç”»å¸ƒåˆå§‹åŒ–å›è°ƒ
       */
      onInit: ctx => {
        // å¦‚æœè¦åŠ¨æ€åŠ è½½æ•°æ®ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•å¼‚æ­¥æ‰§è¡Œ
        // ctx.docuemnt.fromJSON(initialData)
      },
      /**
       * ç”»å¸ƒç¬¬ä¸€æ¬¡æ¸²æŸ“å®Œæ•´å›è°ƒ
       */
      onAllLayersRendered: (ctx) => {},
      /**
       * ç”»å¸ƒé”€æ¯å›è°ƒ
       */
      onDispose: () => { },
      plugins: () => [
        /**
         * ç¼©ç•¥å›¾æ’ä»¶
         */
        createMinimapPlugin({}),
      ],
    }),
    [],
  );
}

```

### 3. é…ç½®æ•°æ®

ç”»å¸ƒæ–‡æ¡£æ•°æ®é‡‡ç”¨æ ‘å½¢ç»“æ„ï¼Œæ”¯æŒåµŒå¥—

:::note æ–‡æ¡£æ•°æ®åŸºæœ¬ç»“æ„:

* nodes `array` èŠ‚ç‚¹åˆ—è¡¨, æ”¯æŒåµŒå¥—
* edges `array` è¾¹åˆ—è¡¨

:::

:::note èŠ‚ç‚¹æ•°æ®åŸºæœ¬ç»“æ„:

* id: `string` èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†, å¿…é¡»ä¿è¯å”¯ä¸€
* meta: `object` èŠ‚ç‚¹çš„ ui é…ç½®ä¿¡æ¯ï¼Œå¦‚è‡ªç”±å¸ƒå±€çš„ `position` ä¿¡æ¯æ”¾è¿™é‡Œ
* type: `string | number` èŠ‚ç‚¹ç±»å‹ï¼Œä¼šå’Œ `nodeRegistries` ä¸­çš„ `type` å¯¹åº”
* data: `object` èŠ‚ç‚¹è¡¨å•æ•°æ®, ä¸šåŠ¡å¯è‡ªå®šä¹‰
* blocks: `array` èŠ‚ç‚¹çš„åˆ†æ”¯, é‡‡ç”¨ `block` æ›´è´´è¿‘ `Gramming`, ç›®å‰ä¼šå­˜å­ç”»å¸ƒçš„èŠ‚ç‚¹
* edges: `array` å­ç”»å¸ƒçš„è¾¹æ•°æ®

:::

:::note è¾¹æ•°æ®åŸºæœ¬ç»“æ„:

* sourceNodeID: `string` å¼€å§‹èŠ‚ç‚¹ id
* targetNodeID: `string` ç›®æ ‡èŠ‚ç‚¹ id
* sourcePortID?: `string | number` å¼€å§‹ç«¯å£ id, ç¼ºçœåˆ™é‡‡ç”¨å¼€å§‹èŠ‚ç‚¹çš„é»˜è®¤ç«¯å£
* targetPortID?: `string | number` ç›®æ ‡ç«¯å£ id, ç¼ºçœåˆ™é‡‡ç”¨ç›®æ ‡èŠ‚ç‚¹çš„é»˜è®¤ç«¯å£

:::

```tsx pure title="initial-data.ts"
import { WorkflowJSON } from '@flowgram.ai/free-layout-editor';

export const initialData: WorkflowJSON = {
  nodes: [
    {
      id: 'start_0',
      type: 'start',
      meta: {
        position: { x: 0, y: 0 },
      },
      data: {
        title: 'Start',
        content: 'Start content'
      },
    },
    {
      id: 'node_0',
      type: 'custom',
      meta: {
        position: { x: 400, y: 0 },
      },
      data: {
        title: 'Custom',
        content: 'Custom node content'
      },
    },
    {
      id: 'end_0',
      type: 'end',
      meta: {
        position: { x: 800, y: 0 },
      },
      data: {
        title: 'End',
        content: 'End content'
      },
    },
  ],
  edges: [
    {
      sourceNodeID: 'start_0',
      targetNodeID: 'node_0',
    },
    {
      sourceNodeID: 'node_0',
      targetNodeID: 'end_0',
    },
  ],
};


```

### 4. å£°æ˜èŠ‚ç‚¹

å£°æ˜èŠ‚ç‚¹å¯ä»¥ç”¨äºç¡®å®šèŠ‚ç‚¹çš„ç±»å‹åŠæ¸²æŸ“æ–¹å¼

```tsx pure title="node-registries.tsx"
import { WorkflowNodeRegistry, ValidateTrigger } from '@flowgram.ai/free-layout-editor';

/**
 * You can customize your own node registry
 * ä½ å¯ä»¥è‡ªå®šä¹‰èŠ‚ç‚¹çš„æ³¨å†Œå™¨
 */
export const nodeRegistries: WorkflowNodeRegistry[] = [
  {
    type: 'start',
    meta: {
      isStart: true, // æ ‡è®°ä¸ºå¼€å§‹èŠ‚ç‚¹
      deleteDisable: true, // å¼€å§‹èŠ‚ç‚¹ä¸èƒ½åˆ é™¤
      copyDisable: true, // å¼€å§‹èŠ‚ç‚¹ä¸èƒ½å¤åˆ¶
      defaultPorts: [{ type: 'output' }], // ç”¨äºå®šä¹‰èŠ‚ç‚¹çš„è¾“å…¥å’Œè¾“å‡ºç«¯å£, å¼€å§‹èŠ‚ç‚¹åªæœ‰è¾“å‡ºç«¯å£
      // useDynamicPort: true, // ç”¨äºåŠ¨æ€ç«¯å£ï¼Œä¼šå¯»æ‰¾ data-port-id å’Œ data-port-type å±æ€§çš„ dom ä½œä¸ºç«¯å£
    },
    /**
     * é…ç½®èŠ‚ç‚¹è¡¨å•çš„æ ¡éªŒåŠæ¸²æŸ“,
     * æ³¨ï¼švalidate é‡‡ç”¨æ•°æ®å’Œæ¸²æŸ“åˆ†ç¦»ï¼Œä¿è¯èŠ‚ç‚¹å³ä½¿ä¸æ¸²æŸ“ä¹Ÿèƒ½å¯¹æ•°æ®åšæ ¡éªŒ
     */
    formMeta: {
      validateTrigger: ValidateTrigger.onChange,
      validate: {
        title: ({ value }) => (value ? undefined : 'Title is required'),
      },
      /**
       * Render form
       */
      render: () => (
       <>
          <Field name="title">
            {({ field }) => <div className="demo-free-node-title">{field.value}</div>}
          </Field>
          <Field name="content">
            {({ field }) => <input onChange={field.onChange} value={field.value}/>}
          </Field>
        </>
      )
    },
  },
  {
    type: 'end',
    meta: {
      deleteDisable: true,
      copyDisable: true,
      defaultPorts: [{ type: 'input' }],
    },
    formMeta: {
      // ...
    }
  },
  {
    type: 'custom',
    meta: {
    },
    formMeta: {
      // ...
    },
    defaultPorts: [{ type: 'output' }, { type: 'input' }], // æ™®é€šèŠ‚ç‚¹æœ‰ä¸¤ä¸ªç«¯å£
  },
];

```

### 5. æ¸²æŸ“èŠ‚ç‚¹

æ¸²æŸ“èŠ‚ç‚¹ç”¨äºæ·»åŠ æ ·å¼ã€äº‹ä»¶åŠè¡¨å•æ¸²æŸ“çš„ä½ç½®

```tsx pure title="components/base-node.tsx"
import { useNodeRender, WorkflowNodeRenderer } from '@flowgram.ai/free-layout-editor';

export const BaseNode = () => {
  /**
   * æä¾›èŠ‚ç‚¹æ¸²æŸ“ç›¸å…³çš„æ–¹æ³•
   */
  const { form } = useNodeRender()
  /**
   * WorkflowNodeRenderer ä¼šæ·»åŠ èŠ‚ç‚¹æ‹–æ‹½äº‹ä»¶åŠ ç«¯å£æ¸²æŸ“ï¼Œå¦‚æœè¦æ·±åº¦å®šåˆ¶ï¼Œå¯ä»¥çœ‹è¯¥ç»„ä»¶æºä»£ç :
   * https://github.com/bytedance/flowgram.ai/blob/main/packages/client/free-layout-editor/src/components/workflow-node-renderer.tsx
   */
  return (
    <WorkflowNodeRenderer className="demo-free-node" node={props.node}>
      {
        // è¡¨å•æ¸²æŸ“é€šè¿‡ formMeta ç”Ÿæˆ
        form?.render()
      }
    </WorkflowNodeRenderer>
  )
};

```

### 6. æ·»åŠ å·¥å…·

å·¥å…·ä¸»è¦ç”¨äºæ§åˆ¶ç”»å¸ƒç¼©æ”¾ç­‰æ“ä½œ, å·¥å…·æ±‡æ€»åœ¨ `usePlaygroundTools` ä¸­, è€Œ `useClientContext` ç”¨äºè·å–ç”»å¸ƒçš„ä¸Šä¸‹æ–‡, é‡Œè¾¹åŒ…å«ç”»å¸ƒçš„æ ¸å¿ƒæ¨¡å—å¦‚ `history`

```tsx pure title="components/tools.tsx"
import { useEffect, useState } from 'react'
import { usePlaygroundTools, useClientContext } from '@flowgram.ai/free-layout-editor';

export function Tools() {
  const { history } = useClientContext();
  const tools = usePlaygroundTools();
  const [canUndo, setCanUndo] = useState(false);
  const [canRedo, setCanRedo] = useState(false);

  useEffect(() => {
    const disposable = history.undoRedoService.onChange(() => {
      setCanUndo(history.canUndo());
      setCanRedo(history.canRedo());
    });
    return () => disposable.dispose();
  }, [history]);

  return <div style={{ position: 'absolute', zIndex: 10, bottom: 16, left: 226, display: 'flex', gap: 8 }}>
    <button onClick={() => tools.zoomin()}>ZoomIn</button>
    <button onClick={() => tools.zoomout()}>ZoomOut</button>
    <button onClick={() => tools.fitView()}>Fitview</button>
    <button onClick={() => tools.autoLayout()}>AutoLayout</button>
    <button onClick={() => history.undo()} disabled={!canUndo}>Undo</button>
    <button onClick={() => history.redo()} disabled={!canRedo}>Redo</button>
    <span>{Math.floor(tools.zoom * 100)}%</span>
  </div>
}
```

### 7. æ•ˆæœ




---
url: /guide/getting-started/install.md
---

# å®‰è£…



## é€šè¿‡ npx å®‰è£…

```shell
# é€‰æ‹© demo
- fixed-layout # å›ºå®šå¸ƒå±€æœ€ä½³å®è·µ
- free-layout # è‡ªç”±å¸ƒå±€æœ€ä½³å®è·µ
- fixed-layout-simple # å›ºå®šå¸ƒå±€åŸºç¡€ç”¨æ³•
- free-layout-simple # è‡ªç”±å¸ƒå±€åŸºç¡€ç”¨æ³•

```

## é€šè¿‡ npm å®‰è£…



---
url: /guide/question.md
---

# å¸¸è§é—®é¢˜

## è¿è¡ŒæŠ¥æŠ¥é”™

## å¦‚ä½•ä¿®æ”¹èŠ‚ç‚¹çš„æ•°æ®

## æ˜¯å¦æ”¯æŒ vue

##



---
url: /index.md
---



