"use strict";(self.webpackChunk_flowgram_ai_docs=self.webpackChunk_flowgram_ai_docs||[]).push([["770206"],{736200:function(n,e,t){t.r(e),t.d(e,{default:function(){return a}});var i=t(110239),o=t(444827),r=t(156973);function d(n){let e=Object.assign({h1:"h1",a:"a",p:"p",code:"code",h3:"h3",ul:"ul",li:"li",pre:"pre",div:"div"},(0,o.ah)(),n.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(e.h1,{id:"创建固定布局画布",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#创建固定布局画布",children:"#"}),"创建固定布局画布"]}),"\n",(0,i.jsxs)(e.p,{children:["本案例可通过 ",(0,i.jsx)(e.code,{children:"npx @flowgram.ai/create-app@latest fixed-layout-simple"})," 安装，完整代码及效果见："]}),"\n",(0,i.jsx)("div",{className:"rs-tip",children:(0,i.jsx)("a",{className:"rs-link",href:"/examples/fixed-layout/fixed-layout-simple.html",children:(0,i.jsx)(e.p,{children:"固定布局基础用法"})})}),"\n",(0,i.jsxs)(e.h3,{id:"1-画布入口",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#1-画布入口",children:"#"}),"1. 画布入口"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"FixedLayoutEditorProvider"}),": 画布配置器, 内部会生成 react-context 供子组件消费"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"EditorRenderer"}),": 为最终渲染的画布，可以包装在其他组件下边方便定制画布位置"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",meta:'pure title="app.tsx"',children:"\nimport {\n  FixedLayoutEditorProvider,\n  EditorRenderer,\n} from '@flowgram.ai/fixed-layout-editor';\n\nimport { useEditorProps } from './use-editor-props' // 画布详细的 props 配置\nimport { Tools } from './tools' // 画布工具\n\nfunction App() {\n  const editorProps = useEditorProps()\n  return (\n    <FixedLayoutEditorProvider {...editorProps}>\n      <EditorRenderer className=\"demo-editor\" />\n      <Tools />\n    </FixedLayoutEditorProvider>\n  );\n}\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"2-配置画布",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#2-配置画布",children:"#"}),"2. 配置画布"]}),"\n",(0,i.jsx)(e.p,{children:"画布配置采用声明式，提供 数据、渲染、事件、插件相关配置"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",meta:'pure title="use-editor-props.tsx"',children:"import { useMemo } from 'react';\nimport { type FixedLayoutProps } from '@flowgram.ai/fixed-layout-editor';\nimport { defaultFixedSemiMaterials } from '@flowgram.ai/fixed-semi-materials';\nimport { createMinimapPlugin } from '@flowgram.ai/minimap-plugin';\n\nimport { intialData } from './initial-data' // 初始化数据\nimport { nodeRegistries } from './node-registries' // 节点声明配置\nimport { BaseNode } from './base-node' // 节点渲染\n\nexport function useEditorProps(\n): FixedLayoutProps {\n  return useMemo<FixedLayoutProps>(\n    () => ({\n      /**\n       * 初始化数据\n       */\n      initialData,\n      /**\n       * 画布节点定义\n       */\n      nodeRegistries,\n      /**\n       * 可以通过 key 自定义 UI 组件, 比如添加按钮，这里提供了一套 semi 组件方便快速验证, 如果需要深度定制，参考：\n       * https://github.com/bytedance/flowgram.ai/blob/main/packages/materials/fixed-semi-materials/src/components/index.tsx\n       */\n      materials: {\n        renderNodes: {\n          ...defaultFixedSemiMaterials,\n          // [FlowRendererKey.ADDER]: NodeAdder,\n          // [FlowRendererKey.BRANCH_ADDER]: BranchAdder,\n        },\n        renderDefaultNode: BaseNode, // 节点渲染组件\n      },\n      /**\n       * 节点引擎, 用于渲染节点表单\n       */\n      nodeEngine: {\n        enable: true,\n      },\n      /**\n       * 画布历史记录, 用于控制 redo/undo\n       */\n      history: {\n        enable: true,\n        enableChangeNode: true, // 用于监听节点表单数据变化\n      },\n      /**\n       * 画布初始化回调\n       */\n      onInit: ctx => {\n        // 如果要动态加载数据，可以通过如下方法异步执行\n        // ctx.docuemnt.fromJSON(initialData)\n      },\n      /**\n       * 画布第一次渲染完成回调\n       */\n      onAllLayersRendered: (ctx) => {},\n      /**\n       * 画布销毁回调\n       */\n      onDispose: () => { },\n      plugins: () => [\n        /**\n         * 缩略图插件\n         */\n        createMinimapPlugin({}),\n      ],\n    }),\n    [],\n  );\n}\n\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"3-配置数据",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#3-配置数据",children:"#"}),"3. 配置数据"]}),"\n",(0,i.jsx)(e.p,{children:"画布文档数据采用树形结构，支持嵌套"}),"\n",(0,i.jsxs)(e.div,{className:"rspress-directive note",children:[(0,i.jsx)(e.div,{className:"rspress-directive-title",children:"文档数据基本结构:"}),(0,i.jsx)(e.div,{className:"rspress-directive-content",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["nodes ",(0,i.jsx)(e.code,{children:"array"})," 节点列表, 支持嵌套"]}),"\n"]})})]}),"\n",(0,i.jsxs)(e.div,{className:"rspress-directive note",children:[(0,i.jsx)(e.div,{className:"rspress-directive-title",children:"节点数据基本结构:"}),(0,i.jsx)(e.div,{className:"rspress-directive-content",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["id: ",(0,i.jsx)(e.code,{children:"string"})," 节点唯一标识, 必须保证唯一"]}),"\n",(0,i.jsxs)(e.li,{children:["meta: ",(0,i.jsx)(e.code,{children:"object"})," 节点的 ui 配置信息，如自由布局的 ",(0,i.jsx)(e.code,{children:"position"})," 信息放这里"]}),"\n",(0,i.jsxs)(e.li,{children:["type: ",(0,i.jsx)(e.code,{children:"string | number"})," 节点类型，会和 ",(0,i.jsx)(e.code,{children:"nodeRegistries"})," 中的 ",(0,i.jsx)(e.code,{children:"type"})," 对应"]}),"\n",(0,i.jsxs)(e.li,{children:["data: ",(0,i.jsx)(e.code,{children:"object"})," 节点表单数据"]}),"\n",(0,i.jsxs)(e.li,{children:["blocks: ",(0,i.jsx)(e.code,{children:"array"})," 节点的分支, 采用 ",(0,i.jsx)(e.code,{children:"block"})," 更贴近 ",(0,i.jsx)(e.code,{children:"Gramming"})]}),"\n"]})})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",meta:'pure title="initial-data.tsx"',children:"import { FlowDocumentJSON } from '@flowgram.ai/fixed-layout-editor';\n\n/**\n * 配置流程数据，数据为 blocks 嵌套的格式\n */\nexport const initialData: FlowDocumentJSON = {\n  nodes: [\n    // 开始节点\n    {\n      id: 'start_0',\n      type: 'start',\n      data: {\n        title: 'Start',\n        content: 'start content'\n      },\n      blocks: [],\n    },\n    // 分支节点\n    {\n      id: 'condition_0',\n      type: 'condition',\n      data: {\n        title: 'Condition'\n      },\n      blocks: [\n        {\n          id: 'branch_0',\n          type: 'block',\n          data: {\n            title: 'Branch 0',\n            content: 'branch 1 content'\n          },\n          blocks: [\n            {\n              id: 'custom_0',\n              type: 'custom',\n              data: {\n                title: 'Custom',\n                content: 'custrom content'\n              },\n            },\n          ],\n        },\n        {\n          id: 'branch_1',\n          type: 'block',\n          data: {\n            title: 'Branch 1',\n            content: 'branch 1 content'\n          },\n          blocks: [],\n        },\n      ],\n    },\n    // 结束节点\n    {\n      id: 'end_0',\n      type: 'end',\n      data: {\n        title: 'End',\n        content: 'end content'\n      },\n    },\n  ],\n};\n\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"4-声明节点",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#4-声明节点",children:"#"}),"4. 声明节点"]}),"\n",(0,i.jsx)(e.p,{children:"声明节点可以用于确定节点的类型及渲染方式"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",meta:'pure title="node-registries.tsx"',children:"import { FlowNodeRegistry, ValidateTrigger } from '@flowgram.ai/fixed-layout-editor';\n\n/**\n * 自定义节点注册\n */\nexport const nodeRegistries: FlowNodeRegistry[] = [\n  {\n    /**\n     * 自定义节点类型\n     */\n    type: 'condition',\n    /**\n     * 自定义节点扩展:\n     *  - loop: 扩展为循环节点\n     *  - start: 扩展为开始节点\n     *  - dynamicSplit: 扩展为分支节点\n     *  - end: 扩展为结束节点\n     *  - tryCatch: 扩展为 tryCatch 节点\n     *  - default: 扩展为普通节点 (默认)\n     */\n    extend: 'dynamicSplit',\n    /**\n     * 节点配置信息\n     */\n    meta: {\n      // isStart: false, // 是否为开始节点\n      // isNodeEnd: false, // 是否为结束节点，结束节点后边无法再添加节点\n      // draggable: false, // 是否可拖拽，如开始节点和结束节点无法拖拽\n      // selectable: false, // 触发器等开始节点不能被框选\n      // deleteDisable: true, // 禁止删除\n      // copyDisable: true, // 禁止copy\n      // addDisable: true, // 禁止添加\n    },\n    /**\n     * 配置节点表单的校验及渲染,\n     * 注：validate 采用数据和渲染分离，保证节点即使不渲染也能对数据做校验\n     */\n    formMeta: {\n      validateTrigger: ValidateTrigger.onChange,\n      validate: {\n        title: ({ value }) => (value ? undefined : 'Title is required'),\n      },\n      /**\n       * Render form\n       */\n      render: () => (\n       <>\n          <Field name=\"title\">\n            {({ field }) => <div className=\"demo-free-node-title\">{field.value}</div>}\n          </Field>\n          <Field name=\"content\">\n            {({ field }) => <input onChange={field.onChange} value={field.value}/>}\n          </Field>\n        </>\n      )\n    },\n  },\n];\n\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"5-渲染节点",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#5-渲染节点",children:"#"}),"5. 渲染节点"]}),"\n",(0,i.jsx)(e.p,{children:"渲染节点用于添加样式、事件及表单渲染的位置"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",meta:'pure title="base-node.tsx"',children:"import { useNodeRender } from '@flowgram.ai/fixed-layout-editor';\n\nexport const BaseNode = () => {\n  /**\n   * 提供节点渲染相关的方法\n   */\n  const nodeRender = useNodeRender();\n  /**\n   * 只有在节点引擎开启时候才能使用表单\n   */\n  const form = nodeRender.form;\n\n  return (\n    <div\n      className=\"demo-fixed-node\"\n      onMouseEnter={nodeRender.onMouseEnter}\n      onMouseLeave={nodeRender.onMouseLeave}\n      onMouseDown={e => {\n        // 触发拖拽\n        nodeRender.startDrag(e);\n        e.stopPropagation();\n      }}\n      style={{\n        // BlockOrderIcon 表示为分支的第一个节点，BlockIcon 则表示整个 condition 的头部节点\n        ...(nodeRender.isBlockOrderIcon || nodeRender.isBlockIcon ? { width: 260 } : {}),\n        outline: form?.state.invalid ? '1px solid red' : 'none', // 表单校验错误让边框标红\n      }}\n    >\n      {\n        // 表单渲染通过 formMeta 生成\n        form?.render()\n      }\n    </div>\n  );\n};\n\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"6-添加工具",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#6-添加工具",children:"#"}),"6. 添加工具"]}),"\n",(0,i.jsxs)(e.p,{children:["工具主要用于控制画布缩放等操作, 工具汇总在 ",(0,i.jsx)(e.code,{children:"usePlaygroundTools"})," 中, 而 ",(0,i.jsx)(e.code,{children:"useClientContext"})," 用于获取画布的上下文, 里边包含画布的核心模块如 ",(0,i.jsx)(e.code,{children:"history"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",meta:'pure title="tools.tsx"',children:"import { useEffect, useState } from 'react'\nimport { usePlaygroundTools, useClientContext } from '@flowgram.ai/fixed-layout-editor';\n\nexport function Tools() {\n  const { history } = useClientContext();\n  const tools = usePlaygroundTools();\n  const [canUndo, setCanUndo] = useState(false);\n  const [canRedo, setCanRedo] = useState(false);\n\n  useEffect(() => {\n    const disposable = history.undoRedoService.onChange(() => {\n      setCanUndo(history.canUndo());\n      setCanRedo(history.canRedo());\n    });\n    return () => disposable.dispose();\n  }, [history]);\n\n  return <div style={{ position: 'absolute', zIndex: 10, bottom: 16, left: 16, display: 'flex', gap: 8 }}>\n    <button onClick={() => tools.zoomin()}>ZoomIn</button>\n    <button onClick={() => tools.zoomout()}>ZoomOut</button>\n    <button onClick={() => tools.fitView()}>Fitview</button>\n    <button onClick={() => tools.changeLayout()}>ChangeLayout</button>\n    <button onClick={() => history.undo()} disabled={!canUndo}>Undo</button>\n    <button onClick={() => history.redo()} disabled={!canRedo}>Redo</button>\n    <span>{Math.floor(tools.zoom * 100)}%</span>\n  </div>\n}\n\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"7-效果",children:[(0,i.jsx)(e.a,{className:"header-anchor","aria-hidden":"true",href:"#7-效果",children:"#"}),"7. 效果"]}),"\n","\n",(0,i.jsx)("div",{style:{position:"relative",width:"100%",height:"600px"},children:(0,i.jsx)(r.zQ,{})})]})}function s(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:e}=Object.assign({},(0,o.ah)(),n.components);return e?(0,i.jsx)(e,Object.assign({},n,{children:(0,i.jsx)(d,n)})):d(n)}let a=s;s.__RSPRESS_PAGE_META={},s.__RSPRESS_PAGE_META["zh%2Fguide%2Fgetting-started%2Fcreate-fixed-layout-simple.mdx"]={toc:[{id:"1-画布入口",text:"1. 画布入口",depth:3},{id:"2-配置画布",text:"2. 配置画布",depth:3},{id:"3-配置数据",text:"3. 配置数据",depth:3},{id:"4-声明节点",text:"4. 声明节点",depth:3},{id:"5-渲染节点",text:"5. 渲染节点",depth:3},{id:"6-添加工具",text:"6. 添加工具",depth:3},{id:"7-效果",text:"7. 效果",depth:3}],title:"创建固定布局画布",frontmatter:{}}}}]);